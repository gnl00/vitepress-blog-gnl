<!DOCTYPE html>
<html lang="zh-CN" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>MySQL | Gnl</title>
    <meta name="description" content="A VitePress site">
    <link rel="preload stylesheet" href="/assets/style.192b8fa9.css" as="style">
    
    <script type="module" src="/assets/app.ba26e238.js"></script>
    <link rel="preload" href="/assets/inter-roman-latin.2ed14f66.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/assets/chunks/framework.834b76fb.js">
    <link rel="modulepreload" href="/assets/chunks/theme.759f3966.js">
    <link rel="modulepreload" href="/assets/posts_db_mysql_MySQL.md.db6ed566.lean.js">
    <link rel="icon" href="./img/logo.jpeg">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-5a346dfe><!--[--><!--]--><!--[--><span tabindex="-1" data-v-0f60ec36></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-0f60ec36> Skip to content </a><!--]--><!----><header class="VPNav" data-v-5a346dfe data-v-ae24b3ad><div class="VPNavBar has-sidebar" data-v-ae24b3ad data-v-a0fd61f4><div class="container" data-v-a0fd61f4><div class="title" data-v-a0fd61f4><div class="VPNavBarTitle has-sidebar" data-v-a0fd61f4 data-v-86d1bed8><a class="title" href="/" data-v-86d1bed8><!--[--><!--]--><!--[--><img class="VPImage logo" src="./logo.jpeg" alt data-v-8426fc1a><!--]--><!--[-->Gnl<!--]--><!--[--><!--]--></a></div></div><div class="content" data-v-a0fd61f4><div class="curtain" data-v-a0fd61f4></div><div class="content-body" data-v-a0fd61f4><!--[--><!--]--><div class="VPNavBarSearch search" data-v-a0fd61f4><!----></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-a0fd61f4 data-v-7f418b0f><span id="main-nav-aria-label" class="visually-hidden" data-v-7f418b0f>Main Navigation</span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/recently" tabindex="0" data-v-7f418b0f data-v-42ef59de><!--[--><span data-v-42ef59de>Recently</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="posts/al/index/" tabindex="0" data-v-7f418b0f data-v-42ef59de><!--[--><span data-v-42ef59de>算法</span><!--]--></a><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-7f418b0f data-v-9c007e85><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-9c007e85><span class="text" data-v-9c007e85><!----><span data-v-9c007e85>前端</span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-9c007e85><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-9c007e85><div class="VPMenu" data-v-9c007e85 data-v-e7ea1737><div class="items" data-v-e7ea1737><!--[--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/posts/fe/javascript/JavaScript" data-v-43f1e123><!--[-->JavaScript<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/posts/fe/vuejs/Vuejs" data-v-43f1e123><!--[-->Vue.js<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/posts/fe/react/React" data-v-43f1e123><!--[-->React<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/posts/fe/typescript/TypeScript" data-v-43f1e123><!--[-->TypeScript<!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-7f418b0f data-v-9c007e85><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-9c007e85><span class="text" data-v-9c007e85><!----><span data-v-9c007e85>后端</span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-9c007e85><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-9c007e85><div class="VPMenu" data-v-9c007e85 data-v-e7ea1737><div class="items" data-v-e7ea1737><!--[--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/posts/be/java/index/Java" data-v-43f1e123><!--[-->Java<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/posts/be/spring/Spring5" data-v-43f1e123><!--[-->Spring5<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/posts/be/springmvc/SpringMVC" data-v-43f1e123><!--[-->Spring MVC<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/posts/be/springboot/SpringBoot" data-v-43f1e123><!--[-->Spring Boot<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/posts/be/springsecurity/SpringSecurity" data-v-43f1e123><!--[-->Spring Security<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/posts/be/springcloud/SpringCloud" data-v-43f1e123><!--[-->Spring Cloud<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/posts/be/mybatis/MyBatis" data-v-43f1e123><!--[-->MyBatis<!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup active" data-v-7f418b0f data-v-9c007e85><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-9c007e85><span class="text" data-v-9c007e85><!----><span data-v-9c007e85>数据库</span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-9c007e85><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-9c007e85><div class="VPMenu" data-v-9c007e85 data-v-e7ea1737><div class="items" data-v-e7ea1737><!--[--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link active" href="/posts/db/mysql/MySQL" data-v-43f1e123><!--[-->MySQL<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/posts/db/redis/Redis" data-v-43f1e123><!--[-->Redis<!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-7f418b0f data-v-9c007e85><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-9c007e85><span class="text" data-v-9c007e85><!----><span data-v-9c007e85>中间件</span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-9c007e85><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-9c007e85><div class="VPMenu" data-v-9c007e85 data-v-e7ea1737><div class="items" data-v-e7ea1737><!--[--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/posts/mw/rocketmq/RocketMQ" data-v-43f1e123><!--[-->RocketMQ<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/posts/mw/elasticsearch/Elasticsearch" data-v-43f1e123><!--[-->Elasticsearch<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/posts/mw/kafka/Kafka" data-v-43f1e123><!--[-->Kafka<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/posts/mw/nginx/Nginx" data-v-43f1e123><!--[-->Nginx<!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-a0fd61f4 data-v-e6aabb21><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="toggle dark mode" aria-checked="false" data-v-e6aabb21 data-v-ce54a7d1 data-v-b1685198><span class="check" data-v-b1685198><span class="icon" data-v-b1685198><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-ce54a7d1><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-ce54a7d1><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div><!----><div class="VPFlyout VPNavBarExtra extra" data-v-a0fd61f4 data-v-40855f84 data-v-9c007e85><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-9c007e85><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon" data-v-9c007e85><circle cx="12" cy="12" r="2"></circle><circle cx="19" cy="12" r="2"></circle><circle cx="5" cy="12" r="2"></circle></svg></button><div class="menu" data-v-9c007e85><div class="VPMenu" data-v-9c007e85 data-v-e7ea1737><!----><!--[--><!--[--><!----><div class="group" data-v-40855f84><div class="item appearance" data-v-40855f84><p class="label" data-v-40855f84>Appearance</p><div class="appearance-action" data-v-40855f84><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="toggle dark mode" aria-checked="false" data-v-40855f84 data-v-ce54a7d1 data-v-b1685198><span class="check" data-v-b1685198><span class="icon" data-v-b1685198><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-ce54a7d1><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-ce54a7d1><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div></div></div><!----><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-a0fd61f4 data-v-e5dd9c1c><span class="container" data-v-e5dd9c1c><span class="top" data-v-e5dd9c1c></span><span class="middle" data-v-e5dd9c1c></span><span class="bottom" data-v-e5dd9c1c></span></span></button></div></div></div></div><!----></header><div class="VPLocalNav reached-top" data-v-5a346dfe data-v-79c8c1df><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-79c8c1df><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="menu-icon" data-v-79c8c1df><path d="M17,11H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,11,17,11z"></path><path d="M21,7H3C2.4,7,2,6.6,2,6s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,7,21,7z"></path><path d="M21,15H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,15,21,15z"></path><path d="M17,19H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,19,17,19z"></path></svg><span class="menu-text" data-v-79c8c1df>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-79c8c1df data-v-1c15a60a><button data-v-1c15a60a>Return to top</button><!----></div></div><aside class="VPSidebar" data-v-5a346dfe data-v-b00e2fdd><div class="curtain" data-v-b00e2fdd></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-b00e2fdd><span class="visually-hidden" id="sidebar-aria-label" data-v-b00e2fdd> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="group" data-v-b00e2fdd><section class="VPSidebarItem level-0 collapsible collapsed" data-v-b00e2fdd data-v-e31bd47b><div class="item" role="button" tabindex="0" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><h2 class="text" data-v-e31bd47b>算法</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-e31bd47b><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="caret-icon" data-v-e31bd47b><path d="M9,19c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l5.3-5.3L8.3,6.7c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l6,6c0.4,0.4,0.4,1,0,1.4l-6,6C9.5,18.9,9.3,19,9,19z"></path></svg></div></div><div class="items" data-v-e31bd47b><!--[--><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/posts/al/index/" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>Guide</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/posts/al/%E4%BD%8D%E8%BF%90%E7%AE%97" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>位运算</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/posts/al/%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>常见算法</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-b00e2fdd><section class="VPSidebarItem level-0 collapsible collapsed" data-v-b00e2fdd data-v-e31bd47b><div class="item" role="button" tabindex="0" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><h2 class="text" data-v-e31bd47b>设计模式</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-e31bd47b><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="caret-icon" data-v-e31bd47b><path d="M9,19c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l5.3-5.3L8.3,6.7c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l6,6c0.4,0.4,0.4,1,0,1.4l-6,6C9.5,18.9,9.3,19,9,19z"></path></svg></div></div><div class="items" data-v-e31bd47b><!--[--><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/posts/dp/index/" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>Guide</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/posts/dp/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>设计模式</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-b00e2fdd><section class="VPSidebarItem level-0 collapsible collapsed" data-v-b00e2fdd data-v-e31bd47b><div class="item" role="button" tabindex="0" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><h2 class="text" data-v-e31bd47b>前端</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-e31bd47b><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="caret-icon" data-v-e31bd47b><path d="M9,19c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l5.3-5.3L8.3,6.7c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l6,6c0.4,0.4,0.4,1,0,1.4l-6,6C9.5,18.9,9.3,19,9,19z"></path></svg></div></div><div class="items" data-v-e31bd47b><!--[--><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/posts/fe/index/" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>Guide</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/posts/fe/javascript/JavaScript" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>JavaScript</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/posts/fe/vuejs/Vuejs" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>Vue.js</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/posts/fe/react/React" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>React</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/posts/fe/typescript/TypeScript" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>TypeScript</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-b00e2fdd><section class="VPSidebarItem level-0 collapsible collapsed" data-v-b00e2fdd data-v-e31bd47b><div class="item" role="button" tabindex="0" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><h2 class="text" data-v-e31bd47b>后端</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-e31bd47b><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="caret-icon" data-v-e31bd47b><path d="M9,19c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l5.3-5.3L8.3,6.7c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l6,6c0.4,0.4,0.4,1,0,1.4l-6,6C9.5,18.9,9.3,19,9,19z"></path></svg></div></div><div class="items" data-v-e31bd47b><!--[--><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/posts/be/index/" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>Guide</p><!--]--></a><!----></div><!----></div><section class="VPSidebarItem level-1 collapsible collapsed is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" tabindex="0" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/posts/be/java/index/Java" data-v-e31bd47b><!--[--><h3 class="text" data-v-e31bd47b>Java</h3><!--]--></a><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-e31bd47b><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="caret-icon" data-v-e31bd47b><path d="M9,19c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l5.3-5.3L8.3,6.7c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l6,6c0.4,0.4,0.4,1,0,1.4l-6,6C9.5,18.9,9.3,19,9,19z"></path></svg></div></div><div class="items" data-v-e31bd47b><!--[--><div class="VPSidebarItem level-2 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/posts/be/java/java-basic/Java-%E5%9F%BA%E7%A1%80" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>Java 基础</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/posts/be/java/java-collection/Java-%E9%9B%86%E5%90%88" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>Java 集合</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/posts/be/java/java-thread/Java-%E5%A4%9A%E7%BA%BF%E7%A8%8B" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>Java 多线程</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/posts/be/java/java-threadpool/Java-%E7%BA%BF%E7%A8%8B%E6%B1%A0" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>Java 线程池</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/posts/be/java/java-juc/Java-JUC" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>Java JUC</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/posts/be/java/io/Java-IO" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>Java IO</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/posts/be/java/java-advance/Java-%E8%BF%9B%E9%98%B6" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>Java 进阶</p><!--]--></a><!----></div><!----></div><!--]--></div></section><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/posts/be/java/jvm/JVM" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>JVM</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/posts/be/spring/Spring5" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>Spring5</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/posts/be/springmvc/SpringMVC" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>Spring MVC</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/posts/be/springboot/SpringBoot" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>Spring Boot</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/posts/be/springsecurity/SpringSecurity" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>Spring Security</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/posts/be/springcloud/SpringCloud" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>Spring Cloud</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/posts/be/mybatis/MyBatis" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>MyBatis</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-b00e2fdd><section class="VPSidebarItem level-0 collapsible has-active" data-v-b00e2fdd data-v-e31bd47b><div class="item" role="button" tabindex="0" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><h2 class="text" data-v-e31bd47b>数据库</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-e31bd47b><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="caret-icon" data-v-e31bd47b><path d="M9,19c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l5.3-5.3L8.3,6.7c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l6,6c0.4,0.4,0.4,1,0,1.4l-6,6C9.5,18.9,9.3,19,9,19z"></path></svg></div></div><div class="items" data-v-e31bd47b><!--[--><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/posts/db/index/" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>Guide</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/posts/db/mysql/MySQL" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>MySQL</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/posts/db/redis/Redis" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>Redis</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-b00e2fdd><section class="VPSidebarItem level-0 collapsible collapsed" data-v-b00e2fdd data-v-e31bd47b><div class="item" role="button" tabindex="0" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><h2 class="text" data-v-e31bd47b>中间件</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-e31bd47b><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="caret-icon" data-v-e31bd47b><path d="M9,19c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l5.3-5.3L8.3,6.7c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l6,6c0.4,0.4,0.4,1,0,1.4l-6,6C9.5,18.9,9.3,19,9,19z"></path></svg></div></div><div class="items" data-v-e31bd47b><!--[--><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/posts/mw/index/" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>Guide</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/posts/mw/rocketmq/RocketMQ" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>RocketMQ</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/posts/mw/elasticsearch/Elasticsearch" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>Elasticsearch</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/posts/mw/kafka/Kafka" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>Kafka</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/posts/mw/nginx/Nginx" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>Nginx</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-5a346dfe data-v-669faec9><div class="VPDoc has-sidebar has-aside" data-v-669faec9 data-v-6b87e69f><!--[--><!--]--><div class="container" data-v-6b87e69f><div class="aside" data-v-6b87e69f><div class="aside-curtain" data-v-6b87e69f></div><div class="aside-container" data-v-6b87e69f><div class="aside-content" data-v-6b87e69f><div class="VPDocAside" data-v-6b87e69f data-v-3f215769><!--[--><!--]--><!--[--><!--]--><div class="VPDocAsideOutline" role="navigation" data-v-3f215769 data-v-d330b1bb><div class="content" data-v-d330b1bb><div class="outline-marker" data-v-d330b1bb></div><div class="outline-title" role="heading" aria-level="2" data-v-d330b1bb>On this page</div><nav aria-labelledby="doc-outline-aria-label" data-v-d330b1bb><span class="visually-hidden" id="doc-outline-aria-label" data-v-d330b1bb> Table of Contents for current page </span><ul class="root" data-v-d330b1bb data-v-d0ee3533><!--[--><!--]--></ul></nav></div></div><!--[--><!--]--><div class="spacer" data-v-3f215769></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-6b87e69f><div class="content-container" data-v-6b87e69f><!--[--><!--]--><!----><main class="main" data-v-6b87e69f><div style="position:relative;" class="vp-doc _posts_db_mysql_MySQL" data-v-6b87e69f><div><h1 id="mysql" tabindex="-1">MySQL <a class="header-anchor" href="#mysql" aria-label="Permalink to &quot;MySQL&quot;">​</a></h1><br><h2 id="关系-非关系数据库" tabindex="-1">关系/非关系数据库 <a class="header-anchor" href="#关系-非关系数据库" aria-label="Permalink to &quot;关系/非关系数据库&quot;">​</a></h2><h3 id="关系型数据库" tabindex="-1">关系型数据库 <a class="header-anchor" href="#关系型数据库" aria-label="Permalink to &quot;关系型数据库&quot;">​</a></h3><blockquote><p>关系型数据库将数据存储在不同的数据表中。关系型数据库结构被组织成物理文件，以优化速度。逻辑上，关系型数据库包含数据库/表/视图/行/列。</p><p>可以定义不同的规则用来管理数据库中不同数据字段，并组织不同字段之间的关系。比如说，一对一，一对多，多对多等。</p></blockquote><p><strong>特点</strong></p><ul><li><p>存储媒介：关系型数据库的数据存储在<strong>磁盘</strong>，比内存稳定，但是高并发下 IO 压力大，面对大量存储数据无法快速响应；</p></li><li><p>存储结构：关系型数据库按照<strong>结构化存储</strong>数据，数据表提前定义好字段，再根据表的结构存入数据。提前定义结构使得数据表乃至整个数据库的可靠性和稳定性都比较高，但后续修改表结构不方便；</p></li><li><p>存储规范：关系型数据库按照<strong>数据表</strong>的形式进行存储，但表之间存在复杂的关系，随着数据表数量的增加，数据管理会越来越复杂；</p></li><li><p>扩展方式：水平扩展（增加数量）和垂直扩展（按业务拆分）；</p></li><li><p>查询：采用结构化查询语言（即 SQL）进行查询，可以进行复杂的查询，也支持创建查询索引，但后续需要同时兼顾数据和索引的存储/维护，海量数据的索引存储和维护开销也是巨大的；模糊查询/全文搜索能力较弱，可以考虑使用如 ElasticSearch 等非关系型数据库来实现；</p></li><li><p>事务支持：关系型数据库强调 ACID 原则，十分强调数据的强一致性，对于事务的操作有很好的支持。关系型数据库可以控制事务原子性细粒度，方便回滚操作；</p><p>但要保证事务操作的特性就需要在数据库中加各种锁，而且数据量增长之后还要面对数据库的拆分，就需要解决分布式事务。</p></li></ul><br><h3 id="非关系型数据库" tabindex="-1">非关系型数据库 <a class="header-anchor" href="#非关系型数据库" aria-label="Permalink to &quot;非关系型数据库&quot;">​</a></h3><p><strong>特点</strong></p><ul><li><p>存储媒介：非关系型数据库大多数（不是所有）都是和内存打交道的，比如 Redis，数据存储在内存中，以实现数据高性能/高并发访问；</p></li><li><p>存储结构：NoSQL 无需为存储的数据提前建立字段，可以存储自定义的数据格式。常见的有键值/列簇/文档/图形等存储格式；</p></li><li><p>查询：复杂的查询不容易实现；</p></li><li><p>事务支持：非关系数据库不支持事务，无法保证数据的一致性和安全性；</p></li><li><p>高性能：具有非常高的读写性能。得益于无关系性，数据库的结构简单。从缓存方面看，NoSQL 的 Cache 是记录级的，是一种细粒度的 Cache，性能较高；</p></li><li><p>高可用：NoSQL 在不太影响性能的情况，就可以方便地实现高可用的架构。</p></li></ul><br><h2 id="体系架构" tabindex="-1">体系架构 <a class="header-anchor" href="#体系架构" aria-label="Permalink to &quot;体系架构&quot;">​</a></h2><p>由上至下分为：网络连接层，服务层，存储引擎层，系统文件层。</p><p><img src="/assets/image-20220209150005366.7baff4ee.png" alt="image-20220209150005366"></p><br><h3 id="网络连接层" tabindex="-1">网络连接层 <a class="header-anchor" href="#网络连接层" aria-label="Permalink to &quot;网络连接层&quot;">​</a></h3><p>Connectors，提供给各种应用程序（JDBC、ODBC）接入 MySQL 服务的接口。客户端与服务端建立连接，客户端发送 SQL 语句到服务端执行。</p><br><h3 id="服务层" tabindex="-1">服务层 <a class="header-anchor" href="#服务层" aria-label="Permalink to &quot;服务层&quot;">​</a></h3><p>1、<strong>管理服务和工具组件</strong>，系统管理和控制工具，如备份恢复、安全管理、MySQL 复制、集群管理等</p><p>2、<strong>连接池</strong></p><ul><li>由于每次建立连接需要消耗很多时间，连接器的作用就是将这些连接缓存下来，下次可以直接用已经建立好的连接，提升服务器性能</li><li>主要负责连接管理、授权认证等。每个客户端连接都对应着服务器上的一个线程，服务器上维护可一个线程池，避免为每个连接都创建销毁一个线程。当客户端连接到 MySQL 服务器时，服务器对其进行认证，可以通过用户名和密码进行认证，也可以通过 SSL 证书进行认证。登录认证后，服务器还会验证的客户端角色是否有执行某个查询的操作权限</li></ul><p>3、<strong>SQL 接口</strong>，接收客户端发送过来的 SQL 命令，并返回操作结果</p><ul><li><strong>DDL</strong>（Data Definition Language），DDL 允许用户定义数据，也就是创建表、删除表、修改表结构这些操作。通常，DDL 由数据库管理员执行（面向 DBA）</li><li><strong>DML</strong>「Data Manipulation（操纵） Language」，DML 为用户提供添加、删除、更新数据的能力，这些是应用程序对数据库的日常操作（面向开发者）</li><li><strong>DQL</strong>（Data Query Language），DQL 允许用户查询数据，这也是通常最频繁的数据库日常操作（面向用户）</li></ul><p>4、<strong>查询解析器</strong></p><ul><li>SQL 命令传递到解析器的时候会被解析器<strong>验证和解析</strong></li><li>MySQL 是一个 DBMS（数据库管理系统），无法直接理解 SQL 语句，查询解析器负责对 SQL 语句进行验证和解析，让 DBMS 知道下一步该做什么</li></ul><p>5、<strong>查询优化器</strong></p><ul><li><p>SQL 语句在查询之前会使用查询优化器对查询进行优化，查询优化器使用的是<strong>选取、投影、联接</strong>策略进行查询，以此选择一个最优的查询路径</p><div class="language-sql vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">select</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">uid</span><span style="color:#E1E4E8;">, </span><span style="color:#F97583;">name</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> user </span><span style="color:#F97583;">where</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">uid</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;1&quot;</span><span style="color:#E1E4E8;">;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">select</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">uid</span><span style="color:#24292E;">, </span><span style="color:#D73A49;">name</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> user </span><span style="color:#D73A49;">where</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">uid</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;1&quot;</span><span style="color:#24292E;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><ol><li><code>select</code> 查询先根据 <code>where</code> 语句进行选取，而不是先全表查询后再进行条件过滤</li><li><code>select</code> 查询先根据 uid 和 name 进行属性投影，而不是将属性全部取出来后再进行过滤</li><li>将这两个查询条件联接起来，生成最终查询结果</li></ol></li></ul><p>6、<strong>缓存</strong></p><ul><li>缓存和缓冲组件，查询缓存，如果查询缓存有命中的查询结果，查询语句就可以直接在查询缓存中读取数据</li><li>MySQL 8.0 以后，缓存被移除。因为查询缓存的失效非常频繁，如果在一个写多读少的环境中，缓存会频繁的新增和失效。对于某些更新压力大的数据库来说，查询缓存的命中率会非常低。5.6 版本默认关闭，推荐将缓存放在客户端</li><li>MySQL 缓存机制是由一系列小缓存组成的。比如表缓存/记录缓存/key 缓存/权限缓存等</li></ul><br><h3 id="存储引擎层" tabindex="-1">存储引擎层 <a class="header-anchor" href="#存储引擎层" aria-label="Permalink to &quot;存储引擎层&quot;">​</a></h3><blockquote><p>MySQL 中的数据用各种不同的技术存储在文件（内存）中。每一种技术都使用不同的存储机制、索引技巧、锁方式，并且提供不同操作数据的功能和能力。通过选择不同的技术，能够获得不同的速度或者功能，从而改善应用的整体功能。</p><p>这些不同的技术以及配套的相关功能在 MySQL 中被称作<strong>存储引擎</strong>，也称作<strong>表类型</strong>。</p></blockquote><p><strong>细节</strong></p><ul><li>存储引擎负责数据的存储和读取，与数据库文件打交道</li><li><strong>存储引擎只有 MySQL 才有，不是所有的关系型数据库都有存储引擎这个概念</strong>。MySQL 区别于其他数据库最重要的一个特点就是，支持插件式的<strong>表存储引擎</strong>。<strong>存储引擎是基于表的</strong>。</li><li>MySQL 采用插件式的存储引擎，提供了多种存储引擎，每种存储引擎有不同的特点</li></ul><br><p><strong>查询 MySQL 存储引擎</strong></p><div class="language-sql vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">show engines;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">show engines;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><br><p><strong>常见存储引擎</strong></p><p>1、<strong>InnoDB</strong>，默认事务型存储引擎</p><ul><li><p>用来处理大量的短期（Short-Lived）事务，除非有特别的原因，否则应该优先考虑 InnoDB</p></li><li><p>提供事务提交，回滚和崩溃回复能力</p></li><li><p>行级锁，并发能力强，适合高并发操作</p></li><li><p>支持自动增长列，支持外键，默认使用 B+ 树数据结构存储索引</p></li><li><p>对于使用 InnoDB 的表，其数据的物理组织形式是<strong>聚簇表</strong>。所有的数据按照主键来组织，数据和索引放在一起，都位于 B+ 树的叶子结点上</p></li><li><p>存在缓冲管理，通过缓冲池，将索引和数据全部缓存起来，加快查询的速度。读数据，会首先从缓冲池中读取，若是没有则从磁盘读取再放入缓冲池；写数据，会首先写入缓冲池，再定期同步到磁盘上</p></li><li><p>占用空间是 MyISAM 的2.5倍，处理效率相对会差一些</p></li><li><p>InnoDB 不保存表的具体行数，执行 <code> select count(*) from table</code> 时需要全表扫描。而 MyISAM 用一个变量保存了整个表的行数，执行上述语句时只需要读出该变量即可</p></li></ul><br><p>2、<strong>MyISAM</strong>，拥有较高的插入/查询速度</p><ul><li>提供全文索引（B+ 树数据结构存储索引），空间函数（GIS）等特性</li><li>不支持事务，推荐以 <code>select/insert</code> 为主的应用使用</li><li>全表锁，拥有较快的执行速度，并发性能差</li><li>不支持外键，使用 B+ 树数据结构存储索引</li><li>占用空间比 InnoDB 小</li></ul><br><p>3、<strong>Memory</strong></p><ul><li>所有数据置于内存的存储引擎，拥有极高的插入/更新/查询效率。所有数据存储在内存中，速度快，会占用与数据量成正比的内存空间，且数据在 MySQL 重启时会丢失</li><li>全表锁</li><li>默认使用 Hash 索引，检索效率非常高，主要用于内容变化不频繁且数据量较小的表</li></ul><br><p>4、Archive</p><ul><li>Archive 档案存储引擎只支持 <code>insert/select</code> 操作，在 MySQL 5.1 之前不支持</li><li>适合日志和数据采集类应用</li><li>占用空间小，Archive 表比 MyISAM 表小约 75%，比 InnoDB 表小约 83%</li></ul><br><p>5、CSV</p><ul><li>CSV 引擎可以将普通的 CSV 文件作为 MySQL 表来处理，但不支持索引</li><li>CSV 存储的数据可以在操作系统里用文本编辑器或 Excel 打开</li><li>CSV 引擎可以作为一种数据交换机制</li></ul><br><p>6、Merge，一组 MyISAM 表的组合，在超大规模数据存储时很有用</p><br><p><strong>不同索引自增主键的区别</strong></p><blockquote><p>一张表里面有 ID 自增主键，当 <code>insert</code> 了 17 条记录之后，删除了第 15，16，17 条记录，把 MySQL 重启，再 <code>insert</code> 一条记录，这条记录的 ID 是 18 还是 15 ？</p></blockquote><p>如果表的存储引擎类型是 MyISAM，是 18。因为 MyISAM 表会把自增主键的最大 ID 记录到数据文件中，重启 MySQL 自增主键的最大 ID 也不会丢失；</p><p>如果表的存储引擎类型是 InnoDB，是 15。因为 InnoDB 表只是把自增主键的最大 ID 记录到内存中，所以重启数据库或对表进行 <code>OPTION</code> 操作，都会导致最大 ID 丢失。</p><br><p><strong>不同索引 count 的区别</strong></p><blockquote><p>哪个存储引擎执行 <code>select count(*)</code> 更快?</p></blockquote><p>MyISAM 更快，因为 MyISAM 内部维护了一个计数器，可以直接调用。在 MyISAM 存储引擎中，把表的总行数存储在磁盘上，当执行 <code>select count(*)</code> 时，直接返回。</p><p>InnoDB 没有将总行数存储在磁盘上，当执行 <code>select count(*)</code> 时，先把数据读出来，一行一行的累加，最后返回总数量。数据量越大，InnoDB 执行该语句就越耗时。这跟 InnoDB 的事务特性有关，由于多版本并发控制（MVCC）的原因，InnoDB 表<strong>应该返回多少行</strong>也是不确定的。</p><br><h3 id="系统文件层" tabindex="-1">系统文件层 <a class="header-anchor" href="#系统文件层" aria-label="Permalink to &quot;系统文件层&quot;">​</a></h3><p>系统文件层主要是将数据库的数据存储在文件系统中，并完成与存储引擎的交互。其存储的文件主要有：日志文件、数据文件、配置文件、MySQL 的进程 pid 文件和 socket 文件等。</p><h4 id="日志文件" tabindex="-1">日志文件 <a class="header-anchor" href="#日志文件" aria-label="Permalink to &quot;日志文件&quot;">​</a></h4><p>1、错误日志（Error log），默认开启，<code>show variables like &#39;%log_error%;&#39;</code></p><p>2、通用查询日志（General query log），记录一般查询语句，<code>show variables like &#39;%general%&#39;;</code></p><p>3、二进制日志（Binary log），<a href="https://blog.csdn.net/wwwdc1012/article/details/88373440" target="_blank" rel="noreferrer">MySQL Binlog 介绍</a></p><p>记录了对 MySQL 数据库执行的更改操作，并且记录了语句的发生时间、执行时长；但是它不记录 <code>select、show</code> 等不修改数据库的 SQL，主要用于数据库恢复和主从复制。</p><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;"># 是否开启</span></span>
<span class="line"><span style="color:#B392F0;">show</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">variables</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">like</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;%log_bin%&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#6A737D;"># 参数查看</span></span>
<span class="line"><span style="color:#B392F0;">show</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">variables</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">like</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;%binlog%&#39;</span><span style="color:#E1E4E8;">; </span></span>
<span class="line"><span style="color:#6A737D;"># 查看日志文件</span></span>
<span class="line"><span style="color:#B392F0;">show</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">binary</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">logs</span><span style="color:#E1E4E8;">;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># 是否开启</span></span>
<span class="line"><span style="color:#6F42C1;">show</span><span style="color:#24292E;"> </span><span style="color:#032F62;">variables</span><span style="color:#24292E;"> </span><span style="color:#032F62;">like</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;%log_bin%&#39;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#6A737D;"># 参数查看</span></span>
<span class="line"><span style="color:#6F42C1;">show</span><span style="color:#24292E;"> </span><span style="color:#032F62;">variables</span><span style="color:#24292E;"> </span><span style="color:#032F62;">like</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;%binlog%&#39;</span><span style="color:#24292E;">; </span></span>
<span class="line"><span style="color:#6A737D;"># 查看日志文件</span></span>
<span class="line"><span style="color:#6F42C1;">show</span><span style="color:#24292E;"> </span><span style="color:#032F62;">binary</span><span style="color:#24292E;"> </span><span style="color:#032F62;">logs</span><span style="color:#24292E;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>4、慢查询日志（Slow query log）</p><p>记录所有执行时间超时的查询 SQL，默认是 10 秒。</p><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;"># 是否开启</span></span>
<span class="line"><span style="color:#B392F0;">show</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">variables</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">like</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;%slow_query%&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#6A737D;"># 时长</span></span>
<span class="line"><span style="color:#B392F0;">show</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">variables</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">like</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;%long_query_time%&#39;</span><span style="color:#E1E4E8;">;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># 是否开启</span></span>
<span class="line"><span style="color:#6F42C1;">show</span><span style="color:#24292E;"> </span><span style="color:#032F62;">variables</span><span style="color:#24292E;"> </span><span style="color:#032F62;">like</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;%slow_query%&#39;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#6A737D;"># 时长</span></span>
<span class="line"><span style="color:#6F42C1;">show</span><span style="color:#24292E;"> </span><span style="color:#032F62;">variables</span><span style="color:#24292E;"> </span><span style="color:#032F62;">like</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;%long_query_time%&#39;</span><span style="color:#24292E;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>5、中继日志，中继日志也是二进制日志，用来给 slave 库做恢复</p><p>6、事务日志，redo log 和 undo log</p><h4 id="配置文件" tabindex="-1">配置文件 <a class="header-anchor" href="#配置文件" aria-label="Permalink to &quot;配置文件&quot;">​</a></h4><p>用于存放 MySQL 所有的配置信息文件，比如 <code>my.cnf</code>、<code>my.ini</code>等。</p><h4 id="数据文件" tabindex="-1">数据文件 <a class="header-anchor" href="#数据文件" aria-label="Permalink to &quot;数据文件&quot;">​</a></h4><p>不同的存储引擎，存储在文件系统中的数据文件格式不同：</p><p>1、MyISAM</p><ul><li><code>*.frm</code>，与表相关的元数据信息都存放在 frm 文件中，包括表结构的定义信息等</li><li><code>*.MYD</code>，MyISAM Data，存储 MyISAM 表的数据，每一张 MyISAM 表对应一个 MYD 文件</li><li><code>*.MYI</code>，MyISAM Index，存储 MyISAM 表的索引相关信息，每一张 MyISAM 表对应一个 MYI 文件</li></ul><p>2、InnoDB</p><ul><li><code>*.frm</code>，与表相关的元数据信息都存放在 frm 文件中，包括表结构的定义信息等</li><li><code>*.ibd</code>，InnoDB Data，存储表数据和索引</li><li><code>*.ibdata</code>，与 <code>*.ibd</code> 相同</li></ul><p>InnoDB 的数据存储方式能够通过配置来决定是使用<strong>共享表空间</strong>存放存储数据，还是<strong>独享表空间</strong>存放存储数据。独享表空间存储方式使用 ibd，并且每个表为一个 ibd 文件。共享表空间存储方式采用 ibdata 文件，即所有的表共同使用一个 ibdata 文件</p><p>决定使用哪种表的存储方式可以通过 MySQL 的配置文件中的 <code>innodb_file_per_table</code> 来指定。InnoDB 默认使用的是独享表的存储方式，好处是当数据库产生大量文件碎片的时候，整理磁盘碎片对线上运行环境的影响较小</p><p><strong>pid 文件</strong></p><p>pid 文件是 mysqld 应用程序在 Unix/Linux 环境下的一个进程文件，和许多其他 Unix/Linux 服务端程序一样，它存放着自己的进程 id。</p><p><strong>socket 文件</strong></p><p>socket 文件也是在 Unix/Linux 环境下才有的，用户在 Unix/Linux 环境下客户端连接可以不通过TCP/IP 网络而直接使用 Unix Socket 来连接 MySQL。</p><br><h2 id="mysql-程序" tabindex="-1">MySQL 程序 <a class="header-anchor" href="#mysql-程序" aria-label="Permalink to &quot;MySQL 程序&quot;">​</a></h2><ul><li><p>mysqld 启动 MySQL 进程</p><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">mysqld</span><span style="color:#E1E4E8;"> &amp;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">mysqld</span><span style="color:#24292E;"> &amp;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div></li><li><p>mysqld_safe 安全启动 MySQL 进程</p><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">mysqld_safe</span><span style="color:#E1E4E8;"> &amp;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">mysqld_safe</span><span style="color:#24292E;"> &amp;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div></li><li><p>mysql 进入 MySQL 客户端进行命令行操作</p><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">mysql</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-uroot</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-p</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">mysql</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-uroot</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-p</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div></li><li><p>mysqladmin 管理 MySQL 进程操作，查看 MySQL 状态，重启/关闭 MySQL 等</p><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;"># 关闭 mysql 服务</span></span>
<span class="line"><span style="color:#B392F0;">mysqladmin</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-uroot</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">shutdown</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># 关闭 mysql 服务</span></span>
<span class="line"><span style="color:#6F42C1;">mysqladmin</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-uroot</span><span style="color:#24292E;"> </span><span style="color:#032F62;">shutdown</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li></ul><br><h2 id="数据类型" tabindex="-1">数据类型 <a class="header-anchor" href="#数据类型" aria-label="Permalink to &quot;数据类型&quot;">​</a></h2><h3 id="char-varchar" tabindex="-1">CHAR/VARCHAR <a class="header-anchor" href="#char-varchar" aria-label="Permalink to &quot;CHAR/VARCHAR&quot;">​</a></h3><blockquote><p><code>CHAR</code> 和 <code>VARCHAR</code> 类似，但是在存储和读取数据的表现上有所不同。支持存储的最大长度和字符串末尾空格的处理也有差异。</p><ul><li><p>定义阶段：CHAR 和 VARCHAR 在定义的时候都需要指定所存储的字符串的最大长度；</p></li><li><p>长度：</p><p>CHAR 的长度是固定的，支持的范围为 0 到 255；</p><p>VARCHAR 是可变长度的字符串类型，它的长度范围为 0 到 65535。VARCHAR 的有效最大长度取决于行的最大值（65535 bytes， 由所有的数据列共享）和使用的字符集类型。</p></li><li><p>长度不足：</p><p>存储的 CHAR 数据长度未达到创建表时的指定长度，会在末尾添加上一定长度的空格补全长度。当读取 CHAR 类型的数据时，除非开启 <a href="https://dev.mysql.com/doc/refman/8.0/en/sql-mode.html#sqlmode_pad_char_to_full_length" target="_blank" rel="noreferrer"><code>PAD_CHAR_TO_FULL_LENGTH</code></a> 模式，否则末尾的空格会被移除；</p><p>VARCHAR 列数据在存储时，若是数据长度未达到指定的长度，不会对其内容进行填充。依照标准的 SQL 执行模式，尾随空格在存储和读取的时候都会被保留下来。</p></li><li><p>长度溢出：</p><p>CHAR 类型不管 SQL 模式是否严格，如果插入的数据超过指定长度，其尾随空格会以静默的方式截断；</p><p>VARCHAR 类型不管 SQL 模式是否严格，如果插入的数据超过指定长度，其尾随空格会在插入前被截断，然后生成警告；</p></li><li><p>截断操作：</p><p>如果没有开启 SQL 严格模式，当 CHAR/VARCHAR 列存储的数据达到最大长度，超出的字符会被截断，并且会抛出警告；</p><p>如果开启了 SQL 严格模式，当 CHAR/VARCHAR 列存储的数据达到最大长度，对于非空格字符的截断，可能会抛出错误。</p></li><li><p>长度前缀：</p><p>与 CHAR 不同，VARCHAR 值存储为 1 字节或 2 字节的<strong>长度前缀</strong>加上数据。</p><p>长度前缀表示所存储值的字节数。如果数值不超过 255 字节，一列使用 1 长度字节，如果数值超过 255 字节，则使用 2 个长度字节。</p></li></ul></blockquote><p>下列表格展示了 CHAR 和 VARCHAR 列在存储指定长度为 4 的值时的不同表现（假设列数据使用的字符集是单字节字符集，比如说 latin1）</p><table><thead><tr><th>Value</th><th>CHAR(4)</th><th>Storage Required</th><th>VARCHAR(4)</th><th>Storage Required</th></tr></thead><tbody><tr><td>&#39;&#39;</td><td><code>&#39; &#39;</code></td><td>4 bytes</td><td>&#39;&#39;</td><td>1 byte</td></tr><tr><td>&#39;ab&#39;</td><td><code>&#39;ab &#39;</code></td><td>4 bytes</td><td>&#39;ab&#39;</td><td>3 bytes</td></tr><tr><td>&#39;abcd&#39;</td><td>&#39;abcd&#39;</td><td>4 bytes</td><td>&#39;abcd&#39;</td><td>5 bytes</td></tr><tr><td>&#39;abcdefgh&#39;</td><td>&#39;abcd&#39;</td><td>4 bytes</td><td>&#39;abcd&#39;</td><td>5 bytes</td></tr></tbody></table><blockquote><p>需要注意，需要开启非严格 SQL 模式，上表中的最后一行数据才能被保存，否则超过长度的数据将不会被保存，并且还会报错。</p></blockquote><blockquote><p>一个给定的值被保存到 CHAR(4) 和 VARCHAR(4) 列中，读取到的数据不一定总是相同的，因为 CHAR 列在读取数据的时候会将尾随空格去除。</p></blockquote><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">mysql&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">CREATE</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">TABLE</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">vc</span><span style="color:#E1E4E8;"> (v </span><span style="color:#9ECBFF;">VARCHAR</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">4</span><span style="color:#E1E4E8;">)</span><span style="color:#9ECBFF;">,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">c</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">CHAR</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">4</span><span style="color:#E1E4E8;">));</span></span>
<span class="line"><span style="color:#B392F0;">Query</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">OK,</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">rows</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">affected</span><span style="color:#E1E4E8;"> (0.01 </span><span style="color:#9ECBFF;">sec</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">mysql&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INSERT</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INTO</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">vc</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">VALUES</span><span style="color:#E1E4E8;"> (</span><span style="color:#9ECBFF;">&#39;ab  &#39;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&#39;ab  &#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#B392F0;">Query</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">OK,</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">row</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">affected</span><span style="color:#E1E4E8;"> (0.00 </span><span style="color:#9ECBFF;">sec</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">mysql&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">SELECT</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">CONCAT</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">&#39;(&#39;</span><span style="color:#B392F0;">,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">v,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;)&#39;</span><span style="color:#E1E4E8;">)</span><span style="color:#9ECBFF;">,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">CONCAT</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">&#39;(&#39;</span><span style="color:#B392F0;">,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">c,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;)&#39;</span><span style="color:#E1E4E8;">) </span><span style="color:#9ECBFF;">FROM</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">vc</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#B392F0;">+---------------------+---------------------+</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">CONCAT(</span><span style="color:#B392F0;">&#39;(&#39;</span><span style="color:#B392F0;">,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">v,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;)&#39;</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">CONCAT(</span><span style="color:#B392F0;">&#39;(&#39;</span><span style="color:#B392F0;">,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">c,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;)&#39;</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#B392F0;">+---------------------+---------------------+</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> (</span><span style="color:#B392F0;">ab</span><span style="color:#E1E4E8;">  )              </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> (</span><span style="color:#B392F0;">ab</span><span style="color:#E1E4E8;">)                </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#B392F0;">+---------------------+---------------------+</span></span>
<span class="line"><span style="color:#B392F0;">1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">row</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">in</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">set</span><span style="color:#E1E4E8;"> (0.06 </span><span style="color:#9ECBFF;">sec</span><span style="color:#E1E4E8;">)</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">mysql&gt;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">CREATE</span><span style="color:#24292E;"> </span><span style="color:#032F62;">TABLE</span><span style="color:#24292E;"> </span><span style="color:#032F62;">vc</span><span style="color:#24292E;"> (v </span><span style="color:#032F62;">VARCHAR</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">4</span><span style="color:#24292E;">)</span><span style="color:#032F62;">,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">c</span><span style="color:#24292E;"> </span><span style="color:#032F62;">CHAR</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">4</span><span style="color:#24292E;">));</span></span>
<span class="line"><span style="color:#6F42C1;">Query</span><span style="color:#24292E;"> </span><span style="color:#032F62;">OK,</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#24292E;"> </span><span style="color:#032F62;">rows</span><span style="color:#24292E;"> </span><span style="color:#032F62;">affected</span><span style="color:#24292E;"> (0.01 </span><span style="color:#032F62;">sec</span><span style="color:#24292E;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">mysql&gt;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INSERT</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INTO</span><span style="color:#24292E;"> </span><span style="color:#032F62;">vc</span><span style="color:#24292E;"> </span><span style="color:#032F62;">VALUES</span><span style="color:#24292E;"> (</span><span style="color:#032F62;">&#39;ab  &#39;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&#39;ab  &#39;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#6F42C1;">Query</span><span style="color:#24292E;"> </span><span style="color:#032F62;">OK,</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">row</span><span style="color:#24292E;"> </span><span style="color:#032F62;">affected</span><span style="color:#24292E;"> (0.00 </span><span style="color:#032F62;">sec</span><span style="color:#24292E;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">mysql&gt;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">SELECT</span><span style="color:#24292E;"> </span><span style="color:#032F62;">CONCAT</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">&#39;(&#39;</span><span style="color:#6F42C1;">,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">v,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;)&#39;</span><span style="color:#24292E;">)</span><span style="color:#032F62;">,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">CONCAT</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">&#39;(&#39;</span><span style="color:#6F42C1;">,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">c,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;)&#39;</span><span style="color:#24292E;">) </span><span style="color:#032F62;">FROM</span><span style="color:#24292E;"> </span><span style="color:#032F62;">vc</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#6F42C1;">+---------------------+---------------------+</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">CONCAT(</span><span style="color:#6F42C1;">&#39;(&#39;</span><span style="color:#6F42C1;">,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">v,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;)&#39;</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">CONCAT(</span><span style="color:#6F42C1;">&#39;(&#39;</span><span style="color:#6F42C1;">,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">c,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;)&#39;</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#6F42C1;">+---------------------+---------------------+</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> (</span><span style="color:#6F42C1;">ab</span><span style="color:#24292E;">  )              </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> (</span><span style="color:#6F42C1;">ab</span><span style="color:#24292E;">)                </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#6F42C1;">+---------------------+---------------------+</span></span>
<span class="line"><span style="color:#6F42C1;">1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">row</span><span style="color:#24292E;"> </span><span style="color:#032F62;">in</span><span style="color:#24292E;"> </span><span style="color:#032F62;">set</span><span style="color:#24292E;"> (0.06 </span><span style="color:#032F62;">sec</span><span style="color:#24292E;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>可以看到，读取到的 varchar 数据并没有去掉尾随空格，而 char 类型的数据去掉了尾随空格。</p><blockquote><p><strong>InnoDB 对 CHAR 的优化</strong></p><p>InnoDB 会将长度大于或等于 768 字节的固定长度字段编码为可变长度字段，让数据可以在页外存储。如果字符集的最大字节长度大于 3，一个 CHAR(255) 列可以超过 768 字节，比如 utf8mb4。</p></blockquote><blockquote><p><strong>CHAR/VARCHAR &amp; TEXT</strong></p><p><code>CHAR</code>, <code>VARCHAR</code>, 和 <code>TEXT</code> 数据会根据分配给该列的字符集规则进行排序和比较</p></blockquote><br><h2 id="sql" tabindex="-1">SQL <a class="header-anchor" href="#sql" aria-label="Permalink to &quot;SQL&quot;">​</a></h2><h3 id="执行流程" tabindex="-1">执行流程 <a class="header-anchor" href="#执行流程" aria-label="Permalink to &quot;执行流程&quot;">​</a></h3><img src="/assets/image-20210407205445602.1ef0d67f.png" alt="image-20210407205445602" style="zoom:80%;"><p>1、客户端通过<strong>连接器</strong>（JDBC、ODBC），将 <strong>SQL 语句发送</strong>到 MySQL 服务器；</p><p>2、客户端与 MySQL 服务器<strong>建立连接</strong>，MySQL 服务器验证请求的用户名和密码是否正确，账户正确；在系统表中验证用户权限，验证通过，进行下一步，验证不通过则报错；</p><p>3、命中<strong>缓存</strong>，从缓存中取结果返回；未命中缓存，继续下一步，进入 SQL 查询解析器；</p><p>4、<strong>查询解析器</strong>对 SQL 语句进行解析，包括预处理和解析过程。在这个阶段会对 SQL 语句进行关键词和非关键词提取、解析，组成一棵解析树。</p><p>关键字如：<code>select/update/in/or/where/group by</code>等，如果分析到语法错误，报错 <code>ERROR: You have an error in your SQL syntax</code>。同时也会对 SQL 语句做一些验证，如：表是否存在，字段是否存在等；</p><p>5、在查询之前，使用<strong>查询优化器</strong>对查询进行优化，查询优化器使用的是<strong>选取、投影、联接</strong>策略进行查询，如：将 SQL 语句中的查询条件调换位置，为让底层能使用索引，选择一个最优的查询路径</p><p>6、<strong>执行器</strong>，调用存储引擎对应的 API，根据 SQL 语句对数据文件进行操作，执行完成之后，将具体操作保存到 bin log 中（<code>select</code> 操作除外）。</p><p>7、返回结果</p><br><h3 id="关键字" tabindex="-1">关键字 <a class="header-anchor" href="#关键字" aria-label="Permalink to &quot;关键字&quot;">​</a></h3><h4 id="查询操作" tabindex="-1">查询操作 <a class="header-anchor" href="#查询操作" aria-label="Permalink to &quot;查询操作&quot;">​</a></h4><h4 id="工具" tabindex="-1">工具 <a class="header-anchor" href="#工具" aria-label="Permalink to &quot;工具&quot;">​</a></h4><ul><li><p>describe，用来获取表结构信息</p><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">mysql&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">DESCRIBE</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">City</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#B392F0;">+------------+----------+------+-----+---------+----------------+</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Field</span><span style="color:#E1E4E8;">      </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Type</span><span style="color:#E1E4E8;">     </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Null</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Key</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Default</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Extra</span><span style="color:#E1E4E8;">          </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#B392F0;">+------------+----------+------+-----+---------+----------------+</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Id</span><span style="color:#E1E4E8;">         </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">int(11</span><span style="color:#E1E4E8;">)  </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">NO</span><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">PRI</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">NULL</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">auto_increment</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Name</span><span style="color:#E1E4E8;">       </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">char(35</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">NO</span><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">     </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">         </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">                </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Country</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">char(3</span><span style="color:#E1E4E8;">)  </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">NO</span><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">UNI</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">         </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">                </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">District</span><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">char(20</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">YES</span><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">MUL</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">         </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">                </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Population</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">int(11</span><span style="color:#E1E4E8;">)  </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">NO</span><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">     </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">0</span><span style="color:#E1E4E8;">       </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">                </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#B392F0;">+------------+----------+------+-----+---------+----------------+</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">mysql&gt;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">DESCRIBE</span><span style="color:#24292E;"> </span><span style="color:#032F62;">City</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#6F42C1;">+------------+----------+------+-----+---------+----------------+</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Field</span><span style="color:#24292E;">      </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Type</span><span style="color:#24292E;">     </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Null</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Key</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Default</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Extra</span><span style="color:#24292E;">          </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#6F42C1;">+------------+----------+------+-----+---------+----------------+</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Id</span><span style="color:#24292E;">         </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">int(11</span><span style="color:#24292E;">)  </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">NO</span><span style="color:#24292E;">   </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">PRI</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">NULL</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">auto_increment</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Name</span><span style="color:#24292E;">       </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">char(35</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">NO</span><span style="color:#24292E;">   </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">     </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">         </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">                </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Country</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">char(3</span><span style="color:#24292E;">)  </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">NO</span><span style="color:#24292E;">   </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">UNI</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">         </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">                </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">District</span><span style="color:#24292E;">   </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">char(20</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">YES</span><span style="color:#24292E;">  </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">MUL</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">         </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">                </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Population</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">int(11</span><span style="color:#24292E;">)  </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">NO</span><span style="color:#24292E;">   </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">     </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">0</span><span style="color:#24292E;">       </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">                </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#6F42C1;">+------------+----------+------+-----+---------+----------------+</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>类似 <code>show columns</code></p><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">mysql&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">SHOW</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">COLUMNS</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">FROM</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">City</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#B392F0;">+-------------+----------+------+-----+---------+----------------+</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Field</span><span style="color:#E1E4E8;">       </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Type</span><span style="color:#E1E4E8;">     </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Null</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Key</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Default</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Extra</span><span style="color:#E1E4E8;">          </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#B392F0;">+-------------+----------+------+-----+---------+----------------+</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">ID</span><span style="color:#E1E4E8;">          </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">int(11</span><span style="color:#E1E4E8;">)  </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">NO</span><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">PRI</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">NULL</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">auto_increment</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Name</span><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">char(35</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">NO</span><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">     </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">         </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">                </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">CountryCode</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">char(3</span><span style="color:#E1E4E8;">)  </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">NO</span><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">MUL</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">         </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">                </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">District</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">char(20</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">NO</span><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">     </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">         </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">                </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Population</span><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">int(11</span><span style="color:#E1E4E8;">)  </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">NO</span><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">     </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">0</span><span style="color:#E1E4E8;">       </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">                </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#B392F0;">+-------------+----------+------+-----+---------+----------------+</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">mysql&gt;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">SHOW</span><span style="color:#24292E;"> </span><span style="color:#032F62;">COLUMNS</span><span style="color:#24292E;"> </span><span style="color:#032F62;">FROM</span><span style="color:#24292E;"> </span><span style="color:#032F62;">City</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#6F42C1;">+-------------+----------+------+-----+---------+----------------+</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Field</span><span style="color:#24292E;">       </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Type</span><span style="color:#24292E;">     </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Null</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Key</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Default</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Extra</span><span style="color:#24292E;">          </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#6F42C1;">+-------------+----------+------+-----+---------+----------------+</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">ID</span><span style="color:#24292E;">          </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">int(11</span><span style="color:#24292E;">)  </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">NO</span><span style="color:#24292E;">   </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">PRI</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">NULL</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">auto_increment</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Name</span><span style="color:#24292E;">        </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">char(35</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">NO</span><span style="color:#24292E;">   </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">     </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">         </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">                </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">CountryCode</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">char(3</span><span style="color:#24292E;">)  </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">NO</span><span style="color:#24292E;">   </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">MUL</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">         </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">                </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">District</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">char(20</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">NO</span><span style="color:#24292E;">   </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">     </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">         </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">                </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Population</span><span style="color:#24292E;">  </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">int(11</span><span style="color:#24292E;">)  </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">NO</span><span style="color:#24292E;">   </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">     </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">0</span><span style="color:#24292E;">       </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">                </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#6F42C1;">+-------------+----------+------+-----+---------+----------------+</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div></li><li><p>explain，用于查询语句执行计划（查看 MySQL 会如何执行某条 SQL 语句）。</p><p><img src="/assets/image-20230413132236383.bcd600c7.png" alt="image-20230413132236383"></p><p>当使用 explain 查询某条 SQL 语句的时候，MySQL 会展示经过 SQL 优化器优化之后该 SQL 语句的执行信息，比如有无使用索引，使用了什么关键字（where/and）等。</p><table><thead><tr><th>输出列名</th><th>解释</th></tr></thead><tbody><tr><td>id</td><td>The <code>SELECT</code> identifier</td></tr><tr><td>select_type</td><td>The <code>SELECT</code> type</td></tr><tr><td>table</td><td>The table for the output row</td></tr><tr><td>partitions</td><td>The matching partitions</td></tr><tr><td>type</td><td>The join type, <code>All/index/range/ref/eq_ref/const(system)/NULL</code></td></tr><tr><td>possible_keys</td><td>The possible indexes to choose</td></tr><tr><td>key</td><td>The index actually chosen</td></tr><tr><td>key_len</td><td>The length of the chosen key</td></tr><tr><td>ref</td><td>The columns compared to the index</td></tr><tr><td>rows</td><td>Estimate of rows to be examined</td></tr><tr><td>filtered</td><td>Percentage of rows filtered by table condition</td></tr><tr><td>Extra</td><td>Additional information</td></tr></tbody></table></li></ul><br><h3 id="sql-规范" tabindex="-1">SQL 规范 <a class="header-anchor" href="#sql-规范" aria-label="Permalink to &quot;SQL 规范&quot;">​</a></h3><p>1、尽量避免进行全表扫描</p><p>2、不要超过三张表关联</p><p>3、表字段不宜过多，对太多字段的表进行拆分</p><p>4、尽量不使用 <code>select *</code></p><p>5、适当建立索引，但是不能建立过多索引</p><p>6、根据不同的功能使用不同的存储引擎，插入、查询较多则使用 MyISAM，支持事务使用 InnoDB</p><p>7、尽量避免大段的事务操作</p><br><h3 id="常见问题" tabindex="-1">常见问题 <a class="header-anchor" href="#常见问题" aria-label="Permalink to &quot;常见问题&quot;">​</a></h3><br><blockquote><p><code>count(*)</code> 和 <code> count(1)</code> 和 <code>count(列名)</code> 区别</p></blockquote><p>执行效果上</p><ul><li><code>count(*)</code> 包括所有的列，相当于行数，在统计结果的时候，<strong>不会忽略列值为 NULL</strong></li><li><code>count(1)</code> 包括所有列，用 1 代表代码行，在统计结果的时候，<strong>不会忽略列值为 NULL</strong></li><li><code>count(列名)</code> 只包括列名那一列，在统计结果的时候，<strong>某个字段值为 NULL 时不统计。</strong></li></ul><p>执行效率上</p><ul><li>如果有主键，则 <code>count（主键）</code> 执行效率最优</li><li>如果表多个列并且没有主键，则 <code>count(1)</code> 的执行效率优于 <code>count(*)</code></li><li>如果表只有一个字段，则 <code>count(*)</code> 最优</li><li><code>count(主键)</code> 比 <code>count(1)</code> 快</li><li>列名不为主键，<code>count(1)</code> 比 <code>count(列名)</code>快</li></ul><br><blockquote><p><code>UNION</code>和 <code>UNION ALL</code> 的区别</p></blockquote><ul><li><code>UNION</code> 在进行表连接后会筛选掉重复的数据记录（效率较低），而 <code>UNION ALL</code> 则不会去掉重复的数据记录；</li><li><code>UNION</code> 会按照字段的顺序进行排序，而 <code>UNION ALL</code> 只是简单的将两个结果合并就返回；</li></ul><br><blockquote><p><code>IN</code> 和 <code>EXISTS</code> 的区别？</p></blockquote><ol><li>语法结构不同：<code>EXISTS</code> 是一个子查询（Subquery）关键字，用于检查一个查询结果是否存在；而 <code>IN</code> 是一个用于比较的运算符，用于检查某个值是否在一组值中。</li><li>执行方式不同：<code>EXISTS</code> 在执行时会先执行子查询，获取子查询的结果集，然后再根据外层查询的条件进行判断。而 <code>IN</code> 则会直接将待比较的值与一组值进行比较，<code>IN</code> 查询相当于多个 <code>OR</code> 条件的叠加</li><li>性能差异：<code>EXISTS</code> 可以在某些情况下具有较好的性能，因为它可以通过使用索引来优化查询。而 <code>IN</code> 在比较大的值集时可能会导致性能较差，因为它需要将待比较的值与一组值进行逐一比较。</li><li>语义差异：<code>EXISTS</code> 通常用于检查子查询是否返回了结果，例如用于检查某个表中是否存在满足特定条件的记录。而 <code>IN</code> 则用于比较某个值是否在一组值中，例如用于查询某个表中某一列的值是否在另一个表的列中出现。</li></ol><blockquote><p>如果查询的两个表大小相当，<code>IN</code> 和 <code>EXISTS</code> 差别不大；如果两个表中一个较小，一个是大表，则子查询表大的用 <code>EXISTS</code>，子查询表小的用 <code>IN</code></p></blockquote><br><h2 id="索引" tabindex="-1">索引 <a class="header-anchor" href="#索引" aria-label="Permalink to &quot;索引&quot;">​</a></h2><blockquote><p>索引，是关系数据库中对某一列或多个列的值进行预排序的<strong>数据结构</strong></p></blockquote><br><h3 id="关于索引" tabindex="-1">关于索引 <a class="header-anchor" href="#关于索引" aria-label="Permalink to &quot;关于索引&quot;">​</a></h3><div class="language-sql vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">-- 创建索引的基本语法</span></span>
<span class="line"><span style="color:#F97583;">CREATE</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">INDEX</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">indexName</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">ON</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">table</span><span style="color:#E1E4E8;">(column(</span><span style="color:#F97583;">length</span><span style="color:#E1E4E8;">));</span></span>
<span class="line"><span style="color:#6A737D;">-- 参数 length 默认可以忽略</span></span>
<span class="line"><span style="color:#F97583;">CREATE</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">INDEX</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">idx_name</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">ON</span><span style="color:#E1E4E8;"> user(</span><span style="color:#F97583;">name</span><span style="color:#E1E4E8;">);</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">-- 创建索引的基本语法</span></span>
<span class="line"><span style="color:#D73A49;">CREATE</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">INDEX</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">indexName</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">ON</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">table</span><span style="color:#24292E;">(column(</span><span style="color:#D73A49;">length</span><span style="color:#24292E;">));</span></span>
<span class="line"><span style="color:#6A737D;">-- 参数 length 默认可以忽略</span></span>
<span class="line"><span style="color:#D73A49;">CREATE</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">INDEX</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">idx_name</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">ON</span><span style="color:#24292E;"> user(</span><span style="color:#D73A49;">name</span><span style="color:#24292E;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>细节</strong></p><ul><li>除了数据，数据库系统还维护着满足特定查找算法的数据结构，这些数据结构以某种方式指向数据，可以在这些数据结构上实现高级查找算法。这种数据结构就是索引，<strong>索引的本质是一种数据结构</strong>；</li><li>使用索引，可以让数据库系统不必扫描整个表，直接定位到符合条件的记录，加快查询速度；</li><li>索引是建立在数据库表中的某些列的上面。在创建索引时，应仔细考虑在哪些列上创建索引，哪些列不创建索引。</li></ul><p><strong>优点</strong></p><ul><li>通过创建唯一性索引，可以保证数据库表中每一行数据的唯一性</li><li>索引减少了需要扫描的数据量，加快数据的查询速度</li><li>索引可以将随机 IO 变成顺序 IO</li></ul><p><strong>缺点</strong></p><ul><li>创建索引和维护索引要耗费时间，随着数据量的增加而增加</li><li>索引需要占物理空间，除了数据表占用数据空间之外，每一个索引还要占用一定的物理空间，如果需要建立聚簇索引，占用的空间更大</li><li>对表中的数据进行增、删、改的时候，索引也要动态的维护</li></ul><br><h3 id="索引结构" tabindex="-1">索引结构 <a class="header-anchor" href="#索引结构" aria-label="Permalink to &quot;索引结构&quot;">​</a></h3><h4 id="b-树" tabindex="-1">B 树 <a class="header-anchor" href="#b-树" aria-label="Permalink to &quot;B 树&quot;">​</a></h4><blockquote><p>所有结点中孩子结点个数的最大值称为 B 树的阶，通常用 <strong>m</strong> 表示，从查找效率考虑，要求 <strong>m &gt;= 3</strong></p></blockquote><p><strong>细节</strong></p><p>一颗 m 阶的 B 树要么是一颗<strong>空树</strong>，要么是满足以下要求的 <strong>m 叉树</strong>：</p><ul><li>每个结点最多有 <strong>m</strong> 个分支（子树）</li><li>最少分支的结点要看是否为根结点：如果是根结点，则至少有两个分支；非根非叶结点至少有 <strong>[m/2]</strong> 个分支（ <strong>[a]</strong> 是对 <strong>a</strong> 向上取整，即不小于 <strong>a</strong> 的最小整数）</li><li><strong>k=2</strong>（根结点）或 <strong>k=[m/2]</strong> （非根结点），有 <strong>n</strong>（<code>k&lt;=n&lt;=m</code>）个分支的结点有 <strong>n-1</strong> 个关键字，关键字按照递增顺序排序。</li></ul><p><strong>结点结构</strong></p><div><table><tr><td>n</td><td>k<sub>1</sub></td><td>k<sub>2</sub></td><td>...</td><td>k<sub>n</sub></td></tr><tr><td>p<sub>0</sub></td><td>p<sub>1</sub></td><td>p<sub>2</sub></td><td>...</td><td>p<sub>n</sub></td></tr></table></div><ul><li><strong>n</strong> 为结点中关键字的个数</li><li><strong>k<sub>i</sub></strong> 为结点的关键字且满足 <strong>k<sub>i</sub> &lt; k<sub>i+1</sub></strong></li><li><strong>p<sub>i</sub></strong>（<code>0&lt;=i&lt;=n</code>）为指向孩子结点指针，且满足 <strong>p<sub>i</sub></strong>（<code>1&lt;=i&lt;=n-1</code>）所指结点上的关键字大于 <strong>k<sub>i</sub></strong> 且小于 <strong>k<sub>i+1</sub></strong>，<strong>p<sub>0 </sub></strong> 所指结点上的关键字小于 <strong>k<sub>1</sub></strong>，且 **p<sub>n </sub>**所指结点上的关键字大于 <strong>k<sub>n</sub></strong></li><li>结点内关键字互不相等，按从小到大排序</li><li>叶子结点处于同一层，可以用空指针表示查找失败到达的位置</li></ul><p><img src="/assets/image-20220210141850639.aa6c4eb6.png" alt="image-20220210141850639"></p><p><strong>B树特征</strong></p><ul><li>在 B 树中，具有 n 个关键字的结点含有 n+1 个分支</li><li>关键字集合分布在整棵树中</li><li>任何一个关键字出现且只出现在一个结点中</li><li>搜索有可能在非叶子结点结束</li><li>搜索性能等价于在关键字全集内做一次二分查找</li><li>自动层次控制（平衡控制）</li></ul><p>B 树的查找是多路查找，从根结点开始，对结点内的关键字（递增排序）序列进行二分查找，如果命中则结束。否则进入查询关键字所属范围的孩子结点，并重复二分查找，直到遍历到的结点为空（查找失败），或者命中</p><blockquote><p>⚠ 平衡 m 叉查找树是指每个关键字的左子树和右子树高度差绝对值不超过 1 的查找树，其结点结构与 B 树结点结构相同。因此可认为 B 树是平衡 <strong>m</strong> 叉查找树，但限制更强，要求把所有叶子结点放在同一层</p></blockquote><br><h4 id="b-树-1" tabindex="-1">B+ 树 <a class="header-anchor" href="#b-树-1" aria-label="Permalink to &quot;B+ 树&quot;">​</a></h4><blockquote><p>基于 B 树和叶子结点顺序访问指针进行实现</p></blockquote><p><strong>m 阶 B+ 树的细节</strong></p><ul><li>根且非叶子结点的孩子结点数为 <strong>[2, m]</strong></li><li>非根非叶结点的孩子结点数为 <strong>[m/2, m]</strong></li><li>在 B+ 树中，具有 <strong>n</strong> 个关键字的结点含有 <strong>n</strong> 个分支；而在 B 树中，具有 <strong>n</strong> 个关键字的结点含有 <strong>n+1</strong> 个分支</li><li>在 B+ 树中，每个结点（非根结点）中的关键字个数 <strong>n</strong> 的取值范围为 <code>[m/2]&lt;=n&lt;=m</code>，根结点取值范围为 <code>2&lt;=n&lt;=m</code>；而在 B 树中，它们的取值范围分别是 <code>[m/2]-1&lt;=n&lt;=m-1</code>和 <code>1&lt;=n&lt;=m-1</code></li><li>在 B+ 树中叶子结点包含信息，并且包含全部关键字，叶子结点的指针指向<strong>记录</strong></li><li>B+ 树中的所有非叶子结点仅仅起到索引的作用（作为叶子结点的索引），结点中的每个索引项只含有对应子树的最大关键字和指向该字数的指针</li><li>在 B+ 树上有一个指针指向关键字最小的叶子结点，所有叶子结点连接成一个双向线性链表，而 B 树没有</li><li>B+ 树的搜索与 B 树也基本相同，区别是 B+ 树只有达到叶子结点才命中（B 树可以在非叶子结点命中），其性能也等价于在关键字全集做一次二分查找</li><li>B+ 树是自底向上插入的，优先会将数据插入到叶子结点中，然后整个树会根据底部的叶子结点进行变动</li></ul><br><p><strong>B+ 树特征</strong></p><ul><li>所有关键字都出现在叶子结点组成的链表中（稠密索引），且链表中的关键字是有序的</li><li>查找操作不会在非叶子结点命中</li><li>非叶子结点相当于叶子结点的索引（稀疏索引），叶子结点相当于是存储（关键字）数据的数据层</li><li>每一个叶子结点都包含一个指向下一个叶子结点的指针，从而方便叶子结点的范围遍历</li><li>更适合文件索引系统</li></ul><p><img src="/assets/image-20210522195820218.766532df.png" alt="image-20210522195820218"></p><br><p><strong>B+ 树与 B 树索引对比</strong></p><ol><li><p>B+ 树的磁盘读写代价更低</p><p>B+ 树的数据都集中在叶子结点，分支结点只作为索引存在；B 树的分支结点既有指针也有数据。</p><p>相较于 B 树，B+ 树每个非叶子结点存储的关键字数更多，因此 B+ 树的层次会低于 B 树，也就是说 B+ 树平均的 IO 次数会小于 B 树</p></li><li><p>B+ 树的查询效率更加稳定</p><p>B+ 树的数据都存放在叶子结点，因此任何关键字的查找必须走一条从根结点到叶子结点的路径，所有结点的查询路径相同，每个数据查询效率相当</p></li><li><p>B+ 树更便于遍历</p><p>由于 B+ 树的数据都存储在叶子结点中，分支结点均为索引，遍历只需要扫描一遍叶子结点即可；B 树分支结点同样存储着数据，要找到具体的数据，需要进行一次中序遍历按序来搜索。B+ 树需要遍历有序链表，而 B 树需要对整颗树进行中序遍历</p></li><li><p>B+ 树更擅长范围查询</p><p>B+ 树叶子结点存放数据，数据是按照顺序放置的双向链表。B 树范围查询只能中序遍历</p></li><li><p>B+ 树占用内存空间小</p><p>B+ 树索引结点没有数据，比较小。在内存有限的情况下，相比于 B 树索引可以加载更多 B+ 树索引</p></li></ol><br><p><strong>推荐使用自增 id 而不是 uuid 或者身份证号等</strong></p><p>叶子结点链表会根据当前最后一条的位置，将最新的一条数据顺序的插入到后面</p><p><img src="/assets/image-20210522201305456.65fb5387.png" alt="image-20210522201305456"></p><p>但是当插入一个 uuid 时，MySQL 不知道该插入到哪个位置，需要从头开始寻找插入的位置。当插入的页满了，就造成页的分裂和合并，极大影响效率</p><p><img src="/assets/image-20210522201351202.5f2bdbb1.png" alt="image-20210522201351202"></p><p>而且使用 uuid，由于 uuid 占用字节较长，就导致每一页存储的数据就会变少，也不利于索引的数据查询</p><br><h4 id="哈希" tabindex="-1">哈希 <a class="header-anchor" href="#哈希" aria-label="Permalink to &quot;哈希&quot;">​</a></h4><blockquote><p>哈希索引就是采用一定的哈希算法，把存储的键的哈希指算出来，<strong>使用哈希值代替键值存储</strong>，检索时不需要类似 B+ 树一样从根结点到叶子结点逐级查找，只需要执行一次哈希算法就可定位到相应的位置，速度非常快。Memory 存储引擎使用的就是 Hash 索引</p></blockquote><p><strong>特点</strong></p><ul><li>Hash 索引就是将索引字段进行 hash 存储，整个 hash 索引的结构是 Hash 表 + 链表（因为会存在 hash 冲突）</li><li>哈希索引仅仅能满足 <code>=</code>、<code>in</code> 和 <code>&lt; = &gt;</code> 查询（<code>&lt; = &gt;</code> 类似 <code>=</code> 运算符，<code>=</code> 运算符中的 NULL 值没有任何意义。<code>=</code> 号运算符不能把 NULL 作为有效的结果。此时可以使用 <code>&lt; = &gt;</code>），不能使用范围查询（大于小于），也不支持任何范围查询</li><li>由于哈希索引比较的是进行哈希运算后的 Hash 值，所以 Hash 索引适合精确查找，但是范围查找不适合</li></ul><br><p><strong>哈希和 B+ 树的区别</strong></p><ul><li>如果是等值查询，哈希索引占有绝对优势，因为只需要经过一次算法就可找到相应的键值；前提是所有的键值都是唯一的，如果键值不唯一，就需处理哈希冲突</li><li>如果是范围查询，B+ 树占绝对优势，因为原先是有序的键值，经过哈希算法后，就可能变成不连续了</li><li>B+ 树索引的关键字检索效率比较平均，不像 B 树那样波动幅度大。在有大量重复键值情况下，哈希索引因为存在哈希碰撞，效率也是极低的</li><li>哈希索引没有办法利用索引完成排序，以及 <code>like </code> 迷糊查询（<code>like</code> 本质上是范围查询）</li><li>哈希不支持多列联合索引的左右匹配规则</li></ul><br><h3 id="索引分类" tabindex="-1">索引分类 <a class="header-anchor" href="#索引分类" aria-label="Permalink to &quot;索引分类&quot;">​</a></h3><blockquote><p>逻辑分类和物理分类</p></blockquote><h4 id="逻辑分类" tabindex="-1">逻辑分类 <a class="header-anchor" href="#逻辑分类" aria-label="Permalink to &quot;逻辑分类&quot;">​</a></h4><p>1、<strong>功能划分</strong></p><p>1）<strong>主键索引</strong>，一张表只能有一个主键索引，不允许重复、不允许为 NULL</p><div class="language-sql vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">ALTER</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">TABLE</span><span style="color:#E1E4E8;"> TableName </span><span style="color:#F97583;">ADD</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">PRIMARY KEY</span><span style="color:#E1E4E8;">(column_list);</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">ALTER</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">TABLE</span><span style="color:#24292E;"> TableName </span><span style="color:#D73A49;">ADD</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">PRIMARY KEY</span><span style="color:#24292E;">(column_list);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>2）<strong>唯一索引</strong>，数据列不允许重复，允许为 NULL 值，一张表可有多个唯一索引，但是一个唯一索引只能包含一列，比如身份证号码、卡号等都可以作为唯一索引</p><div class="language-sql vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">CREATE</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">UNIQUE INDEX</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">IndexName</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">ON</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">`TableName`</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">`字段名`</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">length</span><span style="color:#E1E4E8;">));</span></span>
<span class="line"><span style="color:#E1E4E8;"># 或</span></span>
<span class="line"><span style="color:#F97583;">ALTER</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">TABLE</span><span style="color:#E1E4E8;"> TableName </span><span style="color:#F97583;">ADD</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">UNIQUE</span><span style="color:#E1E4E8;"> (column_list);</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">CREATE</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">UNIQUE INDEX</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">IndexName</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">ON</span><span style="color:#24292E;"> </span><span style="color:#032F62;">`TableName`</span><span style="color:#24292E;">(</span><span style="color:#032F62;">`字段名`</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">length</span><span style="color:#24292E;">));</span></span>
<span class="line"><span style="color:#24292E;"># 或</span></span>
<span class="line"><span style="color:#D73A49;">ALTER</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">TABLE</span><span style="color:#24292E;"> TableName </span><span style="color:#D73A49;">ADD</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">UNIQUE</span><span style="color:#24292E;"> (column_list);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>3）<strong>普通索引</strong>，一张表可以创建多个普通索引，一个普通索引可以包含多个字段，允许数据重复，允许 NULL 值插入</p><div class="language-sql vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">CREATE</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">INDEX</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">IndexName</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">ON</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">`TableName`</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">`FieldName`</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">length</span><span style="color:#E1E4E8;">));</span></span>
<span class="line"><span style="color:#E1E4E8;"># 或</span></span>
<span class="line"><span style="color:#F97583;">ALTER</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">TABLE</span><span style="color:#E1E4E8;"> TableName </span><span style="color:#F97583;">ADD</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">INDEX</span><span style="color:#E1E4E8;"> IndexName(</span><span style="color:#9ECBFF;">`FieldName`</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">length</span><span style="color:#E1E4E8;">));</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">CREATE</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">INDEX</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">IndexName</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">ON</span><span style="color:#24292E;"> </span><span style="color:#032F62;">`TableName`</span><span style="color:#24292E;">(</span><span style="color:#032F62;">`FieldName`</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">length</span><span style="color:#24292E;">));</span></span>
<span class="line"><span style="color:#24292E;"># 或</span></span>
<span class="line"><span style="color:#D73A49;">ALTER</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">TABLE</span><span style="color:#24292E;"> TableName </span><span style="color:#D73A49;">ADD</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">INDEX</span><span style="color:#24292E;"> IndexName(</span><span style="color:#032F62;">`FieldName`</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">length</span><span style="color:#24292E;">));</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>4）<strong>全文索引</strong>，查找的是文本中的关键词，主要用于全文检索。它用于替代效率较低的 <code>LIKE</code> 模糊匹配操作，而且可以通过多字段组合的全文索引一次性全模糊匹配多个字段。使用的数据结构是 B 树。</p><p>5）<strong>空间索引</strong></p><p>空间索引是对空间数据类型的字段建立的索引，MySQL 中的空间数据类型有 4 种，分别是 <code>GEOMETRY/POINT/LINESTRING/POLYGON</code>。</p><p>MySQL 使用 <code>SPATIAL</code> 关键字进行扩展，使得能够用于创建正规索引类型的语法创建空间索引。</p><div class="language-sql vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">CREATE</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">TABLE</span><span style="color:#E1E4E8;"> `</span><span style="color:#B392F0;">gim</span><span style="color:#E1E4E8;">` (</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">`path`</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">varchar</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">512</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">NOT NULL</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">`box`</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">geometry</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">NOT NULL</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">PRIMARY KEY</span><span style="color:#E1E4E8;"> (</span><span style="color:#9ECBFF;">`path`</span><span style="color:#E1E4E8;">),</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">SPATIAL</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">KEY</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">`box`</span><span style="color:#E1E4E8;"> (</span><span style="color:#9ECBFF;">`box`</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">) ;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">CREATE</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">TABLE</span><span style="color:#24292E;"> `</span><span style="color:#6F42C1;">gim</span><span style="color:#24292E;">` (</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#032F62;">`path`</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">varchar</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">512</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">NOT NULL</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#032F62;">`box`</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">geometry</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">NOT NULL</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">PRIMARY KEY</span><span style="color:#24292E;"> (</span><span style="color:#032F62;">`path`</span><span style="color:#24292E;">),</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">SPATIAL</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">KEY</span><span style="color:#24292E;"> </span><span style="color:#032F62;">`box`</span><span style="color:#24292E;"> (</span><span style="color:#032F62;">`box`</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">) ;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ul><li>创建空间索引的列，必须将其声明为 <code>NOT NULL</code></li><li>空间索引只能在存储引擎为 MYISAM 的表中创建</li></ul><br><p>2、<strong>按列划分</strong></p><p>1）<strong>单列索引</strong>，一个索引只包含一个列，一个表可以有多个单例索引</p><p>2）<strong>组合索引/复合索引</strong>，一个组合索引包含多个列。查询的时候遵循 MySQL 组合索引的<strong>最左前缀</strong>原则，从左到右匹配，<strong>查询条件要包含建立索引时最左边的字段，索引才会生效。</strong></p><div class="language-sql vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">-- 创建索引的基本语法</span></span>
<span class="line"><span style="color:#F97583;">CREATE</span><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">INDEX</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">indexName</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">ON</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">table</span><span style="color:#E1E4E8;">(column1(</span><span style="color:#F97583;">length</span><span style="color:#E1E4E8;">),column2(</span><span style="color:#F97583;">length</span><span style="color:#E1E4E8;">));</span></span>
<span class="line"><span style="color:#6A737D;">-- 例子 </span></span>
<span class="line"><span style="color:#F97583;">CREATE</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">INDEX</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">idx_phone_name</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">ON</span><span style="color:#E1E4E8;"> user(phone,</span><span style="color:#F97583;">name</span><span style="color:#E1E4E8;">);</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">-- 创建索引的基本语法</span></span>
<span class="line"><span style="color:#D73A49;">CREATE</span><span style="color:#24292E;">  </span><span style="color:#D73A49;">INDEX</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">indexName</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">ON</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">table</span><span style="color:#24292E;">(column1(</span><span style="color:#D73A49;">length</span><span style="color:#24292E;">),column2(</span><span style="color:#D73A49;">length</span><span style="color:#24292E;">));</span></span>
<span class="line"><span style="color:#6A737D;">-- 例子 </span></span>
<span class="line"><span style="color:#D73A49;">CREATE</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">INDEX</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">idx_phone_name</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">ON</span><span style="color:#24292E;"> user(phone,</span><span style="color:#D73A49;">name</span><span style="color:#24292E;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><br><blockquote><p><strong>最左前缀匹配原则</strong></p><p>首先基于建立一个联合索引</p><div class="language-sql vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">CREATE</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">INDEX</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">idx_age_height_weight</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">ON</span><span style="color:#E1E4E8;"> user(age, height, </span><span style="color:#F97583;">weight</span><span style="color:#E1E4E8;">)</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">CREATE</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">INDEX</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">idx_age_height_weight</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">ON</span><span style="color:#24292E;"> user(age, height, </span><span style="color:#D73A49;">weight</span><span style="color:#24292E;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>上文提到过，索引的数据结构是 B+ 树，B+ 树优化查询效率的其中一个因素就是对数据进行排序，在创建 <code>idx_age_height_weight</code> 索引的时候，相当于创建了一颗 B+ 树，而这个索引就是<strong>依据联合索引的成员来进行排序</strong>，这里是 <code>age、height、weight</code></p><ul><li><code>idx_age_height_weight</code> 索引会根据 <code>age、height、weight</code>进行排序</li></ul><p>InnoDB 中只要有主键被定义，主键列会被作为一个聚簇索引，而其它索引都将被作为非聚簇索引，所以假设主键存在，<code>idx_age_height_weight</code> 就是一个非聚簇索引</p><ul><li><code>idx_age_height_weight</code> 是一个非聚簇索引，查询时需要回表（先根据聚簇索引查到主键 ID，再根据 主键 ID 找到对应的数据）</li></ul><p>在 MySQL 中，联合索引的排序有一个原则：从左往右依次比较大小。拿刚才建立的索引举例子，先比较 age，如果 age 相同，比较 height，如果 height 无法比较大小，就比较 weight 的大小，无法进行排序比较大小的列，就无法走联合索引</p></blockquote><blockquote><p><strong>例子</strong></p><div class="language-sql vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">create</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">index</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">idx_phone_name</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">on</span><span style="color:#E1E4E8;"> user_innodb(phone, </span><span style="color:#F97583;">name</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">-- 1</span></span>
<span class="line"><span style="color:#F97583;">SELECT</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">FROM</span><span style="color:#E1E4E8;"> user_innodb </span><span style="color:#F97583;">where</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">name</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;zs&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#6A737D;">-- 2</span></span>
<span class="line"><span style="color:#F97583;">SELECT</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">FROM</span><span style="color:#E1E4E8;"> user_innodb </span><span style="color:#F97583;">where</span><span style="color:#E1E4E8;"> phone </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;1234567890&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#6A737D;">-- 3</span></span>
<span class="line"><span style="color:#F97583;">SELECT</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">FROM</span><span style="color:#E1E4E8;"> user_innodb </span><span style="color:#F97583;">where</span><span style="color:#E1E4E8;"> phone </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;1234567890&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">and</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">name</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;zs&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#6A737D;">-- 4</span></span>
<span class="line"><span style="color:#F97583;">SELECT</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">FROM</span><span style="color:#E1E4E8;"> user_innodb </span><span style="color:#F97583;">where</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">name</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;zs&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">and</span><span style="color:#E1E4E8;"> phone </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;1234567890&#39;</span><span style="color:#E1E4E8;">;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">create</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">index</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">idx_phone_name</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">on</span><span style="color:#24292E;"> user_innodb(phone, </span><span style="color:#D73A49;">name</span><span style="color:#24292E;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">-- 1</span></span>
<span class="line"><span style="color:#D73A49;">SELECT</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">FROM</span><span style="color:#24292E;"> user_innodb </span><span style="color:#D73A49;">where</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">name</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;zs&#39;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#6A737D;">-- 2</span></span>
<span class="line"><span style="color:#D73A49;">SELECT</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">FROM</span><span style="color:#24292E;"> user_innodb </span><span style="color:#D73A49;">where</span><span style="color:#24292E;"> phone </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;1234567890&#39;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#6A737D;">-- 3</span></span>
<span class="line"><span style="color:#D73A49;">SELECT</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">FROM</span><span style="color:#24292E;"> user_innodb </span><span style="color:#D73A49;">where</span><span style="color:#24292E;"> phone </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;1234567890&#39;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">and</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">name</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;zs&#39;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#6A737D;">-- 4</span></span>
<span class="line"><span style="color:#D73A49;">SELECT</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">FROM</span><span style="color:#24292E;"> user_innodb </span><span style="color:#D73A49;">where</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">name</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;zs&#39;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">and</span><span style="color:#24292E;"> phone </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;1234567890&#39;</span><span style="color:#24292E;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>三条 SQL 只有 2、3、4 能使用的到索引 <code>idx_phone_name</code>，因为条件里面必须包含索引前面的字段才能够进行匹配。</p><p><em>3 和 4 相比 where 条件的顺序不一样，为什么 4 可以用到索引呢？</em></p><p>因为在执行 SQL 之前，经过 SQL 查询解析器/SQL 优化器，会对 SQL 语句进行优化，会根据 SQL 来识别该用哪个索引，可以理解为 3 和 4 在 MySQL 中是等价的</p></blockquote><blockquote><p><strong>最左匹配特点</strong></p><p>1、最左前缀匹配原则，MySQL 会一直向右匹配直到遇到范围查询（&gt;、&lt;、between）或者 like ，就停止匹配后面的列索引。</p><p>比如，建立（a, b, c, d）顺序的索引，<code>a=3 and b=4 and c&gt;5 and d=6</code>，其中 d 是无法使用索引的，如果建立（a, b, d, c）的索引则都可以使用到，<code>a、b、d</code> 的顺序可以任意调整</p><p>2、<code>=</code> 和 <code>in</code> 可以乱序</p><p>比如 <code>a=1 and b=2 and c=3</code> 建立（a, b, c）索引可以任意顺序，MySQL 的查询优化器会优化成索引可以识别的形式</p></blockquote><br><h4 id="物理分类" tabindex="-1">物理分类 <a class="header-anchor" href="#物理分类" aria-label="Permalink to &quot;物理分类&quot;">​</a></h4><h5 id="聚簇索引" tabindex="-1">聚簇索引 <a class="header-anchor" href="#聚簇索引" aria-label="Permalink to &quot;聚簇索引&quot;">​</a></h5><p><strong>特性</strong></p><ul><li><p>聚簇索引（也称为主索引）将数据与索引存放到一起，找到索引也就找到了数据，索引和数据是一体的。B+ 树叶子结点中包含数据表中行记录的话就是聚簇索引（非叶子结点就是索引，同时叶子结点包含数据）</p></li><li><p>聚簇索引就是按照每张表的主键构造一颗 B+ 树。同时叶子结点中存放整张表的行记录数据，也将聚集索引的叶子结点称为数据页。这个特性决定了索引组织表中数据也是索引的一部分，每张表只能拥有一个聚簇索引</p></li><li><p>叶子结点数据域记录着完整的数据记录，因为无法把数据行存放在两个不同的地方</p><blockquote><p>在 MySQL 中，聚簇索引是通过将表的数据行存储在索引树的叶子节点中实现的。这就意味着聚簇索引决定了表中数据行的物理存储顺序。如果一个表有多个聚簇索引，那么就会存在数据行在多个索引树中重复存储，导致数据的冗余和不一致，增加了存储空间和维护成本，并且可能引发查询结果的不确定性和性能下降。所以<strong>一个表只能有一个聚簇索引</strong>。</p></blockquote></li></ul><p><strong>优点</strong></p><p>1）数据访问更快，因为聚簇索引将索引和数据保存在同一个 B+ 树中，因此从聚簇索引中获取数据比非聚簇索引更快</p><p>2）聚簇索引对于主键的排序查找和范围查找速度非常快</p><p><strong>缺点</strong></p><p>1）插入速度严重依赖于插入顺序，按照主键的顺序插入是最快的方式。因此对于 InnoDB 表，一般都会定义一个自增的 ID 列为主键（主键列不要选没有意义的自增列，选经常查询的条件列，否则无法体现其主键索引性能）</p><p>2）更新主键的代价很高，因为将会导致被更新的行移动。对于 InnoDB 表，一般定义主键为不可更新</p><p>3）**二级索引（非聚簇索引）**访问数据需要进行两次索引查找（也就是回表）：第一次找到主键值；第二次根据主键值找到行数据。</p><br><p><strong>主键目录</strong></p><p>每个数据页中有一个最小的主键，每个数据页的页号和最小的主键会组成一个<strong>主键目录</strong>。假设现在要查找主键为 2 的数据，通过二分查找法最后确定下主键为 2 的记录在数据页 1 中，此时就会定位到数据页 1 接着再去定位主键为 2 的记录</p><p><img src="/assets/image-20220210155810732.6ea0ff9a.png" alt="image-20220210155810732"></p><p><strong>索引页</strong></p><blockquote><p>假设有 1000 万条记录、5000 万条记录呢？是不是就算是二分法查找，其效率也依旧是很低的，所以为了解决这种问题 MySQL 又设计出了一种新的存储结构<strong>索引页</strong></p></blockquote><p><img src="/assets/image-20220210160158772.adc429a8.png" alt="image-20220210160158772"></p><p>假设主键目录中的记录是非常非常多的，MySQL 会将里面的记录拆分到不同的索引页中</p><p><img src="/assets/image-20220210160250772.54d56f6c.png" alt="image-20220210160250772"></p><p>索引页中记录的是每页数据页的页号和该数据页中最小的主键的记录，也就是说最小主键和数据页号不是单纯的维护在主键目录中了，而是演变成了索引页，索引页和数据页类似，一张不够存就分裂到下一张。</p><p>像这种<strong>索引页+数据页</strong>组成的组成的 B+ 树就是<strong>聚簇索引</strong>。</p><p><img src="/assets/Snipaste_2022-02-10_21-06-00.647a26af.png" alt="Snipaste_2022-02-10_21-06-00"></p><br><h5 id="非聚簇索引" tabindex="-1"><strong>非聚簇索引</strong> <a class="header-anchor" href="#非聚簇索引" aria-label="Permalink to &quot;**非聚簇索引**&quot;">​</a></h5><blockquote><p>辅助索引/二级索引</p></blockquote><ul><li>B+ 树叶子结点中没包含数据表中行记录的话就是非聚簇索引，索引和数据是分开的</li><li>叶子结点的数据域记录着主键的值，因此在使用辅助索引进行查找时，需要先查找到主键值，再到聚簇索引中进行查找。<strong>一个表可以存在多个非聚簇索引</strong></li><li>辅助索引叶子结点存储的不再是行数据记录，而是主键值。首先通过辅助索引找到主键值，然后到主键索引树中通过主键值找到数据行，这个过程称为<strong>回表</strong></li></ul><p><img src="/assets/image-20210522200620369.433c8d80.png" alt="image-20210522200620369"></p><br><h3 id="覆盖索引" tabindex="-1">覆盖索引 <a class="header-anchor" href="#覆盖索引" aria-label="Permalink to &quot;覆盖索引&quot;">​</a></h3><p><strong>覆盖索引</strong>（Covering Index），或者叫索引覆盖，是一种特殊类型的索引，它包含了查询所需的所有列，从而允许查询直接从索引中获取所需的数据，而无需再去访问实际的数据表。一个索引包含（覆盖）满足查询结果的数据，就叫做覆盖索引。</p><p><strong>查询列被所建的索引覆盖</strong>，<code>select</code> 的数据列就能够从索引中取得，不必读取数据行。MySQL 可以利用索引返回 <code>select</code> 列表中的字段，不必根据索引再次读取数据文件。</p><br><h3 id="存储引擎与索引" tabindex="-1">存储引擎与索引 <a class="header-anchor" href="#存储引擎与索引" aria-label="Permalink to &quot;存储引擎与索引&quot;">​</a></h3><p><strong>InnoDB</strong>，主键索引是聚簇索引，辅助索使用的是非聚簇索引</p><ul><li>InnoDB 主键不宜太大，因为辅助索引也会包含主键列。如果主键定义的比较大，其他索引也将很大。如果想在表上定义很多索引，应该尽量把主键定义得小一些。<strong>InnoDB 不会压缩索引</strong></li><li><strong>InnoDB 表必须要有主键，推荐使用整型自增主键</strong>。InnoDB 中尽量不使用非单调（递增或者递减）字段作主键，因为 InnoDB 数据文件本身是一颗 B+ 树，非单调的主键在插入新记录时数据文件为了维持 B+ 树的特性而频繁的分裂调整</li></ul><p><strong>MyISAM</strong>，非聚簇索引，MyISAM 主索引和辅助索引都是非聚簇索引</p><br><h3 id="索引创建时机" tabindex="-1">索引创建时机 <a class="header-anchor" href="#索引创建时机" aria-label="Permalink to &quot;索引创建时机&quot;">​</a></h3><p><strong>何时创建索引</strong></p><ul><li>主键列，强制该列的唯一性和组织表中数据的排列结构</li><li>经常需要查询的列</li><li>经常用在连接（JOIN）的列，外键字段建立索引，使用索引可以加快连接的速度</li><li>经常需要根据范围（&lt;，&lt;=，=，&gt;，&gt;=，BETWEEN，IN）进行搜索的列上创建索引，因为索引已经排序，其指定的范围是连续的</li><li>经常需要排序（order by）的列上创建索引，因为索引已经排序，查询可以利用索引的排序，加快排序查询时间</li><li>查询中需要统计或者分组的列</li><li>经常使用在 WHERE 子句中的列上面创建索引，加快条件的判断速度</li><li>尽量选择区分度高的列作为索引，公式：<code>count(distinct(column_name)) : count(*)</code>。可以简单地计算出这个字段的离散值，离散值越高，说明建立索引效果更明显。例如给手机号加索引，最后计算出来的离散度是 1，说明非常有必要加索引</li></ul><p><strong>不需创建索引</strong></p><ul><li><p>在查询中很少使用的列不应该创建索引</p><p>若列很少使用到，有无索引，都不能提高查询速度。增加了索引反而增加维护负担和空间需求</p></li><li><p>只有很少数据值或者重复值多的列也不应该增加索引</p><p>例如性别列，在查询的结果中，结果集的数据行占了表中数据行的很大比例，增加索引，并不能明显加快检索速度</p></li><li><p>定义为 <code>text/image/bit</code> 数据类型的列不应该增加索引</p><p>这些列的数据量要么相当大，要么取值很少</p></li><li><p>经常增删改的表，经常需要更新的列，不应该创建索引</p></li></ul><br><h3 id="索引失效场景" tabindex="-1">索引失效场景 <a class="header-anchor" href="#索引失效场景" aria-label="Permalink to &quot;索引失效场景&quot;">​</a></h3><p>1、全表扫描的查询索引失效</p><p>2、查询时带有 <code>is null</code> 条件的语句，会进行全表扫描，无法利用索引。</p><p>因为索引的结构是有序的，遇到 <code>null </code> 值时无法确定它的位置。解决办法是将 <code>null</code> 值转换为其他值，如 0</p><p>3、模糊查询不能利用索引，比如 <code>%like</code> 和 <code>%like%</code></p><p>4、查询带有 <code>or</code> 关键字不走索引，除非将 <code>or</code> 条件中的所有列都创建索引</p><p>5、如果是组合索引，未遵循最左匹配原则不会走索引。比如创建索引 <code>idx_name_age_phone</code>，查询语句为 <code>select * from table where age = 20 and phone = 12345678;</code>，跳过最左边的列，不走索引</p><p>6、如果全表扫描比走索引快，不会走索引</p><p>7、使用不等于条件 <code>!=</code>或者 <code>&lt; &gt;</code>会导致全表扫描</p><p>8、对索引列上的数据做任何操作，如计算，使用函数，类型转换（自动或者手动）等操作会导致索引失效而进行全表扫描</p><br><h2 id="事务" tabindex="-1">事务 <a class="header-anchor" href="#事务" aria-label="Permalink to &quot;事务&quot;">​</a></h2><blockquote><p>事务指一组 SQL 语句的集合，集合中的 SQL 语句可能是 <code>insert/update/select/delete</code>，这些 SQL 语句的执行是一致的，作为一个整体执行，这些 SQL 语句都能成功执行或者都失败</p></blockquote><br><h3 id="四大特性" tabindex="-1">四大特性 <a class="header-anchor" href="#四大特性" aria-label="Permalink to &quot;四大特性&quot;">​</a></h3><blockquote><p>ACID</p></blockquote><p>1、<strong>原子性</strong>（Atomicity）</p><p>事务要么全部提交成功，要么全部失败回滚，不能只执行其中一部分操作</p><p>2、<strong>一致性</strong>（Consistency）</p><ul><li>如果数据库系统在运行过程中发生故障，有些事务尚未完成就被迫中断，未完成的事务对数据库所做的修改已有一部分写入物理数据库，这时数据库就处于一种不正确的状态，也就是不一致的状态</li><li>一致性要求操作前后数据总量不变，事务的执行不能破坏数据库的完整性和一致性，一个事务在执行之前和执行之后，数据库必须处于一致性状态</li></ul><p>3、<strong>隔离性</strong>（Isolation）</p><p>在并发环境中，并发的事务是相互隔离的，一个事务的执行不能被其他事务干扰。不同的事务并发操作相同的数据时，每个事务内部的操作及使用的数据对其他事务是隔离的，并发执行的各个事务之间互不干扰</p><p>4、<strong>持久性</strong>（Durability）</p><ul><li>事务提交之后，数据发生的变化是永久的</li><li>一旦事务提交，它对数据库中对应数据的变更就会永久保存到数据库中，即使发生系统崩溃或者服务器宕机等故障，只要数据库能够重新启动，就能将其恢复到事务成功的状态</li></ul><br><h3 id="隔离级别" tabindex="-1">隔离级别 <a class="header-anchor" href="#隔离级别" aria-label="Permalink to &quot;隔离级别&quot;">​</a></h3><p><strong>查看当前隔离级别</strong></p><div class="language-sql vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">show variables </span><span style="color:#F97583;">like</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;tx_isolation&#39;</span><span style="color:#E1E4E8;">;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">show variables </span><span style="color:#D73A49;">like</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;tx_isolation&#39;</span><span style="color:#24292E;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><br><p><strong>并发事务带来的问题</strong></p><table><thead><tr><th></th><th style="text-align:left;">概念</th><th>产生时机</th><th>解决办法</th></tr></thead><tbody><tr><td>脏读</td><td style="text-align:left;">一个事务正在访问数据，并对数据进行了修改，修改还没有提交到数据库中，此时另一个事务也访问这个数据，并且读取到了数据，读取到了脏数据</td><td>修改</td><td>1、加锁，在读取数据前，对其加锁，阻止其他事务对数据进行修改<br>2、MVVC 加版本号，不用加任何锁， 通过一定机制生成一个数据请求时间点的一致性数据快照 （Snapshot)， 并用这个快照来提供一定级别 （语句级或事务级） 的一致性读取。从用户的角度来看，好象是数据库可以提供同一数据的多个版本</td></tr><tr><td>不可重复读</td><td style="text-align:left;">在一个事务内，多次读同一数据，得到的是不一样的结果。事务 A 多次读取同一数据，事务 B 在事务 A 多次读取的过程中，对数据作了更新并提交，导致事务 A 多次读取同一数据时，结果不一致。</td><td>修改</td><td>同上</td></tr><tr><td>幻读</td><td style="text-align:left;">一个事务 A 读取了几行数据，接着另一个并发事务 B 插入了一些数据时。在随后的查询中，事务 A 就会发现多了一些原本不存在的记录，或者记录少了，就好像发生了幻觉一样，所以称为幻读。</td><td>新增/删除</td><td>同上</td></tr></tbody></table><br><p><strong>隔离级别</strong></p><p>1、<strong>读未提交</strong>（Read Uncommitted）</p><ul><li>隔离级别最低，存在脏读、不可重复读、幻读</li></ul><p>2、<strong>读已提交</strong>（Read Committed）</p><ul><li>读已提交只允许获取已经提交的数据，解决脏读，存在不可重复读、幻读</li><li>不可重复读的重点是修改。同样的条件，读取过的数据，再次读取出来发现值不一样</li></ul><p>3、<strong>可重复读</strong>（Repeatable Read），MySQL 默认隔离级别为可重复读</p><ul><li>可重复读就是保证在事务处理过程中，多次读取同一个数据时，其结果和事务开始时刻读取到的值是一致的。解决脏读和不可重复读，存在幻读</li><li>幻读的重点在于新增或者删除。同样的条件，第 1 次和第 2 次读出来的记录数不一样</li></ul><p>4、<strong>串行化</strong></p><ul><li>最严格的事务隔离级别，它要求所有事务被串行化，即事务只能一个接着一个进行处理，不能并发执行。脏读、不可重复读、幻读都不会出现</li></ul><br><p><strong>各隔离级别对比</strong></p><table><thead><tr><th>隔离级别</th><th>读数据一致性</th><th>脏读</th><th>不可重复读</th><th>幻读</th></tr></thead><tbody><tr><td>读未提交</td><td>最低级别，只能保证不读取物理上损坏的数据</td><td>✔</td><td>✔</td><td>✔</td></tr><tr><td>读已提交</td><td>语句级</td><td>✖</td><td>✔</td><td>✔</td></tr><tr><td>可重复读</td><td>事务级</td><td>✖</td><td>✖</td><td>✔</td></tr><tr><td>串行化</td><td>最高级别，事务级</td><td>✖</td><td>✖</td><td>✖</td></tr></tbody></table><br><h3 id="事务的实现" tabindex="-1">事务的实现 <a class="header-anchor" href="#事务的实现" aria-label="Permalink to &quot;事务的实现&quot;">​</a></h3><br><h4 id="读写锁" tabindex="-1">读写锁 <a class="header-anchor" href="#读写锁" aria-label="Permalink to &quot;读写锁&quot;">​</a></h4><blockquote><p>共享锁，称为读锁；排他锁，称为写锁</p></blockquote><ul><li>读锁是可以共享的，多个读请求可以共享一把锁读数据，不会造成阻塞</li><li>写锁会排斥其他所有获取锁的请求，会一直阻塞，直到写操作完成，释放锁资源</li><li>通过读写锁可以做到读读并行，但是不能做到读写或者写写并行</li><li><strong>实现可重复读</strong></li></ul><br><h4 id="redo-log" tabindex="-1">Redo Log <a class="header-anchor" href="#redo-log" aria-label="Permalink to &quot;Redo Log&quot;">​</a></h4><blockquote><p>重做日志，用来<strong>实现事务的持久性</strong>。分为两部分：重做日志缓冲（redo log buffer）和重做日志文件（redo log），重做日志缓冲在内存中，重做日志文件在磁盘中。<strong>当事务提交之后会把所有修改信息都存放到 redo log 中</strong></p></blockquote><ul><li>MySQL 为了提升性能不会每次都把修改操作实时同步到磁盘中，而是会先将修改操作放到<strong>重做日志缓冲</strong>中，之后再使用后台线程去做缓冲池与磁盘之间的同步</li><li>如果在同步之前发生了宕机，就会丢失部分已提交事务的修改信息。所以使用 redo log 来记录已成功提交事务的修改信息，并且把 redo log 文件持久化到磁盘上，系统重启之后再读取 redo log 恢复最新数据</li><li>redo log 是用来恢复数据的，用于保障已提交事务的持久化特性</li></ul><br><h4 id="undo-log" tabindex="-1">Undo Log <a class="header-anchor" href="#undo-log" aria-label="Permalink to &quot;Undo Log&quot;">​</a></h4><blockquote><p>回滚日志，用于记录数据被修改前的信息。与 redo log 相反，重做日志记录数据被修改后的信息，回滚日志主要记录的是数据的逻辑变化，为了在发生错误时回滚之前的操作，需要将之前的操作都记录下来，然后在发生错误时才可以回滚，是<strong>实现事务的原子性</strong></p></blockquote><ul><li><p>MySQL 每次写入数据或者修改数据之前都会把修改信息记录到 undo log 中</p></li><li><p>每条数据表更（<code>insert/update/delete</code>）操作都伴随着一条 undo log 的生成，并且必须先将修改信息记录到回滚日志，再将数据持久化到磁盘上。</p><p>因为有缓冲池的存在，不用同步持久化，可以异步持久化。先将数据保存到缓冲池中，再将缓冲池中的数据定期保存到磁盘中，降低磁盘 IO 频率，提高性能。</p></li><li><p>undo log 记录事务修改之前版本的数据信息，因此如果系统出现错误或者执行 rollback 操作的话，可以根据 undo log 进行回滚，回到修改前的状态。即根据回滚日志做逆向操作，<code>insert =&gt; delete </code>，<code>update =&gt; update</code>，<code>delete =&gt; insert</code></p></li><li><p>undo log 是用来回滚数据的，用于保障事务的原子性</p></li></ul><br><h4 id="mvcc-多版本并发控制" tabindex="-1">MVCC 多版本并发控制 <a class="header-anchor" href="#mvcc-多版本并发控制" aria-label="Permalink to &quot;MVCC 多版本并发控制&quot;">​</a></h4><blockquote><p>MySQL 的大多数事务型存储引擎实现都不是简单的行级锁。数据库基于提升并发性考虑，一般都同时实现了多版本并发控制（包括 Oracle/PostgreSQL 只是实现机制各不相同）。</p><p>MVCC 实现分为<strong>乐观并发控制和悲观并发控制</strong>。</p></blockquote><p>多版本并发控制（MultiVersion Concurrency Control），通过在每行记录的后面保存两个隐藏的列来实现。</p><p>两个列中，一个保存行的创建时间，一个保存行的过期时间。存储的并不是真实的时间，而是系统版本号（System Version Number）。</p><p>每开始一个新的事务，系统版本号都会自动递增。事务开始时刻的系统版本号会作为事务的版本号，用来和查询到的每行记录的版本号进行比较。</p><p>可以认为 MVCC 是行级锁的一个变种，但它在很多情况下避免了加锁操作，因此开销更低。虽然实现机制有所不同，但大都实现了非阻塞的读操作，写操作也只是锁定必要的行。</p><p>MVCC 的实现是通过保存数据在某个时间点的快照来实现的。不管需要执行多长时间，每个事物看到的数据都是一致的。</p><p>保存这两个额外系统版本号，使大多数操作都不用加锁。使数据操作简单，性能很好，并且也能保证只会读取到符合要求的行。不足之处是每行记录都需要额外的存储空间，需要做更多的行检查工作和一些额外的维护工作。</p><p><strong>MVCC 只在 COMMITTED READ（读已提交）和 REPEATABLE READ（可重复读）两种隔离级别下工作。</strong></p><p>MVCC 在 MySQL 中的实现需要依赖 undo log 和 read view：</p><ul><li>undo log，记录某行记录的多个版本的数据</li><li>read view，用来判断当前版本数据的可见性</li></ul><ul><li>事务的隔离性是通过读写锁 + MVCC 来实现的</li><li>事物的一致性是通过持久性 + 原子性 + 隔离性来实现的</li></ul><br><h3 id="分布式事务" tabindex="-1">分布式事务 <a class="header-anchor" href="#分布式事务" aria-label="Permalink to &quot;分布式事务&quot;">​</a></h3><blockquote><p>分布式事务指事务的参与者、支持事务的服务器、资源服务器以及事务管理器分别位于不同的分布式系统的不同节点上。</p><p>简单的说，就是一次大的操作由不同的小操作组成，这些小的操作分布在不同的服务器上，且属于不同的应用，分布式事务需要保证这些小操作要么全部成功，要么全部失败。</p><p>本质上来说，分布式事务就是为了保证不同数据库的数据一致性。比如微服务电商交易、跨行转账等。</p><p>分布式事务的实现方式有很多，既可以采用 InnoDB 提供的原生的事务支持，也可以采用消息队列来实现分布式事务的最终一致性。</p></blockquote><br><blockquote><p><strong>CAP 理论</strong></p><p>不同于本地事务的 ACID 特性，分布式事务主要特性为 <strong>CAP</strong></p><ul><li><p><strong>C（一致性）</strong></p><p>对某个指定的客户端来说，读操作能返回最新的写操作。对于数据分布在不同节点上的数据上来说，如果在某个节点更新了数据，那么在其他节点如果都能读取到这个最新的数据，那么就称为强一致，如果有某个节点没有读取到，那就是分布式不一致。</p></li><li><p><strong>A（可用性</strong>）</p><p>非故障的节点在合理的时间内返回合理的响应（不是错误和超时的响应）。可用性的两个关键：一个是合理的时间，一个是合理的响应。</p><p>合理的时间指的是请求不能无限被阻塞，应该在合理的时间返回。合理的响应指的是请求应该得到明确并正确的返回结果，这里的正确指的是比如应该返回 200，而不是返回 404。</p></li><li><p><strong>P（分区容错性）</strong></p><p>当出现网络分区后，系统能够继续工作。比如，在一个服务集群中，有一个服务网络出现了问题，但是这个集群仍然可以正常工作</p></li></ul><p>CAP 三者不能同时存在，只能满足 AP 或者 CP 原则。因为在分布式系统中，网络不是 100% 可靠，分区（服务集群）其实是一个必然现象，必定需要满足 P；</p><p>对于 CP 来说，就是追求强一致性和分区容错性，放弃高可用。对于 AP 来说，就是追求分区容错性和可用性，放弃一致性（强一致性)，AP 是很多分布式系统设计时的选择；</p><p>注意：AP 或 CP 不是说要放弃 C 或者放弃 A，而是需要使用一些别的手段来保证 C （比如日志）或者 A （快速失败机制、快速响应机制）。</p></blockquote><br><blockquote><p><strong>BASE 理论</strong></p><p>BASE 是 Basically Available（基本可用）、Soft state（软状态）和 Eventually consistent （最终一致性）三个短语的缩写，是对 CAP 中 AP 的一个扩展</p><ul><li>基本可用，分布式系统在出现故障时，允许损失部分可用功能，保证核心功能可用</li><li>软状态，允许系统中存在中间状态，这个状态不影响系统可用性，这里指的是 CAP 中的不一致</li><li>最终一致性，最终一致是指经过一段时间后，所有节点数据都将会达到一致</li></ul><p>BASE 和 ACID 是相反的，它完全不同于 ACID 的强一致性模型，而是通过牺牲强一致性来获得可用性，并允许数据在一段时间内是不一致的，但最终达到一致状态</p></blockquote><br><h4 id="_2pc" tabindex="-1">2PC <a class="header-anchor" href="#_2pc" aria-label="Permalink to &quot;2PC&quot;">​</a></h4><blockquote><p><strong>两段提交（2PC）<strong>基于 <strong>XA 协议</strong>实现的分布式事务，XA 协议中分为两部分：<strong>事务管理器/事务协调者</strong>和</strong>本地资源管理器</strong>。其中事务管理器则作为一个全局的调度者，本地资源管理器往往由数据库实现。</p></blockquote><blockquote><p><strong>2PC 流程</strong></p><p>2PC 分为两个阶段：<strong>准备和提交</strong>。</p><ul><li><p>第一个阶段，由事务协调者给每个参与者发送准备命令，每个参与者收到命令之后会执行相关事务操作。可以认为除了事务的提交，其他关于事务的操作都做了，然后每个参与者会返回响应告知协调者自己是否准备成功</p><p>在 2PC 中事务协调者有超时机制，若是事务协调者在第一阶段未收到个别参与者的响应，等待一定时间后就会认为事务失败，会发送回滚命令</p></li><li><p>协调者收到每个参与者的响应之后就进入第二阶段，根据收集的响应，如果有一个参与者响应准备失败那么就向所有参与者发送回滚命令，反之发送提交命令。</p></li></ul></blockquote><blockquote><p><strong>优点</strong></p><p>2PC 对业务侵⼊很小，它最⼤的优势就是对使⽤⽅透明，用户可以像使⽤本地事务⼀样使⽤基于 XA 协议的分布式事务，能够严格保障事务 ACID 特性。</p><p><strong>缺点</strong></p><ul><li>它是一个强一致性的<strong>同步阻塞</strong>协议，事务执⾏过程中需要将所需资源全部锁定（刚性事务）。它比较适⽤于执⾏时间确定的短事务，整体性能比较差。</li><li><strong>单点故障问题</strong>，一旦事务协调者出现故障，事务参与者会一直处于锁定资源的状态，或者只有一部分参与者提交成功，导致数据的不一致。因此，在⾼并发性能⾄上的场景中，基于 XA 协议的分布式事务并不是最佳选择。</li></ul></blockquote><br><h4 id="_3pc" tabindex="-1">3PC <a class="header-anchor" href="#_3pc" aria-label="Permalink to &quot;3PC&quot;">​</a></h4><blockquote><p>**三段提交（3PC）**是 2PC 的一种改进版本，为解决两阶段提交协议的阻塞问题，2PC 当协调者崩溃时，参与者不能做出最后的选择，就会一直保持阻塞锁定资源。</p><p>2PC 中只有协调者有超时机制，3PC 在协调者和参与者中都引入了超时机制，协调者出现故障后，参与者不会一直阻塞。而且在第一阶段和第二阶段中又插入了一个预提交阶段，保证了在最后提交阶段之前各参与节点的状态是一致的。</p></blockquote><blockquote><p><strong>3PC 流程</strong></p><p>3PC 分为三个阶段：<strong>准备、预提交和提交</strong></p><ul><li><p>准备阶段就是协调者去访问参与者，查看是否能接受事务请求，进行事务操作。如果全部响应成功则进入下一阶段。</p></li><li><p>预提交阶段，协调者向所有参与者发送预提交命令，询问是否可以进行事务的预提交操作。参与者接收到预提交请求后，如果成功的执行了事务操作，则返回成功响应，进入最终提交阶段。一旦有参与者中有向协调者发送了失败响应，或因网络造成超时，协调者没有收到该参与者的响应，协调者向所有参与者发送 <code>abort</code> 请求，参与者收到 <code>abort</code> 命令后中断事务的执行。</p></li><li><p>提交阶段，如果前两个阶段中所有参与者的响应反馈均是 <code>YES</code>，协调者向所有参与者发送提交命令正式提交事务，如协调者没有接收到参与者发送的 <code>ACK</code> 响应，会向所有参与者发送 <code>abort</code> 请求命令，执行事务的中断。</p></li></ul></blockquote><blockquote><p><strong>优缺点</strong></p><p>虽然 3PC 用超时机制解决了协调者故障后参与者的阻塞问题，但也多了一次网络通信，性能上反而变得更差</p></blockquote><br><h4 id="tcc" tabindex="-1">TCC <a class="header-anchor" href="#tcc" aria-label="Permalink to &quot;TCC&quot;">​</a></h4><blockquote><p>TCC（Try-Confirm-Cancel）又称<strong>补偿事务</strong>，与 2PC 相似，事务处理流程也很相似，但 2PC 是应用于在数据库层面，TCC 则可以理解为在应用层面的 2PC，需要自定义编写业务逻辑来实现。</p><p>TCC 核心思想是：<strong>针对每个操作（Try）都要注册一个与其对应的确认（Confirm）和补偿（Cancel）</strong>。</p></blockquote><blockquote><p><strong>TCC 流程</strong></p><p>TCC 的实现分为<strong>两个阶段</strong>，需要在业务层面需要写对应的<strong>三个方法</strong>（Try、Confirm、Cancel），主要用于跨数据库、跨服务的业务操作的数据一致性问题。</p><ul><li><p>第一阶段是<strong>资源检查预留阶段</strong>即 Try，尝试执行，完成所有业务检查（一致性），预留必须业务资源（准隔离性）</p></li><li><p>第二阶段是 Confirm 或 Cancel。</p><p>Confirm 执行真正的业务操作，Cancel 执行预留资源的取消，回滚到初始状态。</p><p>以下单扣库存为例，Try 阶段去占库存，Confirm 阶段则实际扣库存，如果库存扣减失败 Cancel 阶段进行回滚，释放库存。</p></li></ul></blockquote><blockquote><p><strong>TCC 注意点</strong></p><ul><li><strong>幂等问题</strong>，因为网络调用无法保证请求一定能到达，所以都会有重调机制，因此对于 Try、Confirm、Cancel 三个方法都需要幂等实现，避免重复执行产生错误；</li><li><strong>空回滚问题</strong>，指的是 Try 方法由于网络问题超时了，此时事务管理器就会发出 Cancel 命令，那么需要支持在未执行 Try 的情况下能正常的 Cancel；</li><li><strong>悬挂问题</strong>，指 Try 方法由于网络阻塞超时触发了事务管理器发出了 Cancel 命令，<strong>但是执行了 Cancel 命令之后 Try 请求到了</strong>。对于事务管理器来说这时候事务已经是结束了的，到达的 Try 操作就被<strong>悬挂</strong>了，所以空回滚之后还需要将操作记录，防止 Try 的再调用。</li></ul></blockquote><blockquote><p><strong>TCC 优缺点</strong></p><p>TCC <strong>不存在资源阻塞的问题</strong>，因为每个方法都直接进行事务的提交，一旦出现异常通过则 Cancel 来进行回滚补偿，这也就是常说的补偿性事务。</p><p>TCC <strong>对业务的侵入性很强</strong>，原本一个方法，现在需要三个方法来支持，而且这种模式并不能很好地被复用，会导致开发量激增。还要考虑到网络波动等原因，为保证请求一定送达都会有重试机制。</p><p>TCC 适用于一些强隔离性和强一致性，并且执行时间较短的业务。</p></blockquote><br><h4 id="本地消息表" tabindex="-1">本地消息表 <a class="header-anchor" href="#本地消息表" aria-label="Permalink to &quot;本地消息表&quot;">​</a></h4><blockquote><p>本地消息就是利用了<strong>本地事务</strong>，在数据库中存放一个本地事务消息表，在进行本地事务操作时加入了本地消息的插入，<strong>业务执行和消息放入消息表这两个操作放在同一个事务中提交</strong>。</p><p>本地事务执行成功的话，消息肯定也插入成功。然后再调用其他服务，如果调用成功就修改这条本地消息的状态。<strong>核心思路是将分布式事务拆分成本地事务进行处理，并通过消息的方式来异步执行。</strong></p><p>通过在事务发起方新建事务消息表，事务发起方处理业务和记录事务消息在本地事务中完成，轮询事务消息表的数据发送事务消息，事务被动方基于消息中间件消费事务消息表中的事务。这样可以避免以下两种情况导致的数据不一致性：业务处理成功、事务消息发送失败；业务处理失败、事务消息发送成功。</p></blockquote><br><h3 id="mysql-分布式事务" tabindex="-1">MySQL 分布式事务 <a class="header-anchor" href="#mysql-分布式事务" aria-label="Permalink to &quot;MySQL 分布式事务&quot;">​</a></h3><p>MySQL 从 5.0.3 开始，InnoDB 存储引擎支持 XA 协议的分布式事务。一个分布式事务会涉及多个行动，这些行动本身是事务性的。所有行动都必须一起成功完成，或者一起被回滚。在 MySQL 中，使用分布式事务涉及一个或多个<strong>资源管理器</strong>和一个<strong>事务管理器</strong>。</p><p><img src="/assets/image-20220211141428327.2c130799.png" alt="image-20220211141428327"></p><p>如图，MySQL 的分布式事务模型。模型中分三块：应用程序（AP）、资源管理器（RM）、事务管理器（TM）:</p><ul><li>应用程序：定义了事务的边界，指定需要做哪些事务；</li><li>资源管理器：提供了访问事务的方法，通常一个数据库就是一个资源管理器；</li><li>事务管理器：协调参与了全局事务中的各个事务。</li></ul><p>分布式事务采用**两段式提交（Two-phase Commit）**的方式：</p><ul><li>第一阶段所有的事务结点开始准备，告诉事务管理器自己处于<em>准备状态</em>。</li><li>第二阶段事务管理器告诉每个结点是 commit 还是 rollback。如果有一个结点失败，就需要全局的结点全部 rollback，以此保障事务的原子性。</li></ul><br><h2 id="持久化" tabindex="-1">持久化 <a class="header-anchor" href="#持久化" aria-label="Permalink to &quot;持久化&quot;">​</a></h2><h3 id="存储位置" tabindex="-1">存储位置 <a class="header-anchor" href="#存储位置" aria-label="Permalink to &quot;存储位置&quot;">​</a></h3><ul><li><p>磁盘</p><p>从磁盘上读写数据，至少需要两次 IO 请求才能完成：一次是读 IO，另一次是写 IO。而 IO 请求是比较耗时的操作，如果频繁的进行 IO 请求会影响数据库的性能。</p></li><li><p>寄存器</p><p>离 CPU 最近，从寄存器中读取数据是最快的，但是寄存器只能存储非常少量的数据，设计它的目的主要是用来暂存指令和地址，并非存储大量用户数据的。</p></li><li><p>内存</p><p>内存同样能满足快速读取和写入数据的需求，但是相对于磁盘来说，成本更加昂贵。一般只存储一部分用户数据，而非全部数据。此外，即使用户数据能刚好存储在内存，若是数据库出现故障或者重启，数据就会丢失。</p></li></ul><blockquote><p>如何存储数据才能不会因为异常情况而丢数据，同时又能保证数据的读写速度？MySQL 的 InnoDB 存储引擎使用<strong>数据页</strong>来进行数据存储</p></blockquote><br><h3 id="innodb-内存区域" tabindex="-1">InnoDB 内存区域 <a class="header-anchor" href="#innodb-内存区域" aria-label="Permalink to &quot;InnoDB 内存区域&quot;">​</a></h3><blockquote><p>InnoDB 内存的两个主要区域分别为 <strong>Buffer Pool</strong> 和 <strong>Log Buffer</strong>。</p><ul><li>Buffer Pool 是 InnoDB 的核心部分，位于主存</li><li>Log Buffer 是用于缓存 <strong>Redo Log</strong></li></ul></blockquote><h4 id="buffer-pool" tabindex="-1">Buffer Pool <a class="header-anchor" href="#buffer-pool" aria-label="Permalink to &quot;Buffer Pool&quot;">​</a></h4><p>MySQL 中的很多的操作都是发生在内存，再从内存将文件保存到磁盘上，可使用的内存大小就决定操作效率高低。</p><p>由于缓存的数据类型和数据量非常多，Buffer Pool 存储时会按照某些结构去存储。Buffer Pool 被分成了很多页，每页可以存放很多数据，称为<strong>数据页</strong>。数据页是 InnoDB 中<strong>管理数据的最小单元</strong>。</p><p>InnoDB 使用<strong>链表</strong>来组织数据页和管理页数据，页与页之间形成<strong>双向链表</strong>，并使用 LRU（Least Recently Used）算法淘汰不经常使用的数据。</p><p><img src="/assets/image-20220209143322448.ce48c613.png" alt="image-20220209143322448"></p><p>同时，页数据通过<strong>单向链表</strong>进行链接。因为这些数据是分散在 Buffer Pool 中的，单向链表可以将这些分散的内存连接起来。</p><p><img src="/assets/image-20220209143313364.350c6838.png" alt="image-20220209143313364"></p><p>到这里可能有一个疑问，用户记录里是单链表。最坏的情况下，需要的数据可能在链表末端，此时查询数据就比较低效。为了解决这个问题，MySQL 又在页中加入 <strong>Page Directory</strong>。</p><img src="/assets/image-20220209164327501.ff3f25d9.png" alt="image-20220209164327501"><p>Page Directory 是个目录，里面有多个<strong>槽位（Slot）</strong>，每一个槽位都指向一条 <strong>User Records</strong>。并且每隔几条数据，就会创建一个槽位。在一个完整的页中，<strong>每隔 6 条数据就会有一个槽位。</strong></p><p>MySQL 在新增数据时就将对应的 Slot 创建好，有了 Page Directory ，就可以对一张页的数据进行粗略的<strong>二分查找</strong>。</p><p>为什么是粗略？因为 Page Directory 中包含的不是完整的数据，二分查找出来的结果只能是个大概的位置，找到了这个大概的位置之后，还需要回到 User Records 中继续的进行遍历。</p><p><img src="/assets/image-20220209164453734.d9bd0e5a.png" alt="image-20220209164453734"></p><br><h4 id="log-buffer" tabindex="-1">Log Buffer <a class="header-anchor" href="#log-buffer" aria-label="Permalink to &quot;Log Buffer&quot;">​</a></h4><p>Log Buffer 用来存储即将被刷入到磁盘文件中的日志，例如 Redo Log。。Log Buffer 的默认值为 16M，可以通过配置参数 <code>innodb_log_buffer_size</code> 来进行调整。</p><p>Log Buffer 越大，就可以存储越多的 Redo Log。这样一来在事务提交之前就不需要将 Redo Log 刷入磁盘，只需要放到 Log Buffer 中。因此较大的 Log Buffer 就可以更好的支持较大的事务运行；如果有事务会大量的更新、插入或者删除行，那么适当的增大 Log Buffer 的大小，也可以有效的减少磁盘 IO 操作。</p><p>Log Buffer 中的数据刷入到磁盘的频率可以通过参数 <code>innodb_flush_log_at_trx_commit</code> 来指定。</p><br><h3 id="数据读写操作" tabindex="-1">数据读写操作 <a class="header-anchor" href="#数据读写操作" aria-label="Permalink to &quot;数据读写操作&quot;">​</a></h3><h4 id="写操作" tabindex="-1">写操作 <a class="header-anchor" href="#写操作" aria-label="Permalink to &quot;写操作&quot;">​</a></h4><p>进行写操作时，可以把一批数据放在一起，先将数据写到内存的某个批次中，再将该批次的数据一次性刷到磁盘上。</p><img src="/assets/写操作.72bbf013.jpeg" alt="写操作" style="zoom:67%;"><h4 id="读操作" tabindex="-1">读操作 <a class="header-anchor" href="#读操作" aria-label="Permalink to &quot;读操作&quot;">​</a></h4><p>读操作先从磁盘上读一批数据，再加载到内存当中，然后在内存中操作。</p><img src="/assets/读操作.ad4ed787.jpeg" alt="读操作" style="zoom:67%;"><blockquote><p>将内存中的数据刷到磁盘，或者将磁盘中的数据加载到内存，都是以批次为单位，这个批次就是我们常说的：数据页。InnoDB 中存在多种不同类型的页，数据页只是其中一种。</p></blockquote><p>磁盘中各数据页的整体结构如下图所示：</p><img src="/assets/image-20211124104015806.ba1bb6b6.png" alt="image-20211124104015806" style="zoom:33%;"><p>通常情况下，单个数据页默认的大小是 <code>16kb</code>。也可以通过参数 <code> innodb_page_size</code>，来重新设置大小。</p><br><h3 id="数据页结构" tabindex="-1">数据页结构 <a class="header-anchor" href="#数据页结构" aria-label="Permalink to &quot;数据页结构&quot;">​</a></h3><img src="/assets/image-20211124104031229.a8b79ad3.png" alt="image-20211124104031229" style="zoom:33%;"><p>数据页主要包含：文件头部、页头部、最大和最小记录、用户记录、空闲空间、页目录、文件尾部。</p><h4 id="文件头部" tabindex="-1">文件头部 <a class="header-anchor" href="#文件头部" aria-label="Permalink to &quot;文件头部&quot;">​</a></h4><p>其中 4 个最关键的信息：页号、上一页号、下一页号、页类型。InnoDB 是通过页号、上一页号和下一页号来串联不同数据页的。</p><img src="/assets/image-20211124104251227.73783441.png" alt="image-20211124104251227" style="zoom:33%;"><p>不同的数据页之间，通过上一页号和下一页号构成<strong>双向链表</strong>。通过文件头部包含的多个信息，MySQL 能够轻松访问不同数据页。</p><br><h4 id="页头部" tabindex="-1">页头部 <a class="header-anchor" href="#页头部" aria-label="Permalink to &quot;页头部&quot;">​</a></h4><blockquote><p>包含数据页的信息，比如一页数据保存多少条记录，页目录到底使用了多个槽等。同时还记录：已删除记录所占的字节数、最后插入记录的位置、最大事务 id、索引 id、索引层级</p></blockquote><br><h4 id="最大最小记录" tabindex="-1">最大最小记录 <a class="header-anchor" href="#最大最小记录" aria-label="Permalink to &quot;最大最小记录&quot;">​</a></h4><p>MySQL 在保存用户记录的同时，数据库会自动创建两条额外的记录：最小记录 Infimum 和最大记录 Supremum。</p><img src="/assets/最大和最小记录.04c51606.jpeg" alt="最大和最小记录" style="zoom:50%;"><p>在一个数据页中，如果存在多条用户记录，从最小记录开始通过<em>下一条记录</em>相连，一直到最大纪录。</p><p>有了最小最大记录 ，查询不需要将某一页的 User Records 全部遍历，只需要将这最小最大记录和待查询的目标记录进行比较。</p><p>如下图所示，要查询的数据 <code>id = 101</code> ，明显不在当前页。就可以通过下一页指针跳到下页进行检索。</p><img src="/assets/image-20220209163559367.f3524a1d.png" alt="image-20220209163559367" style="zoom:80%;"><br><h4 id="用户记录" tabindex="-1">用户记录 <a class="header-anchor" href="#用户记录" aria-label="Permalink to &quot;用户记录&quot;">​</a></h4><p>对于新申请的数据页，用户记录是空的。当插入数据时，InnoDB 会将一部分<em>空闲空间</em>分配给用户记录。</p><p>InnoDB 支持的用户记录数据行格式为：</p><ul><li>compact 行格式</li><li>redundant 行格式</li><li>dynamic 行格式</li><li>compressed 行格式</li></ul><br><p>以 compact 行格式为例：</p><p><img src="/assets/image-20211124104139424.09105147.png" alt="image-20211124104139424"></p><p>用户记录主要包含三部分内容：</p><ol><li>记录额外信息，它包含了变长字段、null 值列表和记录头信息</li><li>隐藏列，它包含了行 id、事务 id 和回滚点</li><li>真正的数据列，包含真正的用户数据，可以有很多列</li></ol><br><p><strong>额外信息</strong></p><blockquote><p>额外信息并非真正的用户数据，它是为了辅助存数据用的。</p></blockquote><p>1）变长字段列表</p><p>有些数据如果直接存会有问题，比如：如果某个字段是 varchar 或 text 类型，它的长度不固定，可以根据存入数据的长度不同，而随之变化。</p><p>如果不记录数据真正的长度，InnoDB 不知道要分配多少空间。假如都按某个固定长度分配空间，但实际数据又没占多少空间，就会造成空间利用的浪费。所以需要在变长字段中记录某个变长字段占用的字节数，方便按需分配空间。</p><p>2）null 值列表</p><p>数据库中有些字段的值允许为 null，如果把每个字段的 null 值，都保存到用户记录中，显然有些浪费存储空间。</p><blockquote><p>有没有办法只简单的标记一下，不存储实际的 null 值呢？</p></blockquote><p>将为 null 的字段保存到 null 值列表。在列表中用二进制的值 1，表示该字段允许为 null，用 0 表示不允许为 null。只占用了 1 位，就能表示某个字符是否为 null，可以节省很多存储空间。</p><p>3）记录头信息</p><p>记录头信息用于描述一些特殊的属性。</p><p><img src="/assets/image-20211124104406690.09258e4b.png" alt="image-20211124104406690"></p><p>它主要包含：</p><ul><li>deleted_flag，删除标记，用于标记该记录是否被删除了。</li><li>min_rec_flag，最小目录标记，它是非叶子结点中的最小目录标记。</li><li>n_owned，拥有的记录数，记录该组索引记录的条数。</li><li>heap_no，堆上的位置，它表示当前记录在堆上的位置。</li><li>record_type，记录类型，其中：0 表示普通记录，1 表示非叶子结点，2 表示 Infrimum 记录， 3 表示 Supremum 记录。</li><li>next_record，下一条记录的位置。</li></ul><br><p><strong>隐藏列</strong></p><p>数据库在保存一条用户记录时，会自动创建一些隐藏列。如下图所示：</p><img src="/assets/image-20211124104430681.25510d02.png" alt="image-20211124104430681" style="zoom:50%;"><p>目前 InnoDB 自动创建的隐藏列有三种：</p><p>1）db_row_id，行 id，它是一条记录的唯一标识。</p><p>如果表中有主键，则用主键做行 id，无需额外创建。如果表中没有主键，假如有不为 null 的 unique 唯一键，则用它做为行 id，同样无需额外创建。如果表中既没有主键，又没有唯一键，则数据库会自动创建行 id。在 innodb中，隐藏列中 <code>事务 id</code>和 <code>回滚点</code>是一定会被创建的，但行 id 要根据实际情况决定。</p><p>2）db_trx_id，事务 id，它是事务的唯一标识。</p><p>3）db_roll_ptr，回滚点，它用于事务回滚。</p><p><strong>真正数据列</strong></p><p>真正的数据列中存储了用户的真实数据，它可以包含很多列的数据。</p><p><strong>用户记录是如何相连的？</strong></p><p><code>记录额外信息 ==&gt; 记录头信息 ==&gt;下一条记录的位置</code></p><img src="/assets/用户记录.7a486dda.png" alt="用户记录" style="zoom:50%;"><p>多条用户记录之间通过<em>下一条记录的位置</em>，组成了一个单向链表。</p><br><h4 id="空闲空间" tabindex="-1">空闲空间 <a class="header-anchor" href="#空闲空间" aria-label="Permalink to &quot;空闲空间&quot;">​</a></h4><p>最开始的时候用户记录是空的，当插入数据的时候就会向空闲空间中申请空间，当无可用空闲空间，则需要申请新的页</p><br><h4 id="页目录" tabindex="-1">页目录 <a class="header-anchor" href="#页目录" aria-label="Permalink to &quot;页目录&quot;">​</a></h4><blockquote><p>Page Directory</p></blockquote><br><h4 id="文件尾部" tabindex="-1">文件尾部 <a class="header-anchor" href="#文件尾部" aria-label="Permalink to &quot;文件尾部&quot;">​</a></h4><blockquote><p>防止页在刷入磁盘的过程中，由于意外情况导致失败，造成数据不一致的情况（形成<strong>脏页</strong>）</p></blockquote><p>数据库的数据是以数据页为单位，加载到内存中。如果数据有更新的话，需要刷新到磁盘上。如果数据在刷新到磁盘的过程中出现了异常，比如进程被关闭或者服务被重启，这时数据可能只刷新了一部分。如何判断上次刷盘的数据是完整的呢？这就需要用到<em>文件尾部</em>。它记录了页面的<em>校验和 (checksum)</em>。</p><p>在数据刷新到磁盘之前，会先计算页面的校验和。后面如果数据有更新，会计算一个新校验和。文件头部和尾部都会记录这个校验和。</p><p>由于文件头部在前面，会先被刷新到磁盘上。刷新页数据到磁盘时，假设刷新了一部分就出现异常。这时文件尾部的校验和还是一个旧值。数据库会去校验文件尾部的校验和，如果不等于文件头部的值，说明该数据页的数据是不完整的。</p><br><h2 id="主从配置" tabindex="-1">主从配置 <a class="header-anchor" href="#主从配置" aria-label="Permalink to &quot;主从配置&quot;">​</a></h2><p><strong>主库写入，从库读取</strong></p><blockquote><p>使用 Docker，MySQL 版本 5.7.28</p></blockquote><p>1、新建启动 master</p><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">docker</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">run</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-d</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--name</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">mysql-master</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-p</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">3306</span><span style="color:#9ECBFF;">:3306</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-e</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">MYSQL_ROOT_PASSWORD=</span><span style="color:#79B8FF;">123456</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-v</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/mydata/mysql/master/log:/var/log/mysql</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-v</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/mydata/mysql/master/data:/var/lib/mysql</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-v</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/mydata/mysql/master/conf:/etc/mysql</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">mysql:5.7.28</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">docker</span><span style="color:#24292E;"> </span><span style="color:#032F62;">run</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-d</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--name</span><span style="color:#24292E;"> </span><span style="color:#032F62;">mysql-master</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-p</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">3306</span><span style="color:#032F62;">:3306</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-e</span><span style="color:#24292E;"> </span><span style="color:#032F62;">MYSQL_ROOT_PASSWORD=</span><span style="color:#005CC5;">123456</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-v</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/mydata/mysql/master/log:/var/log/mysql</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-v</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/mydata/mysql/master/data:/var/lib/mysql</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-v</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/mydata/mysql/master/conf:/etc/mysql</span><span style="color:#24292E;"> </span><span style="color:#032F62;">mysql:5.7.28</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>2、在 <code>/mydata/mysql/master/conf</code> 目录下编辑 <code>my.cnf</code></p><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[client]</span></span>
<span class="line"><span style="color:#E1E4E8;">default-character-set</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">utf8</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">[mysql]</span></span>
<span class="line"><span style="color:#E1E4E8;">default-character-set</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">utf8</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">[mysqld]</span></span>
<span class="line"><span style="color:#E1E4E8;">init_connect</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&#39;SET collation_connection = utf8_unicode_ci&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">init_connect</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&#39;SET NAMES utf8&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">character-set-server</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">utf8</span></span>
<span class="line"><span style="color:#E1E4E8;">collation-server</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">utf8_unicode_ci</span></span>
<span class="line"><span style="color:#B392F0;">skip-character-set-client-handshake</span></span>
<span class="line"><span style="color:#6A737D;"># skip-name-resolve</span></span>
<span class="line"><span style="color:#6A737D;"># 为了加快和 mysql 数据库的连接速度</span></span>
<span class="line"><span style="color:#B392F0;">skip-name-resolve</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 设置服务 id</span></span>
<span class="line"><span style="color:#E1E4E8;">server_id</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">1</span></span>
<span class="line"><span style="color:#6A737D;"># 开启 binlog</span></span>
<span class="line"><span style="color:#E1E4E8;">log-bin</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">mysql-bin</span></span>
<span class="line"><span style="color:#6A737D;"># master 关闭只读模式</span></span>
<span class="line"><span style="color:#E1E4E8;">read-only</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">0</span></span>
<span class="line"><span style="color:#6A737D;"># 设置同步库</span></span>
<span class="line"><span style="color:#E1E4E8;">binlog-do-db</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">db_sync_1</span></span>
<span class="line"><span style="color:#E1E4E8;">binlog-do-db</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">db_sync_2</span></span>
<span class="line"><span style="color:#E1E4E8;">binlog-do-db</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">db_sync_3</span></span>
<span class="line"><span style="color:#E1E4E8;">binlog-do-db</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">db_sync_4</span></span>
<span class="line"><span style="color:#E1E4E8;">binlog-do-db</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">db_sync_5</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 设置忽略同步的库</span></span>
<span class="line"><span style="color:#E1E4E8;">replicate-ignore-db</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">mysql</span></span>
<span class="line"><span style="color:#E1E4E8;">replicate-ignore-db</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">sys</span></span>
<span class="line"><span style="color:#E1E4E8;">replicate-ignore-db</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">information_schema</span></span>
<span class="line"><span style="color:#E1E4E8;">replicate-ignore-db</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">performance_schema</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[client]</span></span>
<span class="line"><span style="color:#24292E;">default-character-set</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">utf8</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">[mysql]</span></span>
<span class="line"><span style="color:#24292E;">default-character-set</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">utf8</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">[mysqld]</span></span>
<span class="line"><span style="color:#24292E;">init_connect</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&#39;SET collation_connection = utf8_unicode_ci&#39;</span></span>
<span class="line"><span style="color:#24292E;">init_connect</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&#39;SET NAMES utf8&#39;</span></span>
<span class="line"><span style="color:#24292E;">character-set-server</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">utf8</span></span>
<span class="line"><span style="color:#24292E;">collation-server</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">utf8_unicode_ci</span></span>
<span class="line"><span style="color:#6F42C1;">skip-character-set-client-handshake</span></span>
<span class="line"><span style="color:#6A737D;"># skip-name-resolve</span></span>
<span class="line"><span style="color:#6A737D;"># 为了加快和 mysql 数据库的连接速度</span></span>
<span class="line"><span style="color:#6F42C1;">skip-name-resolve</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 设置服务 id</span></span>
<span class="line"><span style="color:#24292E;">server_id</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">1</span></span>
<span class="line"><span style="color:#6A737D;"># 开启 binlog</span></span>
<span class="line"><span style="color:#24292E;">log-bin</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">mysql-bin</span></span>
<span class="line"><span style="color:#6A737D;"># master 关闭只读模式</span></span>
<span class="line"><span style="color:#24292E;">read-only</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">0</span></span>
<span class="line"><span style="color:#6A737D;"># 设置同步库</span></span>
<span class="line"><span style="color:#24292E;">binlog-do-db</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">db_sync_1</span></span>
<span class="line"><span style="color:#24292E;">binlog-do-db</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">db_sync_2</span></span>
<span class="line"><span style="color:#24292E;">binlog-do-db</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">db_sync_3</span></span>
<span class="line"><span style="color:#24292E;">binlog-do-db</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">db_sync_4</span></span>
<span class="line"><span style="color:#24292E;">binlog-do-db</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">db_sync_5</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 设置忽略同步的库</span></span>
<span class="line"><span style="color:#24292E;">replicate-ignore-db</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">mysql</span></span>
<span class="line"><span style="color:#24292E;">replicate-ignore-db</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">sys</span></span>
<span class="line"><span style="color:#24292E;">replicate-ignore-db</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">information_schema</span></span>
<span class="line"><span style="color:#24292E;">replicate-ignore-db</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">performance_schema</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><p>3、重启 master 镜像</p><p>4、新建启动 slave</p><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">docker</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">run</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-d</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--name</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">mysql-slaver-01</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-p</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">3316</span><span style="color:#9ECBFF;">:3306</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-e</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">MYSQL_ROOT_PASSWORD=</span><span style="color:#79B8FF;">123456</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-v</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/mydata/mysql/slaver/log:/var/log/mysql</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-v</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/mydata/mysql/slaver/data:/var/lib/mysql</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-v</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/mydata/mysql/slaver/conf:/etc/mysql</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">mysql:5.7.28</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">docker</span><span style="color:#24292E;"> </span><span style="color:#032F62;">run</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-d</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--name</span><span style="color:#24292E;"> </span><span style="color:#032F62;">mysql-slaver-01</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-p</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">3316</span><span style="color:#032F62;">:3306</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-e</span><span style="color:#24292E;"> </span><span style="color:#032F62;">MYSQL_ROOT_PASSWORD=</span><span style="color:#005CC5;">123456</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-v</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/mydata/mysql/slaver/log:/var/log/mysql</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-v</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/mydata/mysql/slaver/data:/var/lib/mysql</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-v</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/mydata/mysql/slaver/conf:/etc/mysql</span><span style="color:#24292E;"> </span><span style="color:#032F62;">mysql:5.7.28</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>5、新建编辑 <code>my.cnf</code></p><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[client]</span></span>
<span class="line"><span style="color:#E1E4E8;">default-character-set</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">utf8</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">[mysql]</span></span>
<span class="line"><span style="color:#E1E4E8;">default-character-set</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">utf8</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">[mysqld]</span></span>
<span class="line"><span style="color:#E1E4E8;">init_connect</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&#39;SET collation_connection = utf8_unicode_ci&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">init_connect</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&#39;SET NAMES utf8&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">character-set-server</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">utf8</span></span>
<span class="line"><span style="color:#E1E4E8;">collation-server</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">utf8_unicode_ci</span></span>
<span class="line"><span style="color:#B392F0;">skip-character-set-client-handshake</span></span>
<span class="line"><span style="color:#B392F0;">skip-name-resolve</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">server_id</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">2</span></span>
<span class="line"><span style="color:#E1E4E8;">log-bin</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">mysql-bin</span></span>
<span class="line"><span style="color:#6A737D;"># 设置从库只读</span></span>
<span class="line"><span style="color:#E1E4E8;">read-only</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">1</span></span>
<span class="line"><span style="color:#6A737D;"># 设置同步库</span></span>
<span class="line"><span style="color:#E1E4E8;">binlog-do-db</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">db_sync_1</span></span>
<span class="line"><span style="color:#E1E4E8;">binlog-do-db</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">db_sync_2</span></span>
<span class="line"><span style="color:#E1E4E8;">binlog-do-db</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">db_sync_3</span></span>
<span class="line"><span style="color:#E1E4E8;">binlog-do-db</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">db_sync_4</span></span>
<span class="line"><span style="color:#E1E4E8;">binlog-do-db</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">db_sync_5</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 设置忽略同步库</span></span>
<span class="line"><span style="color:#E1E4E8;">replicate-ignore-db</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">mysql</span></span>
<span class="line"><span style="color:#E1E4E8;">replicate-ignore-db</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">sys</span></span>
<span class="line"><span style="color:#E1E4E8;">replicate-ignore-db</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">information_schema</span></span>
<span class="line"><span style="color:#E1E4E8;">replicate-ignore-db</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">performance_schema</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[client]</span></span>
<span class="line"><span style="color:#24292E;">default-character-set</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">utf8</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">[mysql]</span></span>
<span class="line"><span style="color:#24292E;">default-character-set</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">utf8</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">[mysqld]</span></span>
<span class="line"><span style="color:#24292E;">init_connect</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&#39;SET collation_connection = utf8_unicode_ci&#39;</span></span>
<span class="line"><span style="color:#24292E;">init_connect</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&#39;SET NAMES utf8&#39;</span></span>
<span class="line"><span style="color:#24292E;">character-set-server</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">utf8</span></span>
<span class="line"><span style="color:#24292E;">collation-server</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">utf8_unicode_ci</span></span>
<span class="line"><span style="color:#6F42C1;">skip-character-set-client-handshake</span></span>
<span class="line"><span style="color:#6F42C1;">skip-name-resolve</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">server_id</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">2</span></span>
<span class="line"><span style="color:#24292E;">log-bin</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">mysql-bin</span></span>
<span class="line"><span style="color:#6A737D;"># 设置从库只读</span></span>
<span class="line"><span style="color:#24292E;">read-only</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">1</span></span>
<span class="line"><span style="color:#6A737D;"># 设置同步库</span></span>
<span class="line"><span style="color:#24292E;">binlog-do-db</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">db_sync_1</span></span>
<span class="line"><span style="color:#24292E;">binlog-do-db</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">db_sync_2</span></span>
<span class="line"><span style="color:#24292E;">binlog-do-db</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">db_sync_3</span></span>
<span class="line"><span style="color:#24292E;">binlog-do-db</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">db_sync_4</span></span>
<span class="line"><span style="color:#24292E;">binlog-do-db</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">db_sync_5</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 设置忽略同步库</span></span>
<span class="line"><span style="color:#24292E;">replicate-ignore-db</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">mysql</span></span>
<span class="line"><span style="color:#24292E;">replicate-ignore-db</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">sys</span></span>
<span class="line"><span style="color:#24292E;">replicate-ignore-db</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">information_schema</span></span>
<span class="line"><span style="color:#24292E;">replicate-ignore-db</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">performance_schema</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><p>6、启动 MySQL，进入 MySQL 容器内部</p><p>1）授权 root 可以远程访问（主从都要配置，为了方便远程连接 MySQL）</p><p>访问账号 root，密码 123456</p><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">grant</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">all</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">privileges</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">on</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">*</span><span style="color:#9ECBFF;">.</span><span style="color:#79B8FF;">*</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">to</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;root&#39;@&#39;%&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">identified</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">by</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;123456&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">with</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">grant</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">option</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">flush</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">privileges</span><span style="color:#E1E4E8;">;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">grant</span><span style="color:#24292E;"> </span><span style="color:#032F62;">all</span><span style="color:#24292E;"> </span><span style="color:#032F62;">privileges</span><span style="color:#24292E;"> </span><span style="color:#032F62;">on</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">*</span><span style="color:#032F62;">.</span><span style="color:#005CC5;">*</span><span style="color:#24292E;"> </span><span style="color:#032F62;">to</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;root&#39;@&#39;%&#39;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">identified</span><span style="color:#24292E;"> </span><span style="color:#032F62;">by</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;123456&#39;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">with</span><span style="color:#24292E;"> </span><span style="color:#032F62;">grant</span><span style="color:#24292E;"> </span><span style="color:#032F62;">option</span><span style="color:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">flush</span><span style="color:#24292E;"> </span><span style="color:#032F62;">privileges</span><span style="color:#24292E;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>2）主库配置添加用来同步的用户</p><p>在主库给从库分配一个连接主库的账号密码、账号名 backup，密码 123456</p><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">GRANT</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">REPLICATION</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">SLAVE</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ON</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">*</span><span style="color:#9ECBFF;">.</span><span style="color:#79B8FF;">*</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">to</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;backup&#39;@&#39;%&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">identified</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">by</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;123456&#39;</span><span style="color:#E1E4E8;">;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">GRANT</span><span style="color:#24292E;"> </span><span style="color:#032F62;">REPLICATION</span><span style="color:#24292E;"> </span><span style="color:#032F62;">SLAVE</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ON</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">*</span><span style="color:#032F62;">.</span><span style="color:#005CC5;">*</span><span style="color:#24292E;"> </span><span style="color:#032F62;">to</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;backup&#39;@&#39;%&#39;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">identified</span><span style="color:#24292E;"> </span><span style="color:#032F62;">by</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;123456&#39;</span><span style="color:#24292E;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>3）查看 master 状态</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">show master status；</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">show master status；</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>3-1）查看完整状态</p><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">show</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">master</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">status</span><span style="color:#79B8FF;">\G</span><span style="color:#E1E4E8;">;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">show</span><span style="color:#24292E;"> </span><span style="color:#032F62;">master</span><span style="color:#24292E;"> </span><span style="color:#032F62;">status</span><span style="color:#005CC5;">\G</span><span style="color:#24292E;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>4）从库设置主库连接</p><p>从库使用主库分配的账号密码连接主库</p><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">change</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">master</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">to</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">master_host=&#39;121.43.124.80&#39;,master_user=&#39;backup&#39;,master_password=&#39;123456&#39;,master_log_file=&#39;mysql-bin.000001&#39;,master_log_pos=</span><span style="color:#79B8FF;">0</span><span style="color:#9ECBFF;">,master_port=</span><span style="color:#79B8FF;">3306</span><span style="color:#E1E4E8;">;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">change</span><span style="color:#24292E;"> </span><span style="color:#032F62;">master</span><span style="color:#24292E;"> </span><span style="color:#032F62;">to</span><span style="color:#24292E;"> </span><span style="color:#032F62;">master_host=&#39;121.43.124.80&#39;,master_user=&#39;backup&#39;,master_password=&#39;123456&#39;,master_log_file=&#39;mysql-bin.000001&#39;,master_log_pos=</span><span style="color:#005CC5;">0</span><span style="color:#032F62;">,master_port=</span><span style="color:#005CC5;">3306</span><span style="color:#24292E;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>5）启动从库开始同步</p><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">start</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">slave</span><span style="color:#E1E4E8;">;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">start</span><span style="color:#24292E;"> </span><span style="color:#032F62;">slave</span><span style="color:#24292E;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>6）查看从库状态</p><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">show</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">slave</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">status</span><span style="color:#79B8FF;">\G</span><span style="color:#E1E4E8;">;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">show</span><span style="color:#24292E;"> </span><span style="color:#032F62;">slave</span><span style="color:#24292E;"> </span><span style="color:#032F62;">status</span><span style="color:#005CC5;">\G</span><span style="color:#24292E;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>使用 MyCat 或者在项目中引入 Sharding-JDBC 依赖让项目读取到主从数据库</p><div class="language-xml vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">xml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">&lt;!-- https://mvnrepository.com/artifact/io.shardingjdbc/sharding-jdbc-core --&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">&lt;</span><span style="color:#85E89D;">dependency</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">    &lt;</span><span style="color:#85E89D;">groupId</span><span style="color:#E1E4E8;">&gt;io.shardingjdbc&lt;/</span><span style="color:#85E89D;">groupId</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">    &lt;</span><span style="color:#85E89D;">artifactId</span><span style="color:#E1E4E8;">&gt;sharding-jdbc-core&lt;/</span><span style="color:#85E89D;">artifactId</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">    &lt;</span><span style="color:#85E89D;">version</span><span style="color:#E1E4E8;">&gt;2.0.3&lt;/</span><span style="color:#85E89D;">version</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">&lt;/</span><span style="color:#85E89D;">dependency</span><span style="color:#E1E4E8;">&gt;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">&lt;!-- https://mvnrepository.com/artifact/io.shardingjdbc/sharding-jdbc-core --&gt;</span></span>
<span class="line"><span style="color:#24292E;">&lt;</span><span style="color:#22863A;">dependency</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">    &lt;</span><span style="color:#22863A;">groupId</span><span style="color:#24292E;">&gt;io.shardingjdbc&lt;/</span><span style="color:#22863A;">groupId</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">    &lt;</span><span style="color:#22863A;">artifactId</span><span style="color:#24292E;">&gt;sharding-jdbc-core&lt;/</span><span style="color:#22863A;">artifactId</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">    &lt;</span><span style="color:#22863A;">version</span><span style="color:#24292E;">&gt;2.0.3&lt;/</span><span style="color:#22863A;">version</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">&lt;/</span><span style="color:#22863A;">dependency</span><span style="color:#24292E;">&gt;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><br><h2 id="参考" tabindex="-1">参考 <a class="header-anchor" href="#参考" aria-label="Permalink to &quot;参考&quot;">​</a></h2><p><a href="https://www.cnblogs.com/xrq730/p/11039384.html" target="_blank" rel="noreferrer">Sql Or NoSql</a></p><p><a href="https://www.huaweicloud.com/zhishi/1592288147096.html" target="_blank" rel="noreferrer">关系型数据库和非关系型区别</a></p><p><a href="https://dev.mysql.com/doc/refman/8.0/en/char.html" target="_blank" rel="noreferrer">The CHAR and VARCHAR Types</a></p><p><a href="https://juejin.cn/post/6850037271233331208" target="_blank" rel="noreferrer">https://juejin.cn/post/6850037271233331208</a></p><p><a href="https://juejin.cn/post/6950462246476578829" target="_blank" rel="noreferrer">https://juejin.cn/post/6950462246476578829</a></p><p><a href="https://juejin.cn/post/6976060490506043423" target="_blank" rel="noreferrer">https://juejin.cn/post/6976060490506043423</a></p><p><a href="https://juejin.cn/post/6931901822231642125" target="_blank" rel="noreferrer">https://juejin.cn/post/6931901822231642125</a></p><p><a href="https://blog.csdn.net/wwwdc1012/article/details/88373440" target="_blank" rel="noreferrer">https://blog.csdn.net/wwwdc1012/article/details/88373440</a></p><p><a href="https://blog.csdn.net/wangfeijiu/article/details/113409719" target="_blank" rel="noreferrer">https://blog.csdn.net/wangfeijiu/article/details/113409719</a></p><p><a href="https://blog.csdn.net/wangfeijiu/article/details/112454405" target="_blank" rel="noreferrer">https://blog.csdn.net/wangfeijiu/article/details/112454405</a></p><p><a href="https://segmentfault.com/a/1190000021464570" target="_blank" rel="noreferrer">https://segmentfault.com/a/1190000021464570</a></p></div></div></main><footer class="VPDocFooter" data-v-6b87e69f data-v-ef5dee53><!--[--><!--]--><!----><nav class="prev-next" data-v-ef5dee53><div class="pager" data-v-ef5dee53><a class="pager-link prev" href="/posts/db/index/" data-v-ef5dee53><span class="desc" data-v-ef5dee53>Previous</span><span class="title" data-v-ef5dee53>Guide</span></a></div><div class="pager" data-v-ef5dee53><a class="pager-link next" href="/posts/db/redis/Redis" data-v-ef5dee53><span class="desc" data-v-ef5dee53>Next</span><span class="title" data-v-ef5dee53>Redis</span></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><footer class="VPFooter has-sidebar" data-v-5a346dfe data-v-e03eb2e1><div class="container" data-v-e03eb2e1><p class="message" data-v-e03eb2e1>Power by Vitepress & Github Page</p><p class="copyright" data-v-e03eb2e1>Copyright © 2021-present GnL</p></div></footer><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"posts_be_java_java-advance_java-进阶.md\":\"42abd51d\",\"posts_al_常见算法.md\":\"9bc8df87\",\"about.md\":\"a162070c\",\"posts_al_位运算.md\":\"5ecf9586\",\"posts_dp_index_index.md\":\"86e10ddd\",\"posts_dpl_index_index.md\":\"564bcd34\",\"posts_al_index_index.md\":\"5ef2f242\",\"posts_db_redis_redis.md\":\"83ebd6d8\",\"posts_be_java_jvm_jvm.md\":\"2ba04d00\",\"posts_be_java_java-collection_java-集合.md\":\"c313d7a9\",\"posts_fe_typescript_typescript.md\":\"cf218c1e\",\"index.md\":\"5976cc20\",\"posts_be_springmvc_springmvc.md\":\"129d7912\",\"posts_mw_index_index.md\":\"a194d817\",\"posts_db_mysql_mysql.md\":\"db6ed566\",\"posts_be_springsecurity_springsecurity.md\":\"78670d02\",\"posts_mw_elasticsearch_elasticsearch.md\":\"b66d3004\",\"recently.md\":\"4b0fcd1d\",\"posts_be_springcloud_springcloud.md\":\"95bfcc3d\",\"posts_be_java_io_java-io.md\":\"eb84996f\",\"posts_db_index_index.md\":\"2a58eedb\",\"posts_be_index_index.md\":\"2848fce1\",\"posts_be_dubbo_dubbo.md\":\"c4c4060c\",\"posts_be_java_java-basic_java-基础.md\":\"ea4ad302\",\"posts_be_java_index_java.md\":\"56198839\",\"posts_renew_spring_spring.md\":\"95e99988\",\"posts_be_spring_spring5.md\":\"c6b3eb7f\",\"posts_be_mybatis_mybatis.md\":\"d32e69e5\",\"posts_be_java_java-threadpool_java-线程池.md\":\"f6d25920\",\"posts_fe_vuejs_vuejs.md\":\"dff77e28\",\"posts_be_java_java-thread_java-多线程.md\":\"95811c4b\",\"posts_mw_kafka_kafka.md\":\"f4f60b5d\",\"posts_dp_设计模式.md\":\"e515ad08\",\"posts_mw_rocketmq_rocketmq.md\":\"b62cd2a5\",\"posts_renew_mysql_mysql.md\":\"8d44b32f\",\"posts_renew_redis_redis-数据类型.md\":\"16cbe99d\",\"posts_renew_redis_redis-配置详解.md\":\"9e22e5f6\",\"posts_dpl_nginx_nginx.md\":\"e5a33acd\",\"posts_fe_index_index.md\":\"9b5e1b9e\",\"posts_be_java_java-juc_java-juc.md\":\"13e136cd\",\"posts_fe_react_react.md\":\"47e06a33\",\"posts_be_springboot_springboot.md\":\"fdd2c0dc\",\"posts_fe_javascript_javascript.md\":\"db17f093\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"zh-CN\",\"dir\":\"ltr\",\"title\":\"Gnl\",\"description\":\"A VitePress site\",\"base\":\"/\",\"head\":[],\"appearance\":true,\"themeConfig\":{\"logo\":\"./logo.jpeg\",\"nav\":[{\"text\":\"Recently\",\"link\":\"/recently\"},{\"text\":\"算法\",\"link\":\"posts/al/index/\"},{\"text\":\"前端\",\"items\":[{\"text\":\"JavaScript\",\"link\":\"/posts/fe/javascript/JavaScript\"},{\"text\":\"Vue.js\",\"link\":\"/posts/fe/vuejs/Vuejs\"},{\"text\":\"React\",\"link\":\"/posts/fe/react/React\"},{\"text\":\"TypeScript\",\"link\":\"/posts/fe/typescript/TypeScript\"}]},{\"text\":\"后端\",\"items\":[{\"text\":\"Java\",\"link\":\"/posts/be/java/index/Java\"},{\"text\":\"Spring5\",\"link\":\"/posts/be/spring/Spring5\"},{\"text\":\"Spring MVC\",\"link\":\"/posts/be/springmvc/SpringMVC\"},{\"text\":\"Spring Boot\",\"link\":\"/posts/be/springboot/SpringBoot\"},{\"text\":\"Spring Security\",\"link\":\"/posts/be/springsecurity/SpringSecurity\"},{\"text\":\"Spring Cloud\",\"link\":\"/posts/be/springcloud/SpringCloud\"},{\"text\":\"MyBatis\",\"link\":\"/posts/be/mybatis/MyBatis\"}]},{\"text\":\"数据库\",\"items\":[{\"text\":\"MySQL\",\"link\":\"/posts/db/mysql/MySQL\"},{\"text\":\"Redis\",\"link\":\"/posts/db/redis/Redis\"}]},{\"text\":\"中间件\",\"items\":[{\"text\":\"RocketMQ\",\"link\":\"/posts/mw/rocketmq/RocketMQ\"},{\"text\":\"Elasticsearch\",\"link\":\"/posts/mw/elasticsearch/Elasticsearch\"},{\"text\":\"Kafka\",\"link\":\"/posts/mw/kafka/Kafka\"},{\"text\":\"Nginx\",\"link\":\"/posts/mw/nginx/Nginx\"}]}],\"sidebar\":[{\"text\":\"算法\",\"collapsible\":true,\"collapsed\":true,\"items\":[{\"text\":\"Guide\",\"link\":\"/posts/al/index/\"},{\"text\":\"位运算\",\"link\":\"/posts/al/位运算\"},{\"text\":\"常见算法\",\"link\":\"/posts/al/常见算法\"}]},{\"text\":\"设计模式\",\"collapsible\":true,\"collapsed\":true,\"items\":[{\"text\":\"Guide\",\"link\":\"/posts/dp/index/\"},{\"text\":\"设计模式\",\"link\":\"/posts/dp/设计模式\"}]},{\"text\":\"前端\",\"collapsible\":true,\"collapsed\":true,\"items\":[{\"text\":\"Guide\",\"link\":\"/posts/fe/index/\"},{\"text\":\"JavaScript\",\"link\":\"/posts/fe/javascript/JavaScript\"},{\"text\":\"Vue.js\",\"link\":\"/posts/fe/vuejs/Vuejs\"},{\"text\":\"React\",\"link\":\"/posts/fe/react/React\"},{\"text\":\"TypeScript\",\"link\":\"/posts/fe/typescript/TypeScript\"}]},{\"text\":\"后端\",\"collapsible\":true,\"collapsed\":true,\"items\":[{\"text\":\"Guide\",\"link\":\"/posts/be/index/\"},{\"text\":\"Java\",\"link\":\"/posts/be/java/index/Java\",\"collapsible\":true,\"collapsed\":true,\"items\":[{\"text\":\"Java 基础\",\"link\":\"/posts/be/java/java-basic/Java-基础\"},{\"text\":\"Java 集合\",\"link\":\"/posts/be/java/java-collection/Java-集合\"},{\"text\":\"Java 多线程\",\"link\":\"/posts/be/java/java-thread/Java-多线程\"},{\"text\":\"Java 线程池\",\"link\":\"/posts/be/java/java-threadpool/Java-线程池\"},{\"text\":\"Java JUC\",\"link\":\"/posts/be/java/java-juc/Java-JUC\"},{\"text\":\"Java IO\",\"link\":\"/posts/be/java/io/Java-IO\"},{\"text\":\"Java 进阶\",\"link\":\"/posts/be/java/java-advance/Java-进阶\"}]},{\"text\":\"JVM\",\"link\":\"/posts/be/java/jvm/JVM\"},{\"text\":\"Spring5\",\"link\":\"/posts/be/spring/Spring5\"},{\"text\":\"Spring MVC\",\"link\":\"/posts/be/springmvc/SpringMVC\"},{\"text\":\"Spring Boot\",\"link\":\"/posts/be/springboot/SpringBoot\"},{\"text\":\"Spring Security\",\"link\":\"/posts/be/springsecurity/SpringSecurity\"},{\"text\":\"Spring Cloud\",\"link\":\"/posts/be/springcloud/SpringCloud\"},{\"text\":\"MyBatis\",\"link\":\"/posts/be/mybatis/MyBatis\"}]},{\"text\":\"数据库\",\"collapsible\":true,\"collapsed\":true,\"items\":[{\"text\":\"Guide\",\"link\":\"/posts/db/index/\"},{\"text\":\"MySQL\",\"link\":\"/posts/db/mysql/MySQL\"},{\"text\":\"Redis\",\"link\":\"/posts/db/redis/Redis\"}]},{\"text\":\"中间件\",\"collapsible\":true,\"collapsed\":true,\"items\":[{\"text\":\"Guide\",\"link\":\"/posts/mw/index/\"},{\"text\":\"RocketMQ\",\"link\":\"/posts/mw/rocketmq/RocketMQ\"},{\"text\":\"Elasticsearch\",\"link\":\"/posts/mw/elasticsearch/Elasticsearch\"},{\"text\":\"Kafka\",\"link\":\"/posts/mw/kafka/Kafka\"},{\"text\":\"Nginx\",\"link\":\"/posts/mw/nginx/Nginx\"}]}],\"docFooter\":{\"prev\":\"Previous\",\"next\":\"Next\"},\"footer\":{\"message\":\"Power by Vitepress & Github Page\",\"copyright\":\"Copyright © 2021-present GnL\"}},\"locales\":{},\"scrollOffset\":90,\"cleanUrls\":true}");</script>
    
  </body>
</html>