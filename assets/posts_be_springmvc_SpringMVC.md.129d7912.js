import{_ as s,o as n,c as a,Q as l}from"./chunks/framework.834b76fb.js";const p="/assets/image-20200509125045797.2728190b.png",e="/assets/image-20200509124942393.b80cee10.png",o="/assets/image-20200510091142500.14e197a4.png",A=JSON.parse('{"title":"SpringMVC","description":"","frontmatter":{},"headers":[],"relativePath":"posts/be/springmvc/SpringMVC.md","filePath":"posts/be/springmvc/SpringMVC.md"}'),r={name:"posts/be/springmvc/SpringMVC.md"},t=l('<h1 id="springmvc" tabindex="-1">SpringMVC <a class="header-anchor" href="#springmvc" aria-label="Permalink to &quot;SpringMVC&quot;">​</a></h1><h2 id="请求流程图" tabindex="-1">请求流程图 <a class="header-anchor" href="#请求流程图" aria-label="Permalink to &quot;请求流程图&quot;">​</a></h2><p><img src="'+p+'" alt="image-20200509125045797"></p><h2 id="代码执行流程图" tabindex="-1">代码执行流程图 <a class="header-anchor" href="#代码执行流程图" aria-label="Permalink to &quot;代码执行流程图&quot;">​</a></h2><p><img src="'+e+`" alt="image-20200509124942393"></p><h2 id="请求细节" tabindex="-1">请求细节 <a class="header-anchor" href="#请求细节" aria-label="Permalink to &quot;请求细节&quot;">​</a></h2><h3 id="dodispatch" tabindex="-1">doDispatch <a class="header-anchor" href="#dodispatch" aria-label="Permalink to &quot;doDispatch&quot;">​</a></h3><div class="language-java vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">/*</span></span>
<span class="line"><span style="color:#6A737D;">处理向处理程序的实际分派。 处理程序将通过依次应用servlet的HandlerMappings获得。 通过查询servlet已安装HandlerAdapters 来找到第一个支持处理程序类的HandlerAdapter。 所有HTTP方法均由该方法处理。由HandlerAdapters或处理程序自己决定可接受的方法。</span></span>
<span class="line"><span style="color:#6A737D;">*/</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">protected</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">void</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">doDispatch</span><span style="color:#E1E4E8;">(HttpServletRequest request, HttpServletResponse response) throws Exception {</span></span>
<span class="line"><span style="color:#E1E4E8;">   HttpServletRequest processedRequest </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> request;</span></span>
<span class="line"><span style="color:#E1E4E8;">   HandlerExecutionChain mappedHandler </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">null</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">boolean</span><span style="color:#E1E4E8;"> multipartRequestParsed </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">false</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">   WebAsyncManager asyncManager </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> WebAsyncUtils.</span><span style="color:#B392F0;">getAsyncManager</span><span style="color:#E1E4E8;">(request);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">try</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">      ModelAndView mv </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">null</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">      Exception dispatchException </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">null</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#F97583;">try</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">         </span><span style="color:#6A737D;">// 检查是否为文件上传请求</span></span>
<span class="line"><span style="color:#E1E4E8;">         processedRequest </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">checkMultipart</span><span style="color:#E1E4E8;">(request);</span></span>
<span class="line"><span style="color:#E1E4E8;">         multipartRequestParsed </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> (processedRequest </span><span style="color:#F97583;">!=</span><span style="color:#E1E4E8;"> request);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">         </span><span style="color:#6A737D;">// 确定处理当前请求的handler（Controller）</span></span>
<span class="line"><span style="color:#E1E4E8;">         </span><span style="color:#6A737D;">// 即：根据当前请求url找到能处理的类</span></span>
<span class="line"><span style="color:#E1E4E8;">         </span><span style="color:#6A737D;">// Determine handler for the current request.</span></span>
<span class="line"><span style="color:#E1E4E8;">         mappedHandler </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">getHandler</span><span style="color:#E1E4E8;">(processedRequest);</span></span>
<span class="line"><span style="color:#E1E4E8;">         </span><span style="color:#6A737D;">// 如果找不到能处理当前请求的类(Controller/Handler)则404或者抛异常</span></span>
<span class="line"><span style="color:#E1E4E8;">         </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (mappedHandler </span><span style="color:#F97583;">==</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">null</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#B392F0;">noHandlerFound</span><span style="color:#E1E4E8;">(processedRequest, response);</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">         }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">         </span><span style="color:#6A737D;">// 确定能执行当前请求的处理器适配器（RequestMappingHandlerAdapter）</span></span>
<span class="line"><span style="color:#E1E4E8;">         </span><span style="color:#6A737D;">// Determine handler adapter for the current request.</span></span>
<span class="line"><span style="color:#E1E4E8;">         HandlerAdapter ha </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">getHandlerAdapter</span><span style="color:#E1E4E8;">(mappedHandler.</span><span style="color:#B392F0;">getHandler</span><span style="color:#E1E4E8;">());</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">         </span><span style="color:#6A737D;">// Process last-modified header, if supported by the handler.</span></span>
<span class="line"><span style="color:#E1E4E8;">         String method </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> request.</span><span style="color:#B392F0;">getMethod</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">         </span><span style="color:#F97583;">boolean</span><span style="color:#E1E4E8;"> isGet </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;GET&quot;</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">equals</span><span style="color:#E1E4E8;">(method);</span></span>
<span class="line"><span style="color:#E1E4E8;">         </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (isGet </span><span style="color:#F97583;">||</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;HEAD&quot;</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">equals</span><span style="color:#E1E4E8;">(method)) {</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">long</span><span style="color:#E1E4E8;"> lastModified </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> ha.</span><span style="color:#B392F0;">getLastModified</span><span style="color:#E1E4E8;">(request, mappedHandler.</span><span style="color:#B392F0;">getHandler</span><span style="color:#E1E4E8;">());</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (</span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">ServletWebRequest</span><span style="color:#E1E4E8;">(request, response).</span><span style="color:#B392F0;">checkNotModified</span><span style="color:#E1E4E8;">(lastModified) </span><span style="color:#F97583;">&amp;&amp;</span><span style="color:#E1E4E8;"> isGet) {</span></span>
<span class="line"><span style="color:#E1E4E8;">               </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">            }</span></span>
<span class="line"><span style="color:#E1E4E8;">         }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">         </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (</span><span style="color:#F97583;">!</span><span style="color:#E1E4E8;">mappedHandler.</span><span style="color:#B392F0;">applyPreHandle</span><span style="color:#E1E4E8;">(processedRequest, response)) {</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">         }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">         </span><span style="color:#6A737D;">// 处理器适配器来执行目标方法。处理器（Handler）/控制器（Controller）的方法被调用</span></span>
<span class="line"><span style="color:#E1E4E8;">         </span><span style="color:#6A737D;">// 将目标方法执行完后的返回值作为视图名，设置保存到ModelAndView中</span></span>
<span class="line"><span style="color:#E1E4E8;">         </span><span style="color:#6A737D;">// 无论目标方法内部如何工作，处理器适配器都会将执行完成之后的信息封装为ModelAndView</span></span>
<span class="line"><span style="color:#E1E4E8;">         </span><span style="color:#6A737D;">// Actually invoke the handler.</span></span>
<span class="line"><span style="color:#E1E4E8;">         mv </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> ha.</span><span style="color:#B392F0;">handle</span><span style="color:#E1E4E8;">(processedRequest, response, mappedHandler.</span><span style="color:#B392F0;">getHandler</span><span style="color:#E1E4E8;">());</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">         </span><span style="color:#6A737D;">// 判断当前方法是否是异步方法，如果是直接返回</span></span>
<span class="line"><span style="color:#E1E4E8;">         </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (asyncManager.</span><span style="color:#B392F0;">isConcurrentHandlingStarted</span><span style="color:#E1E4E8;">()) {</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">         }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">         </span><span style="color:#6A737D;">// 如果没有视图名，则设置一个默认的视图名。即请求的路径名</span></span>
<span class="line"><span style="color:#E1E4E8;">         </span><span style="color:#B392F0;">applyDefaultViewName</span><span style="color:#E1E4E8;">(processedRequest, mv);</span></span>
<span class="line"><span style="color:#E1E4E8;">         mappedHandler.</span><span style="color:#B392F0;">applyPostHandle</span><span style="color:#E1E4E8;">(processedRequest, response, mv);</span></span>
<span class="line"><span style="color:#E1E4E8;">      }</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#F97583;">catch</span><span style="color:#E1E4E8;"> (Exception </span><span style="color:#FFAB70;">ex</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">         dispatchException </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> ex;</span></span>
<span class="line"><span style="color:#E1E4E8;">      }</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#F97583;">catch</span><span style="color:#E1E4E8;"> (Throwable </span><span style="color:#FFAB70;">err</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">         </span><span style="color:#6A737D;">// As of 4.3, we&#39;re processing Errors thrown from handler methods as well,</span></span>
<span class="line"><span style="color:#E1E4E8;">         </span><span style="color:#6A737D;">// making them available for @ExceptionHandler methods and other scenarios.</span></span>
<span class="line"><span style="color:#E1E4E8;">         dispatchException </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">NestedServletException</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;Handler dispatch failed&quot;</span><span style="color:#E1E4E8;">, err);</span></span>
<span class="line"><span style="color:#E1E4E8;">      }</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#6A737D;">// 转发来到目标页面</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#6A737D;">// 根据方法最终执行完成之后的ModelAndView转发到相应的页面，并且将ModelAndView中的数据封装到请求域中</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#B392F0;">processDispatchResult</span><span style="color:#E1E4E8;">(processedRequest, response, mappedHandler, mv, dispatchException);</span></span>
<span class="line"><span style="color:#E1E4E8;">   }</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">catch</span><span style="color:#E1E4E8;"> (Exception </span><span style="color:#FFAB70;">ex</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#B392F0;">triggerAfterCompletion</span><span style="color:#E1E4E8;">(processedRequest, response, mappedHandler, ex);</span></span>
<span class="line"><span style="color:#E1E4E8;">   }</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">catch</span><span style="color:#E1E4E8;"> (Throwable </span><span style="color:#FFAB70;">err</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#B392F0;">triggerAfterCompletion</span><span style="color:#E1E4E8;">(processedRequest, response, mappedHandler,</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">NestedServletException</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;Handler processing failed&quot;</span><span style="color:#E1E4E8;">, err));</span></span>
<span class="line"><span style="color:#E1E4E8;">   }</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">finally</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (asyncManager.</span><span style="color:#B392F0;">isConcurrentHandlingStarted</span><span style="color:#E1E4E8;">()) {</span></span>
<span class="line"><span style="color:#E1E4E8;">         </span><span style="color:#6A737D;">// Instead of postHandle and afterCompletion</span></span>
<span class="line"><span style="color:#E1E4E8;">         </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (mappedHandler </span><span style="color:#F97583;">!=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">null</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">            mappedHandler.</span><span style="color:#B392F0;">applyAfterConcurrentHandlingStarted</span><span style="color:#E1E4E8;">(processedRequest, response);</span></span>
<span class="line"><span style="color:#E1E4E8;">         }</span></span>
<span class="line"><span style="color:#E1E4E8;">      }</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#F97583;">else</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">         </span><span style="color:#6A737D;">// Clean up any resources used by a multipart request.</span></span>
<span class="line"><span style="color:#E1E4E8;">         </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (multipartRequestParsed) {</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#B392F0;">cleanupMultipart</span><span style="color:#E1E4E8;">(processedRequest);</span></span>
<span class="line"><span style="color:#E1E4E8;">         }</span></span>
<span class="line"><span style="color:#E1E4E8;">      }</span></span>
<span class="line"><span style="color:#E1E4E8;">   }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">/*</span></span>
<span class="line"><span style="color:#6A737D;">处理向处理程序的实际分派。 处理程序将通过依次应用servlet的HandlerMappings获得。 通过查询servlet已安装HandlerAdapters 来找到第一个支持处理程序类的HandlerAdapter。 所有HTTP方法均由该方法处理。由HandlerAdapters或处理程序自己决定可接受的方法。</span></span>
<span class="line"><span style="color:#6A737D;">*/</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">protected</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">void</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">doDispatch</span><span style="color:#24292E;">(HttpServletRequest request, HttpServletResponse response) throws Exception {</span></span>
<span class="line"><span style="color:#24292E;">   HttpServletRequest processedRequest </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> request;</span></span>
<span class="line"><span style="color:#24292E;">   HandlerExecutionChain mappedHandler </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">null</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#D73A49;">boolean</span><span style="color:#24292E;"> multipartRequestParsed </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">false</span><span style="color:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">   WebAsyncManager asyncManager </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> WebAsyncUtils.</span><span style="color:#6F42C1;">getAsyncManager</span><span style="color:#24292E;">(request);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#D73A49;">try</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">      ModelAndView mv </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">null</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">      Exception dispatchException </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">null</span><span style="color:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#D73A49;">try</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">         </span><span style="color:#6A737D;">// 检查是否为文件上传请求</span></span>
<span class="line"><span style="color:#24292E;">         processedRequest </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">checkMultipart</span><span style="color:#24292E;">(request);</span></span>
<span class="line"><span style="color:#24292E;">         multipartRequestParsed </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> (processedRequest </span><span style="color:#D73A49;">!=</span><span style="color:#24292E;"> request);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">         </span><span style="color:#6A737D;">// 确定处理当前请求的handler（Controller）</span></span>
<span class="line"><span style="color:#24292E;">         </span><span style="color:#6A737D;">// 即：根据当前请求url找到能处理的类</span></span>
<span class="line"><span style="color:#24292E;">         </span><span style="color:#6A737D;">// Determine handler for the current request.</span></span>
<span class="line"><span style="color:#24292E;">         mappedHandler </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">getHandler</span><span style="color:#24292E;">(processedRequest);</span></span>
<span class="line"><span style="color:#24292E;">         </span><span style="color:#6A737D;">// 如果找不到能处理当前请求的类(Controller/Handler)则404或者抛异常</span></span>
<span class="line"><span style="color:#24292E;">         </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (mappedHandler </span><span style="color:#D73A49;">==</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">null</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">            </span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6F42C1;">noHandlerFound</span><span style="color:#24292E;">(processedRequest, response);</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">return</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">         }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">         </span><span style="color:#6A737D;">// 确定能执行当前请求的处理器适配器（RequestMappingHandlerAdapter）</span></span>
<span class="line"><span style="color:#24292E;">         </span><span style="color:#6A737D;">// Determine handler adapter for the current request.</span></span>
<span class="line"><span style="color:#24292E;">         HandlerAdapter ha </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">getHandlerAdapter</span><span style="color:#24292E;">(mappedHandler.</span><span style="color:#6F42C1;">getHandler</span><span style="color:#24292E;">());</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">         </span><span style="color:#6A737D;">// Process last-modified header, if supported by the handler.</span></span>
<span class="line"><span style="color:#24292E;">         String method </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> request.</span><span style="color:#6F42C1;">getMethod</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">         </span><span style="color:#D73A49;">boolean</span><span style="color:#24292E;"> isGet </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;GET&quot;</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">equals</span><span style="color:#24292E;">(method);</span></span>
<span class="line"><span style="color:#24292E;">         </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (isGet </span><span style="color:#D73A49;">||</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;HEAD&quot;</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">equals</span><span style="color:#24292E;">(method)) {</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">long</span><span style="color:#24292E;"> lastModified </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> ha.</span><span style="color:#6F42C1;">getLastModified</span><span style="color:#24292E;">(request, mappedHandler.</span><span style="color:#6F42C1;">getHandler</span><span style="color:#24292E;">());</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (</span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">ServletWebRequest</span><span style="color:#24292E;">(request, response).</span><span style="color:#6F42C1;">checkNotModified</span><span style="color:#24292E;">(lastModified) </span><span style="color:#D73A49;">&amp;&amp;</span><span style="color:#24292E;"> isGet) {</span></span>
<span class="line"><span style="color:#24292E;">               </span><span style="color:#D73A49;">return</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">            }</span></span>
<span class="line"><span style="color:#24292E;">         }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">         </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (</span><span style="color:#D73A49;">!</span><span style="color:#24292E;">mappedHandler.</span><span style="color:#6F42C1;">applyPreHandle</span><span style="color:#24292E;">(processedRequest, response)) {</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">return</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">         }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">         </span><span style="color:#6A737D;">// 处理器适配器来执行目标方法。处理器（Handler）/控制器（Controller）的方法被调用</span></span>
<span class="line"><span style="color:#24292E;">         </span><span style="color:#6A737D;">// 将目标方法执行完后的返回值作为视图名，设置保存到ModelAndView中</span></span>
<span class="line"><span style="color:#24292E;">         </span><span style="color:#6A737D;">// 无论目标方法内部如何工作，处理器适配器都会将执行完成之后的信息封装为ModelAndView</span></span>
<span class="line"><span style="color:#24292E;">         </span><span style="color:#6A737D;">// Actually invoke the handler.</span></span>
<span class="line"><span style="color:#24292E;">         mv </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> ha.</span><span style="color:#6F42C1;">handle</span><span style="color:#24292E;">(processedRequest, response, mappedHandler.</span><span style="color:#6F42C1;">getHandler</span><span style="color:#24292E;">());</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">         </span><span style="color:#6A737D;">// 判断当前方法是否是异步方法，如果是直接返回</span></span>
<span class="line"><span style="color:#24292E;">         </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (asyncManager.</span><span style="color:#6F42C1;">isConcurrentHandlingStarted</span><span style="color:#24292E;">()) {</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">return</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">         }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">         </span><span style="color:#6A737D;">// 如果没有视图名，则设置一个默认的视图名。即请求的路径名</span></span>
<span class="line"><span style="color:#24292E;">         </span><span style="color:#6F42C1;">applyDefaultViewName</span><span style="color:#24292E;">(processedRequest, mv);</span></span>
<span class="line"><span style="color:#24292E;">         mappedHandler.</span><span style="color:#6F42C1;">applyPostHandle</span><span style="color:#24292E;">(processedRequest, response, mv);</span></span>
<span class="line"><span style="color:#24292E;">      }</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#D73A49;">catch</span><span style="color:#24292E;"> (Exception </span><span style="color:#E36209;">ex</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">         dispatchException </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> ex;</span></span>
<span class="line"><span style="color:#24292E;">      }</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#D73A49;">catch</span><span style="color:#24292E;"> (Throwable </span><span style="color:#E36209;">err</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">         </span><span style="color:#6A737D;">// As of 4.3, we&#39;re processing Errors thrown from handler methods as well,</span></span>
<span class="line"><span style="color:#24292E;">         </span><span style="color:#6A737D;">// making them available for @ExceptionHandler methods and other scenarios.</span></span>
<span class="line"><span style="color:#24292E;">         dispatchException </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">NestedServletException</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;Handler dispatch failed&quot;</span><span style="color:#24292E;">, err);</span></span>
<span class="line"><span style="color:#24292E;">      }</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#6A737D;">// 转发来到目标页面</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#6A737D;">// 根据方法最终执行完成之后的ModelAndView转发到相应的页面，并且将ModelAndView中的数据封装到请求域中</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#6F42C1;">processDispatchResult</span><span style="color:#24292E;">(processedRequest, response, mappedHandler, mv, dispatchException);</span></span>
<span class="line"><span style="color:#24292E;">   }</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#D73A49;">catch</span><span style="color:#24292E;"> (Exception </span><span style="color:#E36209;">ex</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#6F42C1;">triggerAfterCompletion</span><span style="color:#24292E;">(processedRequest, response, mappedHandler, ex);</span></span>
<span class="line"><span style="color:#24292E;">   }</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#D73A49;">catch</span><span style="color:#24292E;"> (Throwable </span><span style="color:#E36209;">err</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#6F42C1;">triggerAfterCompletion</span><span style="color:#24292E;">(processedRequest, response, mappedHandler,</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">NestedServletException</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;Handler processing failed&quot;</span><span style="color:#24292E;">, err));</span></span>
<span class="line"><span style="color:#24292E;">   }</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#D73A49;">finally</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (asyncManager.</span><span style="color:#6F42C1;">isConcurrentHandlingStarted</span><span style="color:#24292E;">()) {</span></span>
<span class="line"><span style="color:#24292E;">         </span><span style="color:#6A737D;">// Instead of postHandle and afterCompletion</span></span>
<span class="line"><span style="color:#24292E;">         </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (mappedHandler </span><span style="color:#D73A49;">!=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">null</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">            mappedHandler.</span><span style="color:#6F42C1;">applyAfterConcurrentHandlingStarted</span><span style="color:#24292E;">(processedRequest, response);</span></span>
<span class="line"><span style="color:#24292E;">         }</span></span>
<span class="line"><span style="color:#24292E;">      }</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#D73A49;">else</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">         </span><span style="color:#6A737D;">// Clean up any resources used by a multipart request.</span></span>
<span class="line"><span style="color:#24292E;">         </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (multipartRequestParsed) {</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6F42C1;">cleanupMultipart</span><span style="color:#24292E;">(processedRequest);</span></span>
<span class="line"><span style="color:#24292E;">         }</span></span>
<span class="line"><span style="color:#24292E;">      }</span></span>
<span class="line"><span style="color:#24292E;">   }</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br></div></div><p><strong>总结</strong></p><ol><li>发送请求，DispatcherServlet收到请求</li><li>调用doDispatch()处理请求 <ol><li><p><code>getHandler(processedRequest);</code>，返回一条执行链（HandlerExecutionChain）。根据当前请求地址找到能处理此请求的handler（对应的Controller类）。</p><p><strong>根据当前请求，在HandlerMapping中找到这个请求的映射信息，获取目标处理器类</strong></p></li><li><p><code>getHandlerAdapter(mappedHandler.getHandler());</code>，返回（RequestMappingHandlerAdapter）。</p><p><strong>根据获取到的目标处理器类，找到当前能执行当前处理器类的的处理器适配器HandlerAdapter</strong></p></li><li><p><code>mv = ha.handle(processedRequest, response, mappedHandler.getHandler());</code>调用处理器适配器的handler()方法利用反射执行目标方法</p></li><li><p>目标方法执行完成之后会返回一个ModelAndView对象</p></li><li><p>根据ModelAndView的信息转发到相应的页面，并将ModelAndView的信息封装到请求域中</p></li></ol></li></ol><h3 id="gethandler" tabindex="-1">getHandler <a class="header-anchor" href="#gethandler" aria-label="Permalink to &quot;getHandler&quot;">​</a></h3><p>怎么根据当前请求找到相应的类来处理？</p><p>getHandler()返回相应目标处理器的执行链</p><div class="language-java vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">protected</span><span style="color:#E1E4E8;"> HandlerExecutionChain </span><span style="color:#B392F0;">getHandler</span><span style="color:#E1E4E8;">(HttpServletRequest request) throws Exception {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">// HandlerMapping处理器映射器，保存了每个处理器（Handler）能处理哪些映射信息</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (</span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.handlerMappings </span><span style="color:#F97583;">!=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">null</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#F97583;">for</span><span style="color:#E1E4E8;"> (HandlerMapping mapping </span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.handlerMappings) {</span></span>
<span class="line"><span style="color:#E1E4E8;">         HandlerExecutionChain handler </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> mapping.</span><span style="color:#B392F0;">getHandler</span><span style="color:#E1E4E8;">(request);</span></span>
<span class="line"><span style="color:#E1E4E8;">         </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (handler </span><span style="color:#F97583;">!=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">null</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> handler;</span></span>
<span class="line"><span style="color:#E1E4E8;">         }</span></span>
<span class="line"><span style="color:#E1E4E8;">      }</span></span>
<span class="line"><span style="color:#E1E4E8;">   }</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">null</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">protected</span><span style="color:#24292E;"> HandlerExecutionChain </span><span style="color:#6F42C1;">getHandler</span><span style="color:#24292E;">(HttpServletRequest request) throws Exception {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// HandlerMapping处理器映射器，保存了每个处理器（Handler）能处理哪些映射信息</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (</span><span style="color:#005CC5;">this</span><span style="color:#24292E;">.handlerMappings </span><span style="color:#D73A49;">!=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">null</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#D73A49;">for</span><span style="color:#24292E;"> (HandlerMapping mapping </span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">this</span><span style="color:#24292E;">.handlerMappings) {</span></span>
<span class="line"><span style="color:#24292E;">         HandlerExecutionChain handler </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> mapping.</span><span style="color:#6F42C1;">getHandler</span><span style="color:#24292E;">(request);</span></span>
<span class="line"><span style="color:#24292E;">         </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (handler </span><span style="color:#D73A49;">!=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">null</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> handler;</span></span>
<span class="line"><span style="color:#24292E;">         }</span></span>
<span class="line"><span style="color:#24292E;">      }</span></span>
<span class="line"><span style="color:#24292E;">   }</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">null</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h3 id="gethandleradapter" tabindex="-1">getHandlerAdapter <a class="header-anchor" href="#gethandleradapter" aria-label="Permalink to &quot;getHandlerAdapter&quot;">​</a></h3><p>如何找到目标处理器类的适配器？</p><p>需要用适配器来执行目标方法</p><p><img src="`+o+`" alt="image-20200510091142500"></p><div class="language-java vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">protected</span><span style="color:#E1E4E8;"> HandlerAdapter </span><span style="color:#B392F0;">getHandlerAdapter</span><span style="color:#E1E4E8;">(Object handler) throws ServletException {</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (</span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.handlerAdapters </span><span style="color:#F97583;">!=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">null</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#F97583;">for</span><span style="color:#E1E4E8;"> (HandlerAdapter adapter </span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.handlerAdapters) {</span></span>
<span class="line"><span style="color:#E1E4E8;">         </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (adapter.</span><span style="color:#B392F0;">supports</span><span style="color:#E1E4E8;">(handler)) {</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> adapter;</span></span>
<span class="line"><span style="color:#E1E4E8;">         }</span></span>
<span class="line"><span style="color:#E1E4E8;">      }</span></span>
<span class="line"><span style="color:#E1E4E8;">   }</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">throw</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">ServletException</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;No adapter for handler [&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> handler </span><span style="color:#F97583;">+</span></span>
<span class="line"><span style="color:#E1E4E8;">         </span><span style="color:#9ECBFF;">&quot;]: The DispatcherServlet configuration needs to include a HandlerAdapter that supports this handler&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">protected</span><span style="color:#24292E;"> HandlerAdapter </span><span style="color:#6F42C1;">getHandlerAdapter</span><span style="color:#24292E;">(Object handler) throws ServletException {</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (</span><span style="color:#005CC5;">this</span><span style="color:#24292E;">.handlerAdapters </span><span style="color:#D73A49;">!=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">null</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#D73A49;">for</span><span style="color:#24292E;"> (HandlerAdapter adapter </span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">this</span><span style="color:#24292E;">.handlerAdapters) {</span></span>
<span class="line"><span style="color:#24292E;">         </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (adapter.</span><span style="color:#6F42C1;">supports</span><span style="color:#24292E;">(handler)) {</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> adapter;</span></span>
<span class="line"><span style="color:#24292E;">         }</span></span>
<span class="line"><span style="color:#24292E;">      }</span></span>
<span class="line"><span style="color:#24292E;">   }</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#D73A49;">throw</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">ServletException</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;No adapter for handler [&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> handler </span><span style="color:#D73A49;">+</span></span>
<span class="line"><span style="color:#24292E;">         </span><span style="color:#032F62;">&quot;]: The DispatcherServlet configuration needs to include a HandlerAdapter that supports this handler&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="九大组件初始化" tabindex="-1">九大组件初始化 <a class="header-anchor" href="#九大组件初始化" aria-label="Permalink to &quot;九大组件初始化&quot;">​</a></h3><blockquote><p><strong>何为九大组件？</strong></p><p>SpringMVC 工作的时候的关键位置都是由这些组件完成的。</p><p>共同点：九大组件全部都是接口；接口就是规范，可自定义实现类，提供了强大的扩展性。</p></blockquote><div class="language-java vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">/** MultipartResolver used by this servlet.</span></span>
<span class="line"><span style="color:#6A737D;">	文件上传解析器。与文件上传有关</span></span>
<span class="line"><span style="color:#6A737D;">*/</span></span>
<span class="line"><span style="color:#E1E4E8;">@</span><span style="color:#F97583;">Nullable</span></span>
<span class="line"><span style="color:#F97583;">private</span><span style="color:#E1E4E8;"> MultipartResolver multipartResolver;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">/** LocaleResolver used by this servlet.</span></span>
<span class="line"><span style="color:#6A737D;">	区域信息解析器。与国际化有关</span></span>
<span class="line"><span style="color:#6A737D;">*/</span></span>
<span class="line"><span style="color:#E1E4E8;">@</span><span style="color:#F97583;">Nullable</span></span>
<span class="line"><span style="color:#F97583;">private</span><span style="color:#E1E4E8;"> LocaleResolver localeResolver;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">/** ThemeResolver used by this servlet.</span></span>
<span class="line"><span style="color:#6A737D;">	主题解析器。实现主题效果更换</span></span>
<span class="line"><span style="color:#6A737D;">*/</span></span>
<span class="line"><span style="color:#E1E4E8;">@</span><span style="color:#F97583;">Nullable</span></span>
<span class="line"><span style="color:#F97583;">private</span><span style="color:#E1E4E8;"> ThemeResolver themeResolver;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">/** List of HandlerMappings used by this servlet.</span></span>
<span class="line"><span style="color:#6A737D;">	处理器映射器。</span></span>
<span class="line"><span style="color:#6A737D;">*/</span></span>
<span class="line"><span style="color:#E1E4E8;">@</span><span style="color:#F97583;">Nullable</span></span>
<span class="line"><span style="color:#F97583;">private</span><span style="color:#E1E4E8;"> List&lt;</span><span style="color:#F97583;">HandlerMapping</span><span style="color:#E1E4E8;">&gt; handlerMappings;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">/** List of HandlerAdapters used by this servlet.</span></span>
<span class="line"><span style="color:#6A737D;">	处理器适配器。</span></span>
<span class="line"><span style="color:#6A737D;">*/</span></span>
<span class="line"><span style="color:#E1E4E8;">@</span><span style="color:#F97583;">Nullable</span></span>
<span class="line"><span style="color:#F97583;">private</span><span style="color:#E1E4E8;"> List&lt;</span><span style="color:#F97583;">HandlerAdapter</span><span style="color:#E1E4E8;">&gt; handlerAdapters;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">/** List of HandlerExceptionResolvers used by this servlet.</span></span>
<span class="line"><span style="color:#6A737D;">	处理器异常解析器。与SpringMVC的异常解析功能有关</span></span>
<span class="line"><span style="color:#6A737D;">*/</span></span>
<span class="line"><span style="color:#E1E4E8;">@</span><span style="color:#F97583;">Nullable</span></span>
<span class="line"><span style="color:#F97583;">private</span><span style="color:#E1E4E8;"> List&lt;</span><span style="color:#F97583;">HandlerExceptionResolver</span><span style="color:#E1E4E8;">&gt; handlerExceptionResolvers;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">/** RequestToViewNameTranslator used by this servlet.</span></span>
<span class="line"><span style="color:#6A737D;">	请求到视图名转换器。若没有跳转到的试图，则默认将请求地址转换为视图名</span></span>
<span class="line"><span style="color:#6A737D;">*/</span></span>
<span class="line"><span style="color:#E1E4E8;">@</span><span style="color:#F97583;">Nullable</span></span>
<span class="line"><span style="color:#F97583;">private</span><span style="color:#E1E4E8;"> RequestToViewNameTranslator viewNameTranslator;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">/** FlashMapManager used by this servlet.</span></span>
<span class="line"><span style="color:#6A737D;">	FlashMap管理器。SpringMVC中允许携带数据重定向功能。</span></span>
<span class="line"><span style="color:#6A737D;">	数据取出即销毁。</span></span>
<span class="line"><span style="color:#6A737D;">*/</span></span>
<span class="line"><span style="color:#E1E4E8;">@</span><span style="color:#F97583;">Nullable</span></span>
<span class="line"><span style="color:#F97583;">private</span><span style="color:#E1E4E8;"> FlashMapManager flashMapManager;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">/** List of ViewResolvers used by this servlet.</span></span>
<span class="line"><span style="color:#6A737D;">	视图解析器。</span></span>
<span class="line"><span style="color:#6A737D;">*/</span></span>
<span class="line"><span style="color:#E1E4E8;">@</span><span style="color:#F97583;">Nullable</span></span>
<span class="line"><span style="color:#F97583;">private</span><span style="color:#E1E4E8;"> List&lt;</span><span style="color:#F97583;">ViewResolver</span><span style="color:#E1E4E8;">&gt; viewResolvers;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">/** MultipartResolver used by this servlet.</span></span>
<span class="line"><span style="color:#6A737D;">	文件上传解析器。与文件上传有关</span></span>
<span class="line"><span style="color:#6A737D;">*/</span></span>
<span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">Nullable</span></span>
<span class="line"><span style="color:#D73A49;">private</span><span style="color:#24292E;"> MultipartResolver multipartResolver;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">/** LocaleResolver used by this servlet.</span></span>
<span class="line"><span style="color:#6A737D;">	区域信息解析器。与国际化有关</span></span>
<span class="line"><span style="color:#6A737D;">*/</span></span>
<span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">Nullable</span></span>
<span class="line"><span style="color:#D73A49;">private</span><span style="color:#24292E;"> LocaleResolver localeResolver;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">/** ThemeResolver used by this servlet.</span></span>
<span class="line"><span style="color:#6A737D;">	主题解析器。实现主题效果更换</span></span>
<span class="line"><span style="color:#6A737D;">*/</span></span>
<span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">Nullable</span></span>
<span class="line"><span style="color:#D73A49;">private</span><span style="color:#24292E;"> ThemeResolver themeResolver;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">/** List of HandlerMappings used by this servlet.</span></span>
<span class="line"><span style="color:#6A737D;">	处理器映射器。</span></span>
<span class="line"><span style="color:#6A737D;">*/</span></span>
<span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">Nullable</span></span>
<span class="line"><span style="color:#D73A49;">private</span><span style="color:#24292E;"> List&lt;</span><span style="color:#D73A49;">HandlerMapping</span><span style="color:#24292E;">&gt; handlerMappings;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">/** List of HandlerAdapters used by this servlet.</span></span>
<span class="line"><span style="color:#6A737D;">	处理器适配器。</span></span>
<span class="line"><span style="color:#6A737D;">*/</span></span>
<span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">Nullable</span></span>
<span class="line"><span style="color:#D73A49;">private</span><span style="color:#24292E;"> List&lt;</span><span style="color:#D73A49;">HandlerAdapter</span><span style="color:#24292E;">&gt; handlerAdapters;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">/** List of HandlerExceptionResolvers used by this servlet.</span></span>
<span class="line"><span style="color:#6A737D;">	处理器异常解析器。与SpringMVC的异常解析功能有关</span></span>
<span class="line"><span style="color:#6A737D;">*/</span></span>
<span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">Nullable</span></span>
<span class="line"><span style="color:#D73A49;">private</span><span style="color:#24292E;"> List&lt;</span><span style="color:#D73A49;">HandlerExceptionResolver</span><span style="color:#24292E;">&gt; handlerExceptionResolvers;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">/** RequestToViewNameTranslator used by this servlet.</span></span>
<span class="line"><span style="color:#6A737D;">	请求到视图名转换器。若没有跳转到的试图，则默认将请求地址转换为视图名</span></span>
<span class="line"><span style="color:#6A737D;">*/</span></span>
<span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">Nullable</span></span>
<span class="line"><span style="color:#D73A49;">private</span><span style="color:#24292E;"> RequestToViewNameTranslator viewNameTranslator;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">/** FlashMapManager used by this servlet.</span></span>
<span class="line"><span style="color:#6A737D;">	FlashMap管理器。SpringMVC中允许携带数据重定向功能。</span></span>
<span class="line"><span style="color:#6A737D;">	数据取出即销毁。</span></span>
<span class="line"><span style="color:#6A737D;">*/</span></span>
<span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">Nullable</span></span>
<span class="line"><span style="color:#D73A49;">private</span><span style="color:#24292E;"> FlashMapManager flashMapManager;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">/** List of ViewResolvers used by this servlet.</span></span>
<span class="line"><span style="color:#6A737D;">	视图解析器。</span></span>
<span class="line"><span style="color:#6A737D;">*/</span></span>
<span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">Nullable</span></span>
<span class="line"><span style="color:#D73A49;">private</span><span style="color:#24292E;"> List&lt;</span><span style="color:#D73A49;">ViewResolver</span><span style="color:#24292E;">&gt; viewResolvers;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br></div></div><p><strong>初始化细节</strong></p><p>有些组件在容器中是使用类型查找的，有些组件是根据ID查找的。</p><p>如果在容器中没有找到需要的组件，则使用默认配置的组件。</p><div class="language-java vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">/**</span></span>
<span class="line"><span style="color:#6A737D;"> * org.springframework.web.servlet.DispatcherServlet#initStrategies</span></span>
<span class="line"><span style="color:#6A737D;"> * 初始化此servlet使用的策略对象。可以在子类中重写，以初始化其他策略对象。</span></span>
<span class="line"><span style="color:#6A737D;"> * Initialize the strategy objects that this servlet uses.</span></span>
<span class="line"><span style="color:#6A737D;"> * &lt;p&gt;May be overridden in subclasses in order to initialize further strategy objects.</span></span>
<span class="line"><span style="color:#6A737D;"> */</span></span>
<span class="line"><span style="color:#F97583;">protected</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">void</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">initStrategies</span><span style="color:#E1E4E8;">(ApplicationContext context) {</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#B392F0;">initMultipartResolver</span><span style="color:#E1E4E8;">(context);</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#B392F0;">initLocaleResolver</span><span style="color:#E1E4E8;">(context);</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#B392F0;">initThemeResolver</span><span style="color:#E1E4E8;">(context);</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#B392F0;">initHandlerMappings</span><span style="color:#E1E4E8;">(context);</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#B392F0;">initHandlerAdapters</span><span style="color:#E1E4E8;">(context);</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#B392F0;">initHandlerExceptionResolvers</span><span style="color:#E1E4E8;">(context);</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#B392F0;">initRequestToViewNameTranslator</span><span style="color:#E1E4E8;">(context);</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#B392F0;">initViewResolvers</span><span style="color:#E1E4E8;">(context);</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#B392F0;">initFlashMapManager</span><span style="color:#E1E4E8;">(context);</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">/**</span></span>
<span class="line"><span style="color:#6A737D;"> * org.springframework.web.servlet.DispatcherServlet#initStrategies</span></span>
<span class="line"><span style="color:#6A737D;"> * 初始化此servlet使用的策略对象。可以在子类中重写，以初始化其他策略对象。</span></span>
<span class="line"><span style="color:#6A737D;"> * Initialize the strategy objects that this servlet uses.</span></span>
<span class="line"><span style="color:#6A737D;"> * &lt;p&gt;May be overridden in subclasses in order to initialize further strategy objects.</span></span>
<span class="line"><span style="color:#6A737D;"> */</span></span>
<span class="line"><span style="color:#D73A49;">protected</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">void</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">initStrategies</span><span style="color:#24292E;">(ApplicationContext context) {</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#6F42C1;">initMultipartResolver</span><span style="color:#24292E;">(context);</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#6F42C1;">initLocaleResolver</span><span style="color:#24292E;">(context);</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#6F42C1;">initThemeResolver</span><span style="color:#24292E;">(context);</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#6F42C1;">initHandlerMappings</span><span style="color:#24292E;">(context);</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#6F42C1;">initHandlerAdapters</span><span style="color:#24292E;">(context);</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#6F42C1;">initHandlerExceptionResolvers</span><span style="color:#24292E;">(context);</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#6F42C1;">initRequestToViewNameTranslator</span><span style="color:#24292E;">(context);</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#6F42C1;">initViewResolvers</span><span style="color:#24292E;">(context);</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#6F42C1;">initFlashMapManager</span><span style="color:#24292E;">(context);</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><div class="language-java vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">// 初始化HandlerMappings</span></span>
<span class="line"><span style="color:#F97583;">private</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">void</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">initHandlerMappings</span><span style="color:#E1E4E8;">(ApplicationContext context) {</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.handlerMappings </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">null</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#6A737D;">// this.detectAllHandlerMappings默认为true</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (</span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.detectAllHandlerMappings) {</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#6A737D;">// 在ApplicationContext中查找所有HandlerMappings，包括父类上下文</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#6A737D;">// Find all HandlerMappings in the ApplicationContext, including ancestor contexts.</span></span>
<span class="line"><span style="color:#E1E4E8;">      Map&lt;</span><span style="color:#F97583;">String</span><span style="color:#E1E4E8;">, </span><span style="color:#F97583;">HandlerMapping</span><span style="color:#E1E4E8;">&gt; matchingBeans </span><span style="color:#F97583;">=</span></span>
<span class="line"><span style="color:#E1E4E8;">            BeanFactoryUtils.</span><span style="color:#B392F0;">beansOfTypeIncludingAncestors</span><span style="color:#E1E4E8;">(context, HandlerMapping.class, </span><span style="color:#79B8FF;">true</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">false</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (</span><span style="color:#F97583;">!</span><span style="color:#E1E4E8;">matchingBeans.</span><span style="color:#B392F0;">isEmpty</span><span style="color:#E1E4E8;">()) {</span></span>
<span class="line"><span style="color:#E1E4E8;">         </span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.handlerMappings </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> ArrayList&lt;&gt;(matchingBeans.</span><span style="color:#B392F0;">values</span><span style="color:#E1E4E8;">());</span></span>
<span class="line"><span style="color:#E1E4E8;">         </span><span style="color:#6A737D;">// We keep HandlerMappings in sorted order.</span></span>
<span class="line"><span style="color:#E1E4E8;">         AnnotationAwareOrderComparator.</span><span style="color:#B392F0;">sort</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.handlerMappings);</span></span>
<span class="line"><span style="color:#E1E4E8;">      }</span></span>
<span class="line"><span style="color:#E1E4E8;">   }</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">else</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#F97583;">try</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">         HandlerMapping hm </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> context.</span><span style="color:#B392F0;">getBean</span><span style="color:#E1E4E8;">(HANDLER_MAPPING_BEAN_NAME, HandlerMapping.class);</span></span>
<span class="line"><span style="color:#E1E4E8;">         </span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.handlerMappings </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> Collections.</span><span style="color:#B392F0;">singletonList</span><span style="color:#E1E4E8;">(hm);</span></span>
<span class="line"><span style="color:#E1E4E8;">      }</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#F97583;">catch</span><span style="color:#E1E4E8;"> (NoSuchBeanDefinitionException </span><span style="color:#FFAB70;">ex</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">         </span><span style="color:#6A737D;">// Ignore, we&#39;ll add a default HandlerMapping later.</span></span>
<span class="line"><span style="color:#E1E4E8;">      }</span></span>
<span class="line"><span style="color:#E1E4E8;">   }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#6A737D;">// Ensure we have at least one HandlerMapping, by registering</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#6A737D;">// a default HandlerMapping if no other mappings are found.</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (</span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.handlerMappings </span><span style="color:#F97583;">==</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">null</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.handlerMappings </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">getDefaultStrategies</span><span style="color:#E1E4E8;">(context, HandlerMapping.class);</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (logger.</span><span style="color:#B392F0;">isTraceEnabled</span><span style="color:#E1E4E8;">()) {</span></span>
<span class="line"><span style="color:#E1E4E8;">         logger.</span><span style="color:#B392F0;">trace</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;No HandlerMappings declared for servlet &#39;&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">getServletName</span><span style="color:#E1E4E8;">() </span><span style="color:#F97583;">+</span></span>
<span class="line"><span style="color:#E1E4E8;">               </span><span style="color:#9ECBFF;">&quot;&#39;: using default strategies from DispatcherServlet.properties&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">      }</span></span>
<span class="line"><span style="color:#E1E4E8;">   }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">// 初始化HandlerMappings</span></span>
<span class="line"><span style="color:#D73A49;">private</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">void</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">initHandlerMappings</span><span style="color:#24292E;">(ApplicationContext context) {</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#005CC5;">this</span><span style="color:#24292E;">.handlerMappings </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">null</span><span style="color:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#6A737D;">// this.detectAllHandlerMappings默认为true</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (</span><span style="color:#005CC5;">this</span><span style="color:#24292E;">.detectAllHandlerMappings) {</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#6A737D;">// 在ApplicationContext中查找所有HandlerMappings，包括父类上下文</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#6A737D;">// Find all HandlerMappings in the ApplicationContext, including ancestor contexts.</span></span>
<span class="line"><span style="color:#24292E;">      Map&lt;</span><span style="color:#D73A49;">String</span><span style="color:#24292E;">, </span><span style="color:#D73A49;">HandlerMapping</span><span style="color:#24292E;">&gt; matchingBeans </span><span style="color:#D73A49;">=</span></span>
<span class="line"><span style="color:#24292E;">            BeanFactoryUtils.</span><span style="color:#6F42C1;">beansOfTypeIncludingAncestors</span><span style="color:#24292E;">(context, HandlerMapping.class, </span><span style="color:#005CC5;">true</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">false</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (</span><span style="color:#D73A49;">!</span><span style="color:#24292E;">matchingBeans.</span><span style="color:#6F42C1;">isEmpty</span><span style="color:#24292E;">()) {</span></span>
<span class="line"><span style="color:#24292E;">         </span><span style="color:#005CC5;">this</span><span style="color:#24292E;">.handlerMappings </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> ArrayList&lt;&gt;(matchingBeans.</span><span style="color:#6F42C1;">values</span><span style="color:#24292E;">());</span></span>
<span class="line"><span style="color:#24292E;">         </span><span style="color:#6A737D;">// We keep HandlerMappings in sorted order.</span></span>
<span class="line"><span style="color:#24292E;">         AnnotationAwareOrderComparator.</span><span style="color:#6F42C1;">sort</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">this</span><span style="color:#24292E;">.handlerMappings);</span></span>
<span class="line"><span style="color:#24292E;">      }</span></span>
<span class="line"><span style="color:#24292E;">   }</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#D73A49;">else</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#D73A49;">try</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">         HandlerMapping hm </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> context.</span><span style="color:#6F42C1;">getBean</span><span style="color:#24292E;">(HANDLER_MAPPING_BEAN_NAME, HandlerMapping.class);</span></span>
<span class="line"><span style="color:#24292E;">         </span><span style="color:#005CC5;">this</span><span style="color:#24292E;">.handlerMappings </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> Collections.</span><span style="color:#6F42C1;">singletonList</span><span style="color:#24292E;">(hm);</span></span>
<span class="line"><span style="color:#24292E;">      }</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#D73A49;">catch</span><span style="color:#24292E;"> (NoSuchBeanDefinitionException </span><span style="color:#E36209;">ex</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">         </span><span style="color:#6A737D;">// Ignore, we&#39;ll add a default HandlerMapping later.</span></span>
<span class="line"><span style="color:#24292E;">      }</span></span>
<span class="line"><span style="color:#24292E;">   }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#6A737D;">// Ensure we have at least one HandlerMapping, by registering</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#6A737D;">// a default HandlerMapping if no other mappings are found.</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (</span><span style="color:#005CC5;">this</span><span style="color:#24292E;">.handlerMappings </span><span style="color:#D73A49;">==</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">null</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#005CC5;">this</span><span style="color:#24292E;">.handlerMappings </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">getDefaultStrategies</span><span style="color:#24292E;">(context, HandlerMapping.class);</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (logger.</span><span style="color:#6F42C1;">isTraceEnabled</span><span style="color:#24292E;">()) {</span></span>
<span class="line"><span style="color:#24292E;">         logger.</span><span style="color:#6F42C1;">trace</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;No HandlerMappings declared for servlet &#39;&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">getServletName</span><span style="color:#24292E;">() </span><span style="color:#D73A49;">+</span></span>
<span class="line"><span style="color:#24292E;">               </span><span style="color:#032F62;">&quot;&#39;: using default strategies from DispatcherServlet.properties&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">      }</span></span>
<span class="line"><span style="color:#24292E;">   }</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><h3 id="目标方法执行" tabindex="-1">目标方法执行 <a class="header-anchor" href="#目标方法执行" aria-label="Permalink to &quot;目标方法执行&quot;">​</a></h3><div class="language-java vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">// org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter#invokeHandlerMethod</span></span>
<span class="line"><span style="color:#E1E4E8;">@</span><span style="color:#F97583;">Nullable</span></span>
<span class="line"><span style="color:#F97583;">protected</span><span style="color:#E1E4E8;"> ModelAndView </span><span style="color:#B392F0;">invokeHandlerMethod</span><span style="color:#E1E4E8;">(HttpServletRequest request,</span></span>
<span class="line"><span style="color:#E1E4E8;">      HttpServletResponse response, HandlerMethod handlerMethod) throws Exception {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#6A737D;">// 将原生的request, response包装成webRequest</span></span>
<span class="line"><span style="color:#E1E4E8;">   ServletWebRequest webRequest </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">ServletWebRequest</span><span style="color:#E1E4E8;">(request, response);</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">try</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#6A737D;">// 获取参数绑定工厂</span></span>
<span class="line"><span style="color:#E1E4E8;">      WebDataBinderFactory binderFactory </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">getDataBinderFactory</span><span style="color:#E1E4E8;">(handlerMethod);</span></span>
<span class="line"><span style="color:#E1E4E8;">      ModelFactory modelFactory </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">getModelFactory</span><span style="color:#E1E4E8;">(handlerMethod, binderFactory);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">      ServletInvocableHandlerMethod invocableMethod </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">createInvocableHandlerMethod</span><span style="color:#E1E4E8;">(handlerMethod);</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (</span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.argumentResolvers </span><span style="color:#F97583;">!=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">null</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">         </span><span style="color:#6A737D;">// 设置处理方法的参数解析器</span></span>
<span class="line"><span style="color:#E1E4E8;">         invocableMethod.</span><span style="color:#B392F0;">setHandlerMethodArgumentResolvers</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.argumentResolvers);</span></span>
<span class="line"><span style="color:#E1E4E8;">      }</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (</span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.returnValueHandlers </span><span style="color:#F97583;">!=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">null</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">         </span><span style="color:#6A737D;">// 设置处理方法的返回值处理器</span></span>
<span class="line"><span style="color:#E1E4E8;">         invocableMethod.</span><span style="color:#B392F0;">setHandlerMethodReturnValueHandlers</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.returnValueHandlers);</span></span>
<span class="line"><span style="color:#E1E4E8;">      }</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#6A737D;">// 设置参数绑定工厂</span></span>
<span class="line"><span style="color:#E1E4E8;">      invocableMethod.</span><span style="color:#B392F0;">setDataBinderFactory</span><span style="color:#E1E4E8;">(binderFactory);</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#6A737D;">// 设置参数名的发现者</span></span>
<span class="line"><span style="color:#E1E4E8;">      invocableMethod.</span><span style="color:#B392F0;">setParameterNameDiscoverer</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.parameterNameDiscoverer);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">      ModelAndViewContainer mavContainer </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">ModelAndViewContainer</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">      mavContainer.</span><span style="color:#B392F0;">addAllAttributes</span><span style="color:#E1E4E8;">(RequestContextUtils.</span><span style="color:#B392F0;">getInputFlashMap</span><span style="color:#E1E4E8;">(request));</span></span>
<span class="line"><span style="color:#E1E4E8;">      modelFactory.</span><span style="color:#B392F0;">initModel</span><span style="color:#E1E4E8;">(webRequest, mavContainer, invocableMethod);</span></span>
<span class="line"><span style="color:#E1E4E8;">      mavContainer.</span><span style="color:#B392F0;">setIgnoreDefaultModelOnRedirect</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.ignoreDefaultModelOnRedirect);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">      AsyncWebRequest asyncWebRequest </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> WebAsyncUtils.</span><span style="color:#B392F0;">createAsyncWebRequest</span><span style="color:#E1E4E8;">(request, response);</span></span>
<span class="line"><span style="color:#E1E4E8;">      asyncWebRequest.</span><span style="color:#B392F0;">setTimeout</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.asyncRequestTimeout);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">      WebAsyncManager asyncManager </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> WebAsyncUtils.</span><span style="color:#B392F0;">getAsyncManager</span><span style="color:#E1E4E8;">(request);</span></span>
<span class="line"><span style="color:#E1E4E8;">      asyncManager.</span><span style="color:#B392F0;">setTaskExecutor</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.taskExecutor);</span></span>
<span class="line"><span style="color:#E1E4E8;">      asyncManager.</span><span style="color:#B392F0;">setAsyncWebRequest</span><span style="color:#E1E4E8;">(asyncWebRequest);</span></span>
<span class="line"><span style="color:#E1E4E8;">      asyncManager.</span><span style="color:#B392F0;">registerCallableInterceptors</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.callableInterceptors);</span></span>
<span class="line"><span style="color:#E1E4E8;">      asyncManager.</span><span style="color:#B392F0;">registerDeferredResultInterceptors</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.deferredResultInterceptors);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (asyncManager.</span><span style="color:#B392F0;">hasConcurrentResult</span><span style="color:#E1E4E8;">()) {</span></span>
<span class="line"><span style="color:#E1E4E8;">         Object result </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> asyncManager.</span><span style="color:#B392F0;">getConcurrentResult</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">         mavContainer </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> (ModelAndViewContainer) asyncManager.</span><span style="color:#B392F0;">getConcurrentResultContext</span><span style="color:#E1E4E8;">()[</span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">];</span></span>
<span class="line"><span style="color:#E1E4E8;">         asyncManager.</span><span style="color:#B392F0;">clearConcurrentResult</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">         LogFormatUtils.</span><span style="color:#B392F0;">traceDebug</span><span style="color:#E1E4E8;">(logger, traceOn </span><span style="color:#F97583;">-&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">            String formatted </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> LogFormatUtils.</span><span style="color:#B392F0;">formatValue</span><span style="color:#E1E4E8;">(result, </span><span style="color:#F97583;">!</span><span style="color:#E1E4E8;">traceOn);</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;Resume with async result [&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> formatted </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;]&quot;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">         });</span></span>
<span class="line"><span style="color:#E1E4E8;">         invocableMethod </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> invocableMethod.</span><span style="color:#B392F0;">wrapConcurrentResult</span><span style="color:#E1E4E8;">(result);</span></span>
<span class="line"><span style="color:#E1E4E8;">      }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#6A737D;">// 执行目标方法</span></span>
<span class="line"><span style="color:#E1E4E8;">      invocableMethod.</span><span style="color:#B392F0;">invokeAndHandle</span><span style="color:#E1E4E8;">(webRequest, mavContainer);</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (asyncManager.</span><span style="color:#B392F0;">isConcurrentHandlingStarted</span><span style="color:#E1E4E8;">()) {</span></span>
<span class="line"><span style="color:#E1E4E8;">         </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">null</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">      }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">getModelAndView</span><span style="color:#E1E4E8;">(mavContainer, modelFactory, webRequest);</span></span>
<span class="line"><span style="color:#E1E4E8;">   }</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">finally</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">      webRequest.</span><span style="color:#B392F0;">requestCompleted</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">   }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">// org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter#invokeHandlerMethod</span></span>
<span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">Nullable</span></span>
<span class="line"><span style="color:#D73A49;">protected</span><span style="color:#24292E;"> ModelAndView </span><span style="color:#6F42C1;">invokeHandlerMethod</span><span style="color:#24292E;">(HttpServletRequest request,</span></span>
<span class="line"><span style="color:#24292E;">      HttpServletResponse response, HandlerMethod handlerMethod) throws Exception {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#6A737D;">// 将原生的request, response包装成webRequest</span></span>
<span class="line"><span style="color:#24292E;">   ServletWebRequest webRequest </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">ServletWebRequest</span><span style="color:#24292E;">(request, response);</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#D73A49;">try</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#6A737D;">// 获取参数绑定工厂</span></span>
<span class="line"><span style="color:#24292E;">      WebDataBinderFactory binderFactory </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">getDataBinderFactory</span><span style="color:#24292E;">(handlerMethod);</span></span>
<span class="line"><span style="color:#24292E;">      ModelFactory modelFactory </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">getModelFactory</span><span style="color:#24292E;">(handlerMethod, binderFactory);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">      ServletInvocableHandlerMethod invocableMethod </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">createInvocableHandlerMethod</span><span style="color:#24292E;">(handlerMethod);</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (</span><span style="color:#005CC5;">this</span><span style="color:#24292E;">.argumentResolvers </span><span style="color:#D73A49;">!=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">null</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">         </span><span style="color:#6A737D;">// 设置处理方法的参数解析器</span></span>
<span class="line"><span style="color:#24292E;">         invocableMethod.</span><span style="color:#6F42C1;">setHandlerMethodArgumentResolvers</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">this</span><span style="color:#24292E;">.argumentResolvers);</span></span>
<span class="line"><span style="color:#24292E;">      }</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (</span><span style="color:#005CC5;">this</span><span style="color:#24292E;">.returnValueHandlers </span><span style="color:#D73A49;">!=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">null</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">         </span><span style="color:#6A737D;">// 设置处理方法的返回值处理器</span></span>
<span class="line"><span style="color:#24292E;">         invocableMethod.</span><span style="color:#6F42C1;">setHandlerMethodReturnValueHandlers</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">this</span><span style="color:#24292E;">.returnValueHandlers);</span></span>
<span class="line"><span style="color:#24292E;">      }</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#6A737D;">// 设置参数绑定工厂</span></span>
<span class="line"><span style="color:#24292E;">      invocableMethod.</span><span style="color:#6F42C1;">setDataBinderFactory</span><span style="color:#24292E;">(binderFactory);</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#6A737D;">// 设置参数名的发现者</span></span>
<span class="line"><span style="color:#24292E;">      invocableMethod.</span><span style="color:#6F42C1;">setParameterNameDiscoverer</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">this</span><span style="color:#24292E;">.parameterNameDiscoverer);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">      ModelAndViewContainer mavContainer </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">ModelAndViewContainer</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">      mavContainer.</span><span style="color:#6F42C1;">addAllAttributes</span><span style="color:#24292E;">(RequestContextUtils.</span><span style="color:#6F42C1;">getInputFlashMap</span><span style="color:#24292E;">(request));</span></span>
<span class="line"><span style="color:#24292E;">      modelFactory.</span><span style="color:#6F42C1;">initModel</span><span style="color:#24292E;">(webRequest, mavContainer, invocableMethod);</span></span>
<span class="line"><span style="color:#24292E;">      mavContainer.</span><span style="color:#6F42C1;">setIgnoreDefaultModelOnRedirect</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">this</span><span style="color:#24292E;">.ignoreDefaultModelOnRedirect);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">      AsyncWebRequest asyncWebRequest </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> WebAsyncUtils.</span><span style="color:#6F42C1;">createAsyncWebRequest</span><span style="color:#24292E;">(request, response);</span></span>
<span class="line"><span style="color:#24292E;">      asyncWebRequest.</span><span style="color:#6F42C1;">setTimeout</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">this</span><span style="color:#24292E;">.asyncRequestTimeout);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">      WebAsyncManager asyncManager </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> WebAsyncUtils.</span><span style="color:#6F42C1;">getAsyncManager</span><span style="color:#24292E;">(request);</span></span>
<span class="line"><span style="color:#24292E;">      asyncManager.</span><span style="color:#6F42C1;">setTaskExecutor</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">this</span><span style="color:#24292E;">.taskExecutor);</span></span>
<span class="line"><span style="color:#24292E;">      asyncManager.</span><span style="color:#6F42C1;">setAsyncWebRequest</span><span style="color:#24292E;">(asyncWebRequest);</span></span>
<span class="line"><span style="color:#24292E;">      asyncManager.</span><span style="color:#6F42C1;">registerCallableInterceptors</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">this</span><span style="color:#24292E;">.callableInterceptors);</span></span>
<span class="line"><span style="color:#24292E;">      asyncManager.</span><span style="color:#6F42C1;">registerDeferredResultInterceptors</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">this</span><span style="color:#24292E;">.deferredResultInterceptors);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (asyncManager.</span><span style="color:#6F42C1;">hasConcurrentResult</span><span style="color:#24292E;">()) {</span></span>
<span class="line"><span style="color:#24292E;">         Object result </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> asyncManager.</span><span style="color:#6F42C1;">getConcurrentResult</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">         mavContainer </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> (ModelAndViewContainer) asyncManager.</span><span style="color:#6F42C1;">getConcurrentResultContext</span><span style="color:#24292E;">()[</span><span style="color:#005CC5;">0</span><span style="color:#24292E;">];</span></span>
<span class="line"><span style="color:#24292E;">         asyncManager.</span><span style="color:#6F42C1;">clearConcurrentResult</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">         LogFormatUtils.</span><span style="color:#6F42C1;">traceDebug</span><span style="color:#24292E;">(logger, traceOn </span><span style="color:#D73A49;">-&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">            String formatted </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> LogFormatUtils.</span><span style="color:#6F42C1;">formatValue</span><span style="color:#24292E;">(result, </span><span style="color:#D73A49;">!</span><span style="color:#24292E;">traceOn);</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;Resume with async result [&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> formatted </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;]&quot;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">         });</span></span>
<span class="line"><span style="color:#24292E;">         invocableMethod </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> invocableMethod.</span><span style="color:#6F42C1;">wrapConcurrentResult</span><span style="color:#24292E;">(result);</span></span>
<span class="line"><span style="color:#24292E;">      }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#6A737D;">// 执行目标方法</span></span>
<span class="line"><span style="color:#24292E;">      invocableMethod.</span><span style="color:#6F42C1;">invokeAndHandle</span><span style="color:#24292E;">(webRequest, mavContainer);</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (asyncManager.</span><span style="color:#6F42C1;">isConcurrentHandlingStarted</span><span style="color:#24292E;">()) {</span></span>
<span class="line"><span style="color:#24292E;">         </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">null</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">      }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">getModelAndView</span><span style="color:#24292E;">(mavContainer, modelFactory, webRequest);</span></span>
<span class="line"><span style="color:#24292E;">   }</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#D73A49;">finally</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">      webRequest.</span><span style="color:#6F42C1;">requestCompleted</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">   }</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br></div></div><div class="language-java vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">void</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">invokeAndHandle</span><span style="color:#E1E4E8;">(ServletWebRequest webRequest, ModelAndViewContainer mavContainer,</span></span>
<span class="line"><span style="color:#E1E4E8;">      Object... providedArgs) throws Exception {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#6A737D;">// 执行目标方法</span></span>
<span class="line"><span style="color:#E1E4E8;">   Object returnValue </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">invokeForRequest</span><span style="color:#E1E4E8;">(webRequest, mavContainer, providedArgs);</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#B392F0;">setResponseStatus</span><span style="color:#E1E4E8;">(webRequest);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (returnValue </span><span style="color:#F97583;">==</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">null</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (</span><span style="color:#B392F0;">isRequestNotModified</span><span style="color:#E1E4E8;">(webRequest) </span><span style="color:#F97583;">||</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">getResponseStatus</span><span style="color:#E1E4E8;">() </span><span style="color:#F97583;">!=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">null</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">||</span><span style="color:#E1E4E8;"> mavContainer.</span><span style="color:#B392F0;">isRequestHandled</span><span style="color:#E1E4E8;">()) {</span></span>
<span class="line"><span style="color:#E1E4E8;">         </span><span style="color:#B392F0;">disableContentCachingIfNecessary</span><span style="color:#E1E4E8;">(webRequest);</span></span>
<span class="line"><span style="color:#E1E4E8;">         mavContainer.</span><span style="color:#B392F0;">setRequestHandled</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">true</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">         </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">      }</span></span>
<span class="line"><span style="color:#E1E4E8;">   }</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">else</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (StringUtils.</span><span style="color:#B392F0;">hasText</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">getResponseStatusReason</span><span style="color:#E1E4E8;">())) {</span></span>
<span class="line"><span style="color:#E1E4E8;">      mavContainer.</span><span style="color:#B392F0;">setRequestHandled</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">true</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">   }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">   mavContainer.</span><span style="color:#B392F0;">setRequestHandled</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">false</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">   Assert.</span><span style="color:#B392F0;">state</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.returnValueHandlers </span><span style="color:#F97583;">!=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">null</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;No return value handlers&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">try</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.returnValueHandlers.</span><span style="color:#B392F0;">handleReturnValue</span><span style="color:#E1E4E8;">(</span></span>
<span class="line"><span style="color:#E1E4E8;">            returnValue, </span><span style="color:#B392F0;">getReturnValueType</span><span style="color:#E1E4E8;">(returnValue), mavContainer, webRequest);</span></span>
<span class="line"><span style="color:#E1E4E8;">   }</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">catch</span><span style="color:#E1E4E8;"> (Exception </span><span style="color:#FFAB70;">ex</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (logger.</span><span style="color:#B392F0;">isTraceEnabled</span><span style="color:#E1E4E8;">()) {</span></span>
<span class="line"><span style="color:#E1E4E8;">         logger.</span><span style="color:#B392F0;">trace</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">formatErrorForReturnValue</span><span style="color:#E1E4E8;">(returnValue), ex);</span></span>
<span class="line"><span style="color:#E1E4E8;">      }</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#F97583;">throw</span><span style="color:#E1E4E8;"> ex;</span></span>
<span class="line"><span style="color:#E1E4E8;">   }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">void</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">invokeAndHandle</span><span style="color:#24292E;">(ServletWebRequest webRequest, ModelAndViewContainer mavContainer,</span></span>
<span class="line"><span style="color:#24292E;">      Object... providedArgs) throws Exception {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#6A737D;">// 执行目标方法</span></span>
<span class="line"><span style="color:#24292E;">   Object returnValue </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">invokeForRequest</span><span style="color:#24292E;">(webRequest, mavContainer, providedArgs);</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#6F42C1;">setResponseStatus</span><span style="color:#24292E;">(webRequest);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (returnValue </span><span style="color:#D73A49;">==</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">null</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (</span><span style="color:#6F42C1;">isRequestNotModified</span><span style="color:#24292E;">(webRequest) </span><span style="color:#D73A49;">||</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">getResponseStatus</span><span style="color:#24292E;">() </span><span style="color:#D73A49;">!=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">null</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">||</span><span style="color:#24292E;"> mavContainer.</span><span style="color:#6F42C1;">isRequestHandled</span><span style="color:#24292E;">()) {</span></span>
<span class="line"><span style="color:#24292E;">         </span><span style="color:#6F42C1;">disableContentCachingIfNecessary</span><span style="color:#24292E;">(webRequest);</span></span>
<span class="line"><span style="color:#24292E;">         mavContainer.</span><span style="color:#6F42C1;">setRequestHandled</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">true</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">         </span><span style="color:#D73A49;">return</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">      }</span></span>
<span class="line"><span style="color:#24292E;">   }</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#D73A49;">else</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (StringUtils.</span><span style="color:#6F42C1;">hasText</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">getResponseStatusReason</span><span style="color:#24292E;">())) {</span></span>
<span class="line"><span style="color:#24292E;">      mavContainer.</span><span style="color:#6F42C1;">setRequestHandled</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">true</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#D73A49;">return</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">   }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">   mavContainer.</span><span style="color:#6F42C1;">setRequestHandled</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">false</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">   Assert.</span><span style="color:#6F42C1;">state</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">this</span><span style="color:#24292E;">.returnValueHandlers </span><span style="color:#D73A49;">!=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">null</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;No return value handlers&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#D73A49;">try</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#005CC5;">this</span><span style="color:#24292E;">.returnValueHandlers.</span><span style="color:#6F42C1;">handleReturnValue</span><span style="color:#24292E;">(</span></span>
<span class="line"><span style="color:#24292E;">            returnValue, </span><span style="color:#6F42C1;">getReturnValueType</span><span style="color:#24292E;">(returnValue), mavContainer, webRequest);</span></span>
<span class="line"><span style="color:#24292E;">   }</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#D73A49;">catch</span><span style="color:#24292E;"> (Exception </span><span style="color:#E36209;">ex</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (logger.</span><span style="color:#6F42C1;">isTraceEnabled</span><span style="color:#24292E;">()) {</span></span>
<span class="line"><span style="color:#24292E;">         logger.</span><span style="color:#6F42C1;">trace</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">formatErrorForReturnValue</span><span style="color:#24292E;">(returnValue), ex);</span></span>
<span class="line"><span style="color:#24292E;">      }</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#D73A49;">throw</span><span style="color:#24292E;"> ex;</span></span>
<span class="line"><span style="color:#24292E;">   }</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div>`,30),c=[t];function E(y,i,u,d,b,m){return n(),a("div",null,c)}const h=s(r,[["render",E]]);export{A as __pageData,h as default};
